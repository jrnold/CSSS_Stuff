Single World Intervention Graphs (SWIGs):
A Unification of the Counterfactual and Graphical
Approaches to Causality
Thomas S. Richardson
University of Washington

James M. Robins
Harvard University

Working Paper Number 128
Center for Statistics and the Social Sciences
University of Washington

30 April 2013

Abstract
We present a simple graphical theory unifying causal directed acyclic graphs
(DAGs) and potential (aka counterfactual) outcomes via a node-splitting
transformation. We introduce a new graph, the Single-World Intervention
Graph (SWIG). The SWIG encodes the counterfactual independences associated with a specific hypothetical intervention on the set of treatment
variables. The nodes on the SWIG are the corresponding counterfactual
random variables. We illustrate the theory with a number of examples. Our
graphical theory of SWIGs may be used to infer the counterfactual independence relations implied by the counterfactual models developed in Robins
(1986, 1987). Moreover, in the absence of hidden variables, the joint distribution of the counterfactuals is identified; the identifying formula is the
extended g-computation formula introduced in (Robins et al., 2004). Although Robins (1986, 1987) did not use DAGs we translate his algebraic
results to facilitate understanding of this prior work. An attractive feature
of Robins’ approach is that it largely avoids making counterfactual independence assumptions that are experimentally untestable. As an important
illustration we revisit the critique of Robins’ g-computation given in (Pearl,
2009, Ch. 11.3.7); we use SWIGs to show that all of Pearl’s claims are either
erroneous or based on misconceptions.
We also show that simple extensions of the formalism may be used to
accommodate dynamic regimes, and to formulate non-parametric structural
equation models in which assumptions relating to the absence of direct effects are formulated at the population level. Finally, we show that our
graphical theory also naturally arises in the context of an expanded causal
Bayesian network in which we are able to observe the natural state of a
variable prior to intervention.

1

Introduction

Potential outcomes are extensively used within Statistics, Political Science,
Economics, and Epidemiology for reasoning about causation. Directed acyclic
graphs (DAGs) are another formalism used to represent causal systems also
extensively used in Computer Science, Bioinformatics, Sociology and Epidemiology. Given the long history and utility of both approaches – as demonstrated by many applications – it is natural to to wish to unify them.

A graphical unification of existing causal models
We present a simple approach to this synthesis based on an intuitive graphical transformation: by ‘splitting’ treatment nodes in a causal DAG over
the actual variables, we form a new graph, the Single-World Intervention
Graph (SWIG). The SWIG encodes the counterfactual independences associated with a specific hypothetical intervention on the set of treatment
variables. The nodes on the SWIG are the corresponding counterfactual
random variables. The factorization and Markov properties encoded in the
structure of the SWIG imply and are implied by the extended g-formula of
Robins et al. (2004); see (37) below. These two properties are satisfied by
all previously proposed counterfactual causal models, including the Finest
Fully Randomized Causally Interpretable Structured Tree Graphs (FFRCISTG) of Robins (1986), the Pseudo-Indeterministic Systems of Spirtes
et al. (1993), the Non-Parametric Structural Equation Models with Independent Errors1 (NPSEM-IE) considered in Pearl (2000) and the Minimal
Counterfactual Model (MCM) of Robins and Richardson (2011).2
In fact, if, following Geneletti and Dawid (2007) and Robins et al. (2007)
1

In (Pearl, 2000, 2009; Robins and Richardson, 2011) the acronym ‘NPSEM’ is used to
refer to what is here termed an NPSEM-IE. We wish to emphasize here that FFRCISTGs
may also be explicitly defined via a system of structural equations (with possibly dependent
errors – though any such dependence is undetectable via randomized experiments). Hence
Pearl’s NPSEM-IE model is a strict sub-model of the FFRCISTG model. We have thus
opted to refine Pearl’s notation to make clear that it is solely the additional (untestable)
assumptions regarding independence of the errors that distinguish the NPSEM-IE and the
FFRCISTG approaches. FFRCISTGs as defined in Robins (1986) did not require that all
variables could be intervened on. Thus, to be precise, the FFRCISTG models referred to
in the main text of this paper and in (Robins and Richardson, 2011) are those in which all
variables are subject to intervention. It is these FFRCISTGs that may be defined via a
system of structural equations. See Appendix C for details and the original, more general,
definition.
2
Strictly MCMs (Robins and Richardson, 2011) only obey the resulting properties in
the case where all intervention variables are binary.

1

we postulate the existence of additional observed variables giving the natural state that a variable would take prior to intervention, but before the
natural value has any effects, then the independence and factorization properties encoded by our transformed graph are even satisfied by causal models
that do not explicitly involve potential outcomes, such as ‘causal Bayesian
networks’ (Pearl, 2000) and causal influence diagrams (Dawid and Didelez,
2008, 2010); see §9 for further details.
More specifically, given a causal DAG over the actual variables we construct a set of Single-World Intervention Graphs (SWIGs). Since the node
set consists of the set of counterfactual variables corresponding to a single hypothetical intervention on a set of (possibly time varying) treatments
no two SWIGs (constructed from the same initial DAG) will have identical
node sets. Furthermore, if the factuals on the DAG have a positive distribution, then a SWIG will not contain random variables that are related
deterministically. As a consequence the graphical criterion (d-separation)
for checking conditional independence among counterfactual variables (on a
given SWIG) is complete. In other words, our SWIG encodes all of those
independence relations (among the variables present in the SWIG) that hold
for all distributions over counterfactuals in the (FFRCISTG or NPSEM-IE)
model. If a counterfactual independence relation among the variables in the
SWIG is not implied then there is some distribution that is in the model
for which the corresponding dependence holds. This completeness property
(with respect to the variables present in the graph) does not hold for either
the ‘twin network’ approach of Balke and Pearl (1994); Pearl (2000) or the
‘counterfactual graphs’ of Shpitser and Pearl (2007, 2008).3
At the end of the Section 2, in §4.2 and in Appendix D we provide a
number of examples where this lack of completeness for twin-networks leads
Pearl, one of the creators of the twin-network method, to draw erroneous
3

The d-separation criterion applied to the SWIG is complete (relative to the subset
of variables in the SWIG) with respect to both the NPSEM-IE and FFRCISTG models
associated with the original graph G. d-separation is not complete for twin-networks since
they include more variables amongst which there are deterministic relations; see §D.
d-separation applied to the ‘counterfactual graphs’ introduced in (Shpitser and Pearl,
2007, 2008) is conjectured (Shpitser, 2013) to be complete for independence among events
(or equivalently indicators I(V = v)). However, to use this to check for independence
among variables requires the construction of an exponential number of counterfactual
graphs. There is currently no known polynomial-time algorithm for testing independence
among counterfactual variables under the NPSEM-IE.
It should be noted that ‘twin networks’ and ‘counterfactual graphs’ are designed to
address a harder problem than SWIGs since their goal is to determine all independencies
implied by an NPSEM-IE model including ‘cross-world’ independencies; see §6.

2

conclusions with regard to counterfactual independence.

Linking graphs and counterfactuals with minimal assumptions
As just noted, our approach differs from previously proposed attempts to
link graphs and counterfactuals such as the ‘twin network’ approach of Balke
and Pearl (1994); Pearl (2000) and the ‘counterfactual graph’ of Shpitser
and Pearl (2007, 2008). Some of these differences reflect the fact that every counterfactual independence relation implied by our graph holds in the
FFRCISTG model of Robins (1986); the other approaches encode additional counterfactual independence properties that are satisfied only under
the more restrictive NPSEM-IE model, a strict submodel of the FFRCISTG
model. It follows that any independence that holds under our model also
holds under an NPSEM-IE; however, the converse is false.
More specifically, an FFRCISTG, in contrast to an NPSEM-IE:
• makes (exponentially) fewer ‘cross-world’ counterfactual independence
assumptions that are experimentally untestable;
• in marked contrast to all graphical (Markov) models considered heretofore the FFRCISTG does not obey the composition axiom of independence4 with respect to the full universe of variables. However, the
model does obey composition with respect to subsets of counterfactual variables that are present on the same SWIG. Thus we use the
usual criterion (d-separation) to read independence.
Our approach also leads naturally to the specification of models in which
well-defined interventions (or potential outcomes) exist only for a strict subset of the variables as in (Robins, 1986).

Removing a false trichotomy
A primary aim of this paper is thus to show that researchers in causality are
not forced to choose between:
• Use causal graphs without counterfactuals;
• Use counterfactuals without graphs;
4
The ‘composition axiom’ is the implication: X⊥
⊥Y | Z & X⊥
⊥W | Z ⇒ X⊥
⊥{Y, W } | Z
(See Pearl, 1988, p.128); this should not be confused with the composition axiom for
counterfactuals (See Pearl, 2000, 2009, p.229).

3

• Combine graphs and counterfactuals via the NPSEM-IE framework,
as advocated by Pearl, thereby being required to make many counterfactual independence assumptions that are not potentially testable.
We believe that at least some of the motivation for using graphs without
counterfactuals and vice-versa has been the misperception that to combine
the two approaches necessitates the adoption of the NPSEM-IE approach
and its strong assumptions that are for many purposes unnecessary.
We emphasize that we are not arguing that NPSEM-IE models are never
appropriate. Rather our point is that an analyst who adopts a counterfactual theory need not also adopt an NPSEM-IE, as there exist counterfactual
models – the FFRCISTGs of (Robins, 1986, 1989b) that, in contrast to
NPSEM-IEs, encode few if any facts that are not potentially testable by
performing an ideal Randomized Controlled Trial. In addition, the SWIGs
make it easy to reason with these models. Furthermore, even though the
FFRCISTG model makes fewer assumptions, most causal quantities of interest remain identified under the FFRCISTG if they are identified under the
NPSEM-IE – Pure (aka Natural) Direct Effects and Principal Stratum Direct Effects being the primary exceptions; but see (Robins and Richardson,
2011) and Section 6.1.1 below for some subtleties.
To help delineate the issues involved, suppose there was good evidence
for the FFRCISTG model because causal effects estimated under the model
from the available observational data agreed with effects estimates from
well-conducted randomized trials. Then one might believe, based on either
simplicity arguments (aka a faithfulness assumption; Spirtes et al. (1993)),
physical law, or Bayesian inference with a prior over structures, that it was
highly likely that the corresponding NPSEM-IE model was true. In this
case, if the NPSEM-IE identified the Pure Direct Effect, one might provide
point estimates for this quantity. Our point is simply that such inferences
rely on extrapolation and thus must be argued for in each case.
We have been arguing that an advantage of the FFRCISTG model compared to the NPSEM-IE model is that nearly every prediction from observational data of a causal effect identified under the FFRCISTG can be tested,
at least in principle, by comparing the prediction with the results of a randomized controlled trial. However, this view ignores the facts that (i) such
experimental trials may be infeasible or unethical; (ii) the validity of the
comparison will typically require an auxiliary assumption of exchangeability between the experimental and observational population and the ability
to measure all the variables included in the causal model, neither of which
is likely to hold in practice; and (iii) such tests are themselves based upon
4

the untestable assumption that experimental interventions are ideal. Thus,
many philosophers of science do not agree with a sharp separation between
testable and non-testable causal predictions. Although we agree the separation may not be sharp we believe that the distinction nonetheless remains
useful both conceptually and practically.

Further advantages of the new approach
Our new approach based on SWIGs has a number of further advantages
over previous approaches. As discussed above the foremost advantage of
our approach is that it allows one to write down a factorization of the joint
distribution of the counterfactuals on the SWIG and to read off counterfactual independencies via d-separation (Pearl, 1988).
Another advantage is that a simple modification of a SWIG5 allows one
to encode on a single graph (and thus distinguish) the two possible causal
interpretations of missing arrows: an absence of a causal effect for each
individual versus the absence of an average causal effect at the population
level.
An additional advantage is that it simplifies the approaches of (Pearl,
1995; Pearl and Robins, 1995) to the identification of intervention distributions. In particular:
• The SWIG gives a graphical explanation as to why conditioning on
variables so as to ‘block all back-door paths’ provides a consistent
estimate of the causal effect of a variable X on Y , both under the null
hypothesis of no causal effect, and under the alternative.
• The SWIG permits the criteria for identification by the g-computation
formula of treatment regimes or plans involving k different treatments
to be checked by inspecting a single graph, whereas previous criteria
(Pearl and Robins, 1995), though equivalent, require the construction
and inspection of a series of k different ‘mutilated’ graphs.
• The SWIG approach naturally extends to dynamic regimes where
treatment is assigned (either deterministically or stochastically) on
the basis of prior covariates, including the natural value of treatment
that a patient would choose (in the absence of it being specified by the
regime).
In the next section we give motivating examples, followed by an outline
of the rest of the paper.
5

See §7.

5

Unobserved H
Y

X

Y

X

(a)

(b)

Figure 1: (a) A causal DAG representing two unconfounded variables; (b)
A causal DAG representing the presence of confounding.

2

Motivating Examples

To motivate our development we first consider the simple graphs, shown in
Figure 1. The nodes represent random variables and the graph represents a
factorization of their joint density. Specifically, the DAG in Figure 1(a) is
associated with the (trivial) factorization:
p(x, y) = p(x)p(y | x)

(1)

where the densities on the RHS are associated, respectively, with X and Y
in the DAG.
DAGs are often given a causal interpretation. In that case the DAG in
Figure 1(a) is interpreted as representing the fact that the effect of X on Y
is unconfounded. (In contrast on the DAG in Figure 1(b) the effect of X on
Y is confounded by the common cause H.) Within the potential outcomes
(or counterfactual) literature the absence of confounding is understood as
implying (at least) the ‘weak ignorability’ conditions:
X⊥
⊥Y (x = 0)

and X⊥
⊥Y (x = 1),

(2)

where we have supposed that X is a binary treatment variable, and that
the potential outcomes Y (x = 0) and Y (x = 1) are well-defined. Here, for
example Y (x = 0) denotes the value of Y had, possibly contrary to fact, X
been set to 0.6
6
Many readers may be more familiar with the ‘do’ notation of Pearl (1995) or the gnotation of Robins (1986, 1989a) than with the potential outcome notation adopted here.
We describe their inter-relationships in order to facilitate translation. Pearl’s ‘do’ notation
is a special case of the g-notation P (Y = y | g), introduced in Robins (1986, p.1423).
Here ‘g’ stands for some ‘generalized’ treatment regime or, equivalently, plan. The set
of possible generalized treatment regimes ‘g’ included non-dynamic (aka static) regimes

6

One of the primary uses of graphs, including DAGs, is to represent the
conditional independence (or Markov) structure of a multivariate distribution via d-separation (see Appendix A for a review). Since (2) is an independence statement, one might naively think that this could be read directly from the graph in Figure 1(a). However, the absence of the variables
Y (x = 0) and Y (x = 1) in the DAG in Figure 1(a) present an insurmountable obstacle to reading the independencies (2) from this graph (!)

The node-splitting transformation
In the approach described here we address this by introducing a simple
‘node splitting’ operation. Applying this operation to vertex X in the DAG
in Figure 1(a) results in the graphs in Figure 2, which we term Single-World
Intervention Graphs (SWIGs). If the hypothetical intervention sets X to 0
then we obtain the SWIG G(x = 0) shown in Figure 2(a), while setting X
to 1 gives the SWIG G(x = 1) in Figure 2(b). Notice that in addition to
splitting the X node, the node corresponding to Y in the original DAG has
been relabeled to indicate that it is now a potential outcome.
By applying d-separation to the graph in Figure 2(a), we directly obtain
that X ⊥
⊥ Y (0), since there are no edges emanating from the node containing
X, hence there are no paths from X to Y (0). Similarly, by applying dseparation to the graph in Figure 2(b) we derive X ⊥
⊥ Y (1).
We make a few remarks regarding the graphs in Figure 2: all black
nodes should be viewed as nodes in an ordinary DAG model (regardless of
their shape). The semi-circular shape of the nodes containing X merely
serves to remind us that this graph was derived by splitting X. The red
nodes are constants that take on a fixed value. We keep the red nodes
on the graph because their presence is needed to link the distribution of
the counterfactual variables on the SWIG to the distribution of the factual
x = x1 , . . . , xK , deterministic dynamic regimes and random dynamic treatment regimes;
see §5. In the case of a static regime, Robins (1989a, p.126) wrote P (Y = y | g = (x)).
Pearl’s notation for static regimes is identical except that g = (x) is replaced by the
equivalent do(X = x).
To translate the do/g notation into counterfactual notation we then equate P (Y =
y | g = (x)) to P (Y (x) = y) (See Robins, 1989b). Pearl’s ‘do’ notation is not as rich as the
language of potential outcomes as there is no way to directly express P (Y (x) | X = x0 ) in
terms of his ‘do’ notation. However, the g-notation of Robins (1986) does not suffer from
this inexpressiveness. Specifically, although Robins defined P (Y = y | g = (x), Z = z) to
be P (Y = y, Z = z|g = (x))/P (Z = z | g = (x)) (a notation adopted by Pearl replacing ‘g’
with ‘do’), Robins (1986) defined P (Y = y | g = (x), [Z = z]) to be P (Y (x) | Z = z). Thus
P (Y (x) | X = x0 ) can be obtained by taking Z to be X and z to be x0 .

7

X

Y (x = 0)

x=0

X

Y (x = 1)

x=1

(a)

(b)

Figure 2: The single world intervention graphs (SWIGs) resulting from splitting node X in the graph in Figure 1(a), and intervening to set a particular
value. (a) the SWIG G(x = 0) corresponding to setting X to 0; (b) G(x = 1)
given by setting X to 1.
variables on the original graph; see Section 3.6.3 for further details. These
nodes also play a central role in the analysis of dynamic regimes; see §5.

The factorization and modularity properties
In the same manner that the original DAG is associated with the joint
distribution P (X, Y ) we associate the graphs in Figure 2 (a) and (b) with
the joint distributions P (X, Y (0)) and P (X, Y (1)) respectively. Likewise,
we will associate the following factorizations with these graphs:
P (X = x, Y (0) = y) = P (X = x)P (Y (0) = y),
P (X = x, Y (1) = y) = P (X = x)P (Y (1) = y).

(3)

Notice that, if we ignore the red nodes, these factorizations are simply
instances of the standard DAG factorization (see (104) in Appendix A),
since in Figure 2(a) neither X nor Y (0) have any parents (besides the red
nodes). In addition, one can see that these factorizations are equivalent to
the independence conditions (2).
In addition we associate the following equation
P (Y (0) = y) = P (Y = y | X = 0) for all y

(4)

with the graphical transformation from G 7→ G(x = 0), and likewise
P (Y (1) = y) = P (Y = y | X = 1) for all y.

8

(5)

with the transformation from G 7→ G(x = 1). We refer to these equalities as
modularity7 conditions linking the distribution of the actual variables in the
DAG to the counterfactual variables in the SWIG.
Notice that these equations assert that the marginal distribution of Y
resulting from an intervention in which everyone receives the value x = 0
is the same as the corresponding conditional probability P (y | X = 0), and
likewise for x = 1.
Given the factorization (3), the modularity property follows directly from
the consistency condition: X = x implies Y (x) = Y . For example,
P (Y (0) = y) = P (Y (0) | X = 0) = P (Y = y | X = 0);

(6)

here the first equality uses the factorization, while the second follows from
consistency.
All NPSEM models satisfy consistency. In fact we will show that the
factorization and modularity properties associated with a SWIG hold for
an NPSEM associated with the original DAG when the errors have the
independence structure implied by an FFRCISTG model, and thus for its
more restrictive NPSEM-IE submodel.
The factorization and modularity properties are important because they
are sufficient for deriving many identifiability results. To give a simple example, these properties allow us to identify the Effect of Treatment on the
Treated (ETT):
ET T ≡ E[Y (1) − Y (0) | X = 1]
= E[Y (1) | X = 1] − E[Y (0) | X = 1]
= E[Y (1)] − E[Y (0)]
= E[Y | X = 1] − E[Y | X = 0].
Here the second equality follows from the factorizations with respect to the
two graphs in Figure 2, while the third follows from modularity, i.e. (4) and
(5).8

Single-worlds vs. multiple-worlds
The reader will notice that although we have constructed SWIGs representing the two single world distributions P (X, Y (0)) and P (X, Y (1)) we
7

Our usage of the term ‘modularity’ differs from that of Pearl Pearl (2009), though
they both derive from the same intuition.
8
When X takes more than two states, the factorization and modularity assumptions
associated with this graph imply that ET T (x) ≡ E[Y (x) − Y (0)|X = x] equals E[Y |X =
x] − E[Y |X = 0].

9

have not constructed a graph that includes both Y (0) and Y (1), and thus
represents the joint distribution P (X, Y (0), Y (1)). At first sight this might
strike the reader as odd, perhaps even an oversight. In fact, this is by design: in general observed data, including that resulting from randomized
experiments only identifies the marginal single-world counterfactual distributions for which we construct graphs. However, it is worth noting that the
independence restrictions that we encode may place inequality restrictions
on the (multiple-world) joint distribution (e.g. P (X, Y (0), Y (1))) over all
counterfactuals.9
As noted, the counterfactual independencies encoded in a SWIG are implied by the FFRCISTG and NPSEM-IE models. However, the NPSEM-IE
also encodes many additional cross-world restrictions on the joint distribution over all counterfactuals. These counterfactual independencies further
imply additional identification results. For example, Robins and Greenland (1992) introduced the Pure (or Natural) Direct Effect and showed it is
never identified non-parametrically from randomized experiments performed
on the variables on the graph. In contrast, Pearl (2001a) showed that it can
be identified by the mediation formula under the NPSEM-IE corresponding
to the graph in Figure 9(i).

Templates
Since it is cumbersome and somewhat redundant to construct a different
graph for every value to which we might set x, we may instead represent all
such graphs via a ‘template’, such as shown in Figure 3. However, we note
that in any instantiation of this template x should be viewed as taking a
specific value: whereas the (black) random nodes in the graph vary across
units in the (counterfactual) population being represented, the (red) fixed
nodes take the same value. Also note that the value taken by red nodes
such as x specify which particular random variables are represented by the
random nodes in the template, i.e. whether Y (x) represents Y (0) or Y (1).10
Again, to emphasize that each instantiation of a template only contains
variables from a single world, we refer to them as ‘Single World Intervention
Templates’ or ‘SWITs’.
9

There can exist extreme distributions for which some of the inequality constraints
become equalities (Pearl, 2000, 2009, §8.2).
10
In this respect the graph differs from standard graphical models, including the conditional acyclic directed mixed graphs (CADMGs) introduced in Shpitser et al. (2011).
Though CADMGs include fixed nodes, in a CADMG these nodes do not determine which
other variables appear on the graph. In other words, CADMGs are not templates.

10

x

X

Y (x)

Figure 3: A template representing the two graphs in Figure 2.
H

x

X

Y (x)

Figure 4: The template resulting from intervening on X in the graph in
Figure 1(b).

A new graphical view of the back-door formula
In Figure 4 we show the template representing the graphs resulting from
intervening on X in the graph in Figure 1(b), which intuitively represents the
presence of confounding. In the potential outcomes literature, confounding
is expressed as non-independence of Y (˜
x) and X for some x
˜. This lack
of independence is consistent with Y (x) and X being d-connected in the
template shown in Figure 4 by the path X ← H → Y (x).
In contrast, Figure 5(a) shows a DAG in which L is observed, and is
sufficient to control confounding between X and Y . From the template in
Figure 5(b) we see that
X⊥
⊥Y (˜
x) | L,
(7)
often referred to as conditional ignorability, holds. It is well known that this
condition is sufficient for the effect of X on Y to be given via the standard
adjustment formula:
X
P (Y (˜
x) = y) =
P (Y = y | L = l, X = x
˜)P (L = l).11
(8)
l

Two further examples of graphs which imply X⊥
⊥Y (˜
x) | L are shown in
Figure 6; in these graphs H represents a hidden variable.
11

This is also a special case of Theorem 22 in Section 4.

11

L

X

L

Y

X

(a)

L

x

Y (x)

X

(b)

Y
(c)

Figure 5: Adjusting for confounding. (a) The original causal graph. (b) The
template G(x), which shows that Y (x)⊥
⊥X | L. (c) The DAG GX obtained
by removing edges from X advocated in Pearl (1995, 2000, 2009) to check
his ‘backdoor condition’.
Notice that here we are able to use the graph G(˜
x) to represent the
distribution P (Y (˜
x), X, L) in the general case where X has an effect on Y .
We contrast this line of graphical reasoning with that advocated in (Pearl,
2000, 2009, p.87) in which d-separation of X and Y given L is checked in
the graph GX obtained by removing the edges that are directed out of X;
see Figure 5(c). When L is a non-descendant of X this graphical criterion is
equivalent to ours, so that X is d-separated from Y given L in GX if and only
if X is d-separated from Y (˜
x) given L in G(˜
x); hence validity of his criterion
is not at issue. However, the graph GX only represents the null hypothesis
that X does not causally affect Y . It is only under this null hypothesis that
X⊥
⊥Y | L, corresponding to the d-separation of X and Y given L that holds
in Figure 5(c). Thus the graph GX does not appear to offer an explanation
as to why d-separation of X and Y given L in GX should ensure that (8)
holds (even though it does) when X has an effect on Y .
Furthermore, in the general case where we are considering whether we
may use the natural extension of (8) to a set of variables L:

P (Y (˜
x) = y) =

X

P (Y = y | L = l, X = x
˜)P (L = l),

(9)

l

the backdoor criterion (Pearl, 2000, 2009, p.70) requires that in addition
to X and Y being d-separated given L in GX , no variable in L may be
a descendant of X; see (Shpitser et al., 2012) for further discussion. The
reason for this additional condition is not transparent, since the inclusion of

12

H

H

H
L

X

L

Y
(a-i)

X

H
L

L

x

Y (x)

X

(a-ii)

Y

X

(b-i)

x

Y (x)

(b-ii)

Figure 6: Further examples of adjusting for confounding. (a-i) A graph G;
(a-ii) the template G(x); (b-i) A graph G 0 ; (b-ii) the template G 0 (x). H is
an unobserved variable in G and G 0 . Both SWITs imply Y (x)⊥
⊥X | L.
such a variable does not preclude that X and Y may be d-separated in GX .12
Within the framework given here there is no need to state this additional
condition.
Using SWIGs we have the simple adjustment criterion:
Counterfactual Adjustment Criterion
If X⊥
⊥Y (˜
x) | L is implied by the SWIG G(˜
x), then
X
P (Y (˜
x) = y) =
P (Y = y | L = l, X = x
˜)P (L = l).
l

Notice that we require no restrictions on the membership in L. The reason
why is illustrated in Figure 7. In the causal graph shown in Figure 7(a), L1
is necessary and sufficient to control confounding, but {L1 , L2 } is not. It
may be seen directly from inspecting the template in Figure 7(b) that
X⊥
⊥Y (˜
x ) | L1 ,

X⊥
⊥Y (˜
x) | L1 , L2 (˜
x)

but the template does not imply X⊥
⊥Y (˜
x) | L1 , L2 . Moreover, this independence is not implied by any template constructed from G.13
12
Pearl (2009, §11.3.3, p.344) acknowledges that the need to restrict to non-descendants
is not transparent in his original derivation, and offers an alternative. However, this
reformulation requires two different independence relations to be checked.
13
As expected, we can construct a distribution under the FFRCISTG model, and in
fact in the NPSEM-IE model under which X⊥
⊥Y (˜
x) | L1 , L2 is not true. That this
independence is not implied by an NPSEM-IE associated with the graph in Figure 7(a)
could also be deduced by constructing a counterfactual graph (Shpitser and Pearl, 2007,
2008) to test X⊥
⊥Y (˜
x) | L1 = l1 , L2 = l2 .

13

In contrast, under the non-counterfactual formulation of the back-door
criterion (Pearl, 2000, 2009, p.78), in which the graph GX is formed as
in Figure 7(c) an additional condition must be added, requiring that no
member of L is a descendant of X. This extra condition is required because,
as noted earlier, GX represents the null hypothesis of no effect of X on Y .

The Advantages of Completeness
The next example shows that the completeness of d-separation for the variables arising on a SWIG can prevent errors. Pearl (2009, Ex. 11.3.3) claims
that under the NPSEM associated with the causal DAG in Figure 15(a) the
following conditional independence does not hold:
Y (x0 , x1 )⊥
⊥X1 | Z, X0 = x0 .

(10)

Pearl concludes from this that a claim of Robins is false because if the claim
were true then (10) would hold. However, direct inspection of the SWIG
shown in Figure 15(b) shows that (10) is indeed true under this NPSEM, and
that Pearl is thus incorrect. Specifically, we see by examining the template
G(x0 , x1 ) shown in Figure 15(b), that:
Y (x0 , x1 )⊥
⊥X1 (x0 ) | Z(x0 ), X0 ,

(11)

from which it follows that
Y (x0 , x1 )⊥
⊥X1 (x0 ) | Z(x0 ), X0 = x0 .

(12)

This last condition is then equivalent to (10) via the counterfactual consistency condition. Pearl made the following error. He correctly states that
Y (x0 , x1 ) is not independent of X1 , given Z and X0 .
However, he then goes on to mistakenly say:
Therefore, [(10)] is not satisfied for Y (x0 , x1 ) and X1 .
As we have seen, reasoning with SWIGs immunizes us against this sort of
error. See §4.2 for the context and implications of this error; Appendix D.4
for an exegesis and other related errors in Pearl (2000).

Overview
We now give a brief overview of the development in the remainder of the
paper:
14

L1

X

L1

Y
(a)

X
L2

L1

x

Y (x)

X
L2 (x)

(b)

Y
(c)

L2

Figure 7: Simplification of the backdoor criterion. (a) The original causal
graph G. (b) The template G(x), which shows that Y (x)⊥
⊥X | L1 , but does
not imply Y (x)⊥
⊥X | {L1 , L2 } when there exists an arrow from X to Y ,
i.e. the null hypothesis is false. (c) The DAG GX obtained by removing
edges from X advocated in Pearl (2000, 2009).
SWIGs for NPSEMs with FFRCISTG independence
In Section 3 our starting point is a non-parametric structural equation model
(NPSEM) that is naturally associated with the DAG G (with node set V
comprising a set of ‘factual’ variables): Each random variable V ∈ V is
expressed as an arbitrary function fV of the variables that are the parents
of V in the graph together with an error term εV . Given a distribution
over the error terms, the equations then specify a joint distribution over
V. We impose on these error terms the independence assumptions of the
FFRCISTG model of Robins (1986); Robins and Richardson (2011). As we
shall see, these assumptions are much weaker than the NPSEM-IE model
of Pearl (2000, 2009), which requires that the error terms associated with
different variables be independent. The latter assumption is not (even in
principle) testable by any randomized experiment.
Suppose now we are given a set of treatment variables A ⊆ V; we
will let V(˜
a) represent the set of counterfactual variables (corresponding to
the actual variables V) associated with a specific hypothetical intervention
setting A to ˜
a. The resulting counterfactual distribution P (V(˜
a)) is obtained
from the NPSEM by simply replacing each variable Ai ∈ A by the value
assigned a
˜i in the function fV for any variable V of which Ai is a parent
in G. In the usual NPSEM framework it is (implicitly) assumed that all
variables may (in principle) be intervened upon, and that all of the resulting
counterfactuals are well-defined. Though we adopt this assumption for much
of our development, we subsequently relax it and show that our main results

15

continue to hold (see §8 and discussion below).
In Section 3.3 we give a general graphical transformation algorithm that,
given G and an assignment ˜
a to A as input, constructs a SWIG G(˜
a) containing counterfactual nodes V(˜
a) and fixed nodes ˜
a. Given a different assignment a† to A, our algorithm will generate a SWIG G(a† ) with a different
node set V(a† ) ∪ a† . We may represent the collection of all such SWIGs via
a template G(a), which formally can be seen as a graph-valued function: it
takes an assignment ˜
a to A as input and returns a graph G(˜
a).
We prove in Propositions 11 and 16 that the distribution P (V(˜
a)) of the
counterfactuals V(˜
a) that are vertices in the SWIG G(˜
a) under the FFRCISTG NPSEM satisfies two important properties that we call factorization
and modularity:
The property of ‘factorization’ is simply that the (marginal) distribution P (V(˜
a)) over the counterfactual variables present in the SWIG
factors according to the respective G(˜
a). This property is equivalent
to the global Markov property, aka d-separation; see §3.5.
The ‘modularity’ property is that the conditional distribution associated with a counterfactual variable Y (˜
a), given its parents in G(˜
a) is
obtained from the conditional distribution of Y given its parents in G;
see §3.6. Formally, modularity may be seen as imposing a link between
two sets of distributions that factor with respect to different graphs
(G(˜
a), P (V(˜
a))) and (G, P (V)).
We will show that many important results and properties follow directly
from the properties of factorization and modularity alone. In particular,
these properties hold if and only if the joint density P (V(˜
a)) is equal to
a specific function of the joint distribution of the factuals: the extended
g-formula density of Robins et al. (2004, p.2222); see (37) below.14 Since
the NPSEM-IE is a submodel of the FFRCISTG model of Robins (1986)
(associated with the same graph), it follows that the NPSEM-IE also satisfies
factorization and modularity.
In Section 11.3.7 of his second edition Pearl (2009) offers three critiques
of the g-formula based methodology developed in Robins (1986, 1987) for
estimation of the causal effects of time-varying treatments. In Section 4
we demonstrate that all of Pearl’s claims are either erroneous or based on
misconceptions. In Section 4.1 we provide the necessary background by
14

The ‘g-formula’ is also referred to as the ‘g-computation formula’.

16

reviewing Robins’ g-formula methodology with the aid of SWIGs . In Section
4.2 we show that Pearl’s claims are erroneous: two of the false claims are the
direct result of mathematical errors made by Pearl; the third is the result
of Pearl’s misreading or lack of awareness of an example in Robins (1986).
In Section 5 we show how our graphical formalism may be easily extended
to represent dynamic regimes. This includes regimes where treatment assignment depends on the value that a variable would have in the absence of
an intervention. For example, consider the regime ‘Exercise for as long as
you would have done without intervention or twenty minutes, whichever is
more’. We show how the identification results described in §4.2 generalize
to this setting.

NPSEMs with population-level exclusion restrictions
As we have mentioned, the motivation for adopting the FFRCISTG model,
rather than the NPSEM-IE is in large part driven by epistemic considerations: there is no randomized experiment that may be performed (even
in principle) to verify the independence assumptions that are made by an
NPSEM-IE. However, this same criticism may also be made regarding the
assumptions associated with the absence of a directed edge in an NPSEM
even under the FFRCISTG assumptions.15
As we have described above, in an NPSEM each variable is given by a
function fV expressed as an arbitrary function of the variables that are its
parents in the graph, together with an error term.16 Thus the absence of an
edge in a DAG G implies that there is no individual level direct effect, also
known as an exclusion restriction. However, there is no consistent test for
the absence of an individual level effect, from randomized experiments. This
is because it is only the average or population-level effect that is identified,
and it is possible for the population level effects to be zero, and yet the
individual level effects to be non-zero.17 Thus although the FFRCISTG
assumptions relating to independence of errors in the NPSEMs considered
in §3 and (Robins and Richardson, 2011) may be verified via randomized
experiment this is not true of the restrictions relating to the absence of direct
effects in these models.18 To make this issue concrete, we will show a simple
15

A point also noted by Pearl (2010) in a response to (Robins and Richardson, 2011).
As noted above, the FFRCISTG and NPSEM-IE differ regarding the independence
assumptions that they impose on the distribution of the errors.
17
In the simple case of a binary treatment A and binary response Y this corresponds to
the situation in which there are equal, but non-zero, proportions of patients who are helped
and hurt, so that P (Y (a = 0) = 0, Y (a = 1) = 1) = P (Y (a = 0) = 1, Y (a = 1) = 0) 6= 0.
18
In graphical terms, the NPSEM FFRCISTG models of §3 and (Robins and Richardson,
16

17

graph under which the Effect of Treatment on the Double Treated
E[Y (a1 = 1, a2 = 1) − Y (a1 = 0, a2 = 0) | A1 = 1, A2 = 1]

(13)

is identified via individual-level exclusion restrictions, yet fails to be identified under population-level exclusions. Were we to assume the absence of
an individual-level effect, when this was not the case, then we could draw
erroneous inferences, and yet there would be no randomized experiment that
would allow us to detect this error.19
In section 7 we address this epistemological issue by constructing a counterfactual theory that interprets the absence of an edge in a graph in terms
of the absence of a population level direct effect. In other words, the absence
of an edge from X to Y implies that interventions on X will have no effect
on the distribution of Y , but does not assume that Y (x) = Y (x0 ), so that
there may still be an effect at the individual level.
Our theory still assumes an underlying NPSEM, but does not assume
that missing edges in the graph imply the absence of variables from equations
in the NPSEM. Thus the relationship between the DAG and the NPSEM in
this theory differs from the standard approach: missing edges in the DAG
do not lead to variables being omitted from equations in the NPSEM. Fortunately, accommodating this weaker interpretation of missing edges requires
only a minor change to the SWIG construction procedure (in fact, the resulting construction is simpler!). Since the resulting distributions P (V(˜
a))
implied by the NPSEM will still obey modularity and factorization with respect to G(˜
a), the theory developed in Section 4 in the traditional NPSEM
setting – where the absence of an edge corresponds to the absence of an
individual direct effect – goes over to this more general context with very
little change.20
Counting the untestable assumptions implied by an NPSEM-IE
In Section 6 we conclude our comparison of the FFRCISTG and NPSEMIE independence assumptions by counting the dimension of the associated
2011) require experimentally verifiable conditions for the absence of ‘confounding arcs’ (↔)
but not for the absence of directed edges (→).
19
Thus the Effect of Treatment on the Double Treated plays the same role in the FFRCISTG theory with individual-level exclusions that the Pure Direct Effect plays for the
NPSEM-IE. Namely, it is a causally interpretable quantity that is identified via assumptions that are not experimentally testable.
20
These SWIGs may also be seen as indicating that Pearl’s ‘causal hierarchy’ that ties
counterfactuals to individual level exclusion restrictions is an oversimplification.

18

counterfactual models in the case of complete graphs with binary variables.
This reveals that the NPSEM-IE model imposes super-exponentially more
independence assumptions that are experimentally untestable. This leads
us to question whether NPSEM-IEs and potential outcomes are functionally
‘equivalent’ theories as is claimed by (Pearl, 2000, 2009, 2012a). In particular, the FFRCISTG model is a simple and natural potential outcome model
whose conditional independence structure cannot be faithfully represented
by any NPSEM-IE.
Ontological Issues
As stated earlier, the issues relating to independence assumptions and exclusion restrictions are epistemic: if there is no experiment that can be
performed (even in principle) to verify a particular assumption, then one
might naturally be concerned about its adoption.
However, it may be the case that one does not think that the counterfactual corresponding to an intervention on a particular variable is welldefined.21 Therefore in Section 8 we consider the situation in which interventions are only defined on a strict subset of variables, so that not all the
counterfactual variables that would be implied by an NPSEM exist. We
show that SWIGs may easily be applied in this setting. We discuss but
leave open the question as to the meaning of directed edges emanating from
variables that cannot be intervened upon.
In Section 9, we consider an even more restrictive ontological position
whereby no counterfactuals are assumed to exist. We define an extended
agnostic model (equivalently extended causal Bayes net), and show that our
SWIG (under a suitable labeling) describes the structure of intervention
distributions. Thus the graphical structure of a SWIG together with its
associated factorization and Markov property naturally arises in the context
of a purely interventional theory.
Appendices
In Appendix A we review graphical models based on directed acyclic graphs,
specifically the concept of d-separation. Appendix B contains some techni21

In the analysis of mediation and ‘censoring by death’ considerations of this kind have
motivated the use of so-called ‘principal-stratum direct effects’ introduced in (Robins,
1986, Sec. 12.2), but named and popularized by Frangakis and Rubin (2002) as an alternative to ‘controlled direct effects’ since the latter, but not the former, require well-defined
interventions on intermediate variables; see (Robins and Richardson, 2011) §2.3 for further
discussion.

19

5

D

7

C

6
4

B

8
9

3

A
Figure 8: Organization of the paper.

cal proofs. Appendix C revisits several additional classes of counterfactual
model introduced in Robins (1986), using SWIGs to illustrate the relevant
distinctions. In Appendix D we give review the different proposals to unify
graphs and counterfactuals presented in Pearl (2000) and Pearl (2009). We
also chronicle a number of problems that have arisen in specific applications
owing to the presence of deterministic relationships and context specific independence relations present in these graphs.

20

3

SWIGs applied to NPSEMs

In this section we develop the theory of SWIGs in the context of a nonparametric structural equation model. Throughout this section we will relate
NPSEMs and graphs in the usual way: there is an equation for each variable
in the model, specifying that variable as a function of its parents in the
graph. Thus the absence of an edge X → Y in a graph G indicates the
absence of a direct effect at the individual level, corresponding to the absence
of X from the function fY in the structural equation for Y .22

3.1

Counterfactual Existence Assumptions

Let V be an underlying set of random variables. Throughout Section 3, we
will assume that every variable V ∈ V may be intervened upon.23 Thus we
will assume the counterfactual V(˜r) for any assignment ˜r to a subset R ⊂ V
exists and is defined as follows:
Definition 1 (NPSEM Counterfactual Existence Assumption).
fa to paG (V ), the parents of
(i) For each variable V ∈ V and assignment p
V in G, we assume the existence of a counterfactual variable V (f
pa).
(ii) For any set R, with R 6= paG (V ), V (˜r) is defined recursively via:


V (˜r) = V ˜r(paG (V )∩R) , (PAV \ R)(˜r) ,
(14)
where (PAV \ R)(˜r) ≡ {V ∗ (˜r) | V ∗ ∈ paG (V ), V ∗ ∈
/ R}.
Note that if R contains all of the parents of V then assumption (ii) implies V (˜r) = V (˜r(paG (V )∩R) ). Thus if we are intervening on all the parents of a variable then interventions on any other variable are irrelevant.
This is referred to as the individual level ‘exclusion restriction’; see Rule 1
in Pearl (2000, 2009), p.239. In addition, A(˜
a) = A, and more generally
A(˜
r) = A(˜
rR\{A} ). This usage fits with the conception that A represents
the ‘natural’ level of treatment that the patient would receive if they were
not being assigned the value a
˜.
Assumption (ii) combines the assumptions described in other works as
‘consistency’ and ‘recursive substitution’.24 These assumptions are common
to both the NPSEM-IE model and the FFRCISTG model.
22
In Section 7 we will consider graphs under a weaker causal interpretation whereby a
missing edge corresponds merely to the absence of a direct effect at the population level.
23
We will relax this assumption in the Section 8.
24
See also the ‘composition’ property in Pearl (2000, 2009), p.229.

21

We may view the counterfactuals V (f
paV ), in condition (i) as primitives, from which all others are derived. For a given V the collection25 of
faV } may equivalently be represented via
such counterfactuals {V (f
paV ) | p
a structural equation:
V (f
paV ) = fV (f
paV , V ),

(15)

where V is an error term.26
3.1.1

Examples

Consider the DAG in Figure 9(i) which is associated with the following
structural equations:
Z = fZ (Z ),
M (z) = fM (z, M )
Y (z, m) = fY (z, m, Y )
by (i) in the Counterfactual Existence Assumption. These equations define
the counterfactual variables Z, M (z) and Y (z, m). Condition (ii) implies
the following equalities hold for all values of z, m, y:
Z(m, y) = Z,
M (z, y) = M (z),

Z(m) = Z,
M (y) = M (Z).

(16)

Note that these restrictions simply express the concept that the future does
not cause the past. Similarly, for all m and z we have the following:
Y (m) = Y (m, Z),
Y (z) = Y (z, M (z)),
Y = Y (Z, M (Z)).
By contrast the DAG in Figure 10(i) would be associated with the following
structural equations:
Z = fZ (Z ),

M (z) = fM (z, M ),

Y (m) = fY (m, Y ),
25
Formally, a stochastic process to allow there to be uncountably many assignments
f m.
pa
26
f V ) | pa
f V } we may trivially obtain such a representation by defining the
Given {V (pa
error term V to be this set and fV to be such that fV (paV , V ) ≡ (V )paV = V (paV ).

22

which define the variables Z, M (z) and Y (m). The equalities (16) continue
to hold but for Y we now have:
Y (z) = Y (M (z)),
Y = Y (M (Z)),
Y (z, m) = Y (m).
Note that the last equality here expresses the absence of a direct effect (at
the individual-level) of Z on Y .

3.2

Definition of the FFRCISTG and NPSEM-IE models

The models that we consider correspond to sets of distributions over the set
of counterfactuals whose existence is given by Definition 1.
Distributions in the FFRCISTG model will in addition make the following independence assumption. For every v† we assume that given an
intervention v† to every variable in V, the corresponding counterfactuals
V (pa† ) will be mutually independent. Formally we make the following:
Definition 2 (FFRCISTG Independence Assumption27 ).

n

†
For every v† , the variables V (pa†V )  V ∈ V, pa†V = vpa

G (V

o
)

(17)

are mutually independent.
The NPSEM-IE model is the submodel of the FFRCISTG obeying the
stronger independence assumption:28
Definition 3 (NPSEM-IE Independence Assumption).
The variables {V | V ∈ V} are mutually independent.
This is equivalent to:

o
n

The sets of variables {V (pa†V ) | for all pa†V }  V ∈ V

(18)

are mutually independent.
It is not hard to see that (18) implies (17), but not vice versa. We will
investigate this distinction in much greater detail in Section 6 below. In
the form stated here, neither assumption is particularly easy to interpret.
However, we will see below that the logical implications of (17) are captured
via the associated SWIGs.
27

Robins and Richardson (2011) prove that the set of independences (17) is equivalent
to the set of counterfactual independence relations used in the definition of the FFRCISTG appearing in Robins (1986) and Robins and Richardson (2011); see Definition 62
in Appendix C.
28
See Pearl (2000, 2009) p.101, (3.56) and footnote 14, and p.239 Rule 2.

23

3.2.1

Examples

The FFRCISTG Independence Assumption for the graph in Figure 9(i) requires that for each pair of values z, m, the following three variables are
jointly independent:
Z⊥
⊥ M (z) ⊥
⊥ Y (z, m).
Thus, in particular if Z and M are binary, then the FFRCISTG assumption
requires the following four joint independences:
Z⊥
⊥M (z = 0)⊥
⊥Y (z = 0, m = 0),

Z⊥
⊥M (z = 0)⊥
⊥Y (z = 0, m = 1),

Z⊥
⊥M (z = 1)⊥
⊥Y (z = 1, m = 0),

Z⊥
⊥M (z = 1)⊥
⊥Y (z = 1, m = 1).

In contrast the NPSEM-IE Independence Assumption requires that the following sets of variables are jointly independent:
Z⊥
⊥ {M (z) for all values of z} ⊥
⊥ {Y (z, m) for all values of z, m}
Thus if Z and M are binary then the NPSEM-IE assumption requires the
following joint independence:
Z⊥
⊥ {M (z = 0), M (z = 1)} ⊥
⊥ {Y (z = 0, m = 0), Y (z = 0, m = 1),
Y (z = 1, m = 0), Y (z = 1, m = 1)}
For example, the NPSEM-IE implies that M (z)⊥
⊥Y (z 0 , m) while this is not
implied by the FFRCISTG assumption.
Likewise for the DAG in Figure 10(i), the FFRCISTG assumption implies:
Z⊥
⊥M (z)⊥
⊥Y (m), for each pair of values (z, m),
while the NPSEM-IE assumption requires:
Z⊥
⊥ {M (z) for all values of z} ⊥
⊥ {Y (m) for all values of m}.

3.3

The template G(a) for intervention on set A

We now describe the procedure for constructing a Single-World Intervention
Template (SWIT), denoted G(a). An instantiation of the template, will be
a Single-World Intervention Graph (SWIG), denoted G(˜
a). The node set for
G(˜
a) consists of the set of potential outcome variables corresponding to a
single hypothetical intervention setting A to ˜
a, together with a set of fixed
vertices ˜
a. G(˜
a) encodes counterfactual independence relations that will
24

hold among the set of potential outcome variables V(˜
a) under an NPSEM
obeying the FFRCISTG assumption (17). Since the NPSEM-IE independence assumption (18) implies the FFRCISTG assumption (17), it further
follows that any independence relation given by G(˜
a) will also hold under
this submodel.
3.3.1

Construction of Single-world Counterfactual Templates
(Individual-level exclusions)

The SWIT G(a) resulting from intervening to set the variables in A to a in
a directed acyclic graph G with vertex set V is constructed in two steps as
follows:
(1) Split Nodes: For every A ∈ A split the node into a random and fixed
component, labelled A and a respectively, as follows:
···
···
A

⇒

A
a

···
···
Splitting: Schematic Illustrating the Splitting of Node A
Thus the random half inherits all edges directed into A in G; the fixed
half inherits all edges directed out of A.
Let the resulting graph be G ∗ . For each random vertex V in G ∗ , let
aV denote the subset of fixed vertices that are ancestors of V in G ∗ .
(2) Labeling: For every random node V in G ∗ , label it with V (aV ) (see
the schematic below).
It is implicit here that if aV = ∅ then V (aV ) = V . The resulting graph
is the SWIT G(a). Let V(a) ≡ {V (aV ) | V ∈ V} be the set of random
vertices in G(a).
Note that by convention we will use aV to denote the set of fixed nodes
labeling the counterfactual node corresponding to V in a SWIT G(a). Note
that this is the set of fixed nodes that are ancestors of the counterfactual
node corresponding to V after having split every node in A.
25

···

···

T (. . .)

T

···

···

X

A

X(. . .)

Y

⇒

a

Y (. . .)

a

···

C

B

A(. . .)

B(a, . . .)

C(a, . . .)

···

Z

Z(. . .)

D
E

D(a, . . .)
F

E(a, . . .)

···

F (a, . . .)

···

labeling: Schematic showing the nodes V (aV ) in G(a) for which a ∈ aV .
An instantiation G(˜
a) of G(a) results from choosing a specific assignment
of values ˜
a for the ‘free variables’ a in G(a), and appropriately replacing each
occurrence of ai with a
˜i within the label for a vertex. Let A denote the set
of all possible instantiations of a. Formally a template G(a) may be viewed
as a graph valued function defined on the domain A. From this perspective
˜
a represents a specific input, and G(˜
a) the corresponding output.
3.3.2

Examples of SWITs

We illustrate the construction of templates via three examples in Figure 9, a
complete DAG corresponding to the situation where M ‘mediates’ the effect
of a treatment Z on a response Y , and there is no confounding, and three
in Figure 10, where we further assume that there is ‘no direct effect’ of Z
on Y , at the individual level, so that Y (˜
z , m)
˜ = Y (m).
˜
The subsets of a labeling each vertex are summarized in Table 1. Note
that in the templates in Figure 9, since Y is a descendant (in fact, child)
of both Z and M in all three graphs, Y is labelled with all variables that
are intervened on. Thus in template (iv) in Figure 9 aY = a = {z, m}. In
contrast, in template (iv) in Figure 10, where both Z and M are intervened
on, so a = {z, m}, we have aY = {m} since after splitting M , Y is no longer
a descendant of Z.

26

(i): G

(ii): G(z)

Z

M

z

Z

(iii): G(m)

Z

(iv): G(z, m)

Z

Y

Y (z)

M (z)

M

z

m

M (z)

m

Y (m)

Y (z, m)

Figure 9: (i) A DAG G with treatment (Z), mediator (M ) and response (Y )
in the absence of confounding. Templates: (ii) G(z); (iii) G(m); (iv) G(z, m).

a

Figure 9

Figure 10

(ii)

{z}

aZ = ∅; aM = aY = {z}

aZ = ∅; aM = aY = {z}

(iii)

{m}

aZ = aM = ∅; aY = {m}

aZ = aM = ∅; aY = {m}

(iv)

{z, m}

aZ = ∅; aM = {z}; aY = {z, m}

aZ = ∅; aM = {z}; aY = {m}

Table 1: The sets labeling nodes in the SWITs in Figures 9 and 10.

27

(i): G

(ii): G(z)

Z

M

z

Z

(iii): G(m)

Z

(iv): G(z, m)

Z

Y

M (z)

M

z

M (z)

Y (z)

m

m

Y (m)

Y (m)

Figure 10: (i) The DAG G from Figure 9 under the additional assumption
that there is no direct effect of treatment (Z) on the response (Y ). Templates: (ii) G(z); (iii) G(m); (iv) G(z, m).

28

3.3.3

Graphical Properties of SWITs

The next three Propositions follow immediately from the construction procedure.
Proposition 4. In G(a), every node Y (aY ) that is a descendant of a fixed
node ai , is labelled with ai , so ai ∈ aY .
Proposition 5. There is a one-to-one correspondence between random vertices in G(a) and vertices in G given by Y 7→ Y (aY ).
Proposition 6. There is a one-to-one correspondence between edges in G
and edges in G(a):
(
x → Y (aY ) in G(a) if X ∈ A;
X → Y in G
7→
(19)
X(aX ) → Y (aY ) in G(a) if X ∈
/ A.
(Recall that it is possible that aV = ∅, in which case V (aV ) = V .)
Proof: This follows since neither the process of node splitting nor labeling
removes any edges that were present in G.
2
In what follows we will use blackboard bold, e.g. B(a) to refer to the
set of random vertices in G(a) corresponding to a given set B in G, so that
B(a) ≡ {B(aB ) | B ∈ B}, and similarly for other sets.
When a node A is split, those vertices that, prior to the transformation
had A as a parent, now have the fixed vertex a as a parent. It thus follows that in G(a) the parents of a random vertex V (aV ) that are not fixed,
correspond to those parents of V in G that are not in A:
Proposition 7. In G(a), the set of parents of Y (aY ) that are random consists of the vertices in G(a) corresponding to vertices in paG (Y ) \ A.29 This
may be expressed as follows:
{V (aV ) | V (aV ) → Y (aY ) in G(a)} = paG,Y (a) \ A(a),
where: paG,Y ≡ paG (Y ), paG,Y (a) ≡ {V (aV ) | V ∈ paG (Y )}, and A(a) ≡
{V (aV ) | V ∈ A}. Equivalently it may be written:
paG,Y (˜
a) \ A(˜
a) = {V (˜
aV ) | V ∈ paG (Y ) \ A}.
29

Note that in our notation for any graph G, paG (Y ) is a set of random variables,
the parents of Y in G. In particular although pa(·) is lower case this is a set of random
variables, not an instantiation of this set.

29

We will also need the following:
Proposition 8. If X(aX ) → · · · → Y (aY ) in G(a) then aX ⊆ aY .
Proof: Immediate by the definition of aV since any fixed vertex that is an
ancestor of X(aX ) in G(a) is also an ancestor of Y (aY ).
2
For examples of this Proposition where aX ⊂ aY see the nodes the nodes
L and Y (x) in Figure 5(b), also L2 (a1 ) and Y (a1 , a2 ) in Figure 14(b) below;
for examples where aX = aY see the nodes M (z) and Y (z) in Figures 9(ii)
and 10(ii) below.
Proposition 9. In G, let Ai be the vertex in G corresponding to a fixed node
ai ∈ aV , the set labeling V (aV ) in the SWIT G(a). Then Ai is an ancestor
of V in G; further, there is a directed path from Ai to V on which no other
vertex is in A.
Proof: If ai ∈ aV then there is a directed path from ai to V in G ∗ , the
graph resulting from the node splitting step. Since this directed path is still
present in G ∗ , it was also present in G, and no node on that path is in A,
since otherwise the directed path would not be present in G ∗ .
2

3.4

The interpretation of node labels in G(˜
a)

Formally, a vertex containing V (˜
aV ) in a SWIG G(˜
a) should be viewed as
representing an equivalence class of counterfactual variables that are equal
for every unit in the population. Specifically, the node V (˜
aV ) in the SWIG
G(˜
a) represents the set:
n
o
V (˜
aV , b† ) | B ⊆ (A \ (AV ∪ {V })) .
(20)
Thus, in words, V (˜
aV ) in G(˜
a) represents the set of counterfactual variables
˜V to the variables in the subset of treatments AV
resulting from assigning a
that are (proper) ancestors of V (aV ) in G(a) and assigning any other value
to any subset of the other treatments in A.
The set (20) captures equalities that arise both from the constraints of
time order, i.e. that later treatments cannot affect earlier counterfactuals,
and from the absence of direct effects, relative to the other treatment variables in A, as reflected in the set of structural equations.
The subset AV ⊆ A is the minimal subset of treatments sufficient to
ensure that V (a† ) = V (a†V ) for every a† and every unit of the populations.
There may be situations in which we might find it useful to label a node with
30

another variable from the class (20); however, in this paper we will always
use the minimal subset as the label. This allows us to unify the semantics for
SWIGs representing individual level and population level exclusion restrictions, given in §7. (Under the population interpretation, equalities between
counterfactuals will only arise due to considerations of time-order.)
For most purposes it is sufficient to think of a node V (˜
aV ) in a SWIG
as (solely) representing V (˜
aV ).
3.4.1

Examples of equalities implied by node labels

Consider a SWIG G(m)
˜ that is an instantiation of the template in Figure
9(iii). Formally the node Z in G(m)
˜ represents the equivalence class of
variables
{Z} ∪ {Z(m0 ), for any m0 }.
(21)
This set of variables may be seen as capturing the requirement that the
future does not affect the past.
For a second example, consider a SWIG G(˜
z , m)
˜ that is an instantiation
of the template in Figure 10(iv), derived from a DAG in which there is no
Z → Y edge. In G(˜
z , m)
˜ the node labelled Y (m)
˜ represents the equivalence
class of variables:
{Y (m)}
˜ ∪ {Y (z 0 , m),
˜ for any z 0 }.

(22)

The equality of the counterfactuals in this class follows from the assumption
present in the original NPSEM that there is no individual level direct effect
of Z on Y .
Note that under an NPSEM model the equality (for every unit of the
population) of the variables within each of the classes (21) and (22) follows
from the equations given in §3.1.1, which were themselves consequences of
Definition 1(ii).

3.5

The factorization associated with G(˜
a)

We associate the following factorization criterion with a SWIG:
Definition 10. A joint distribution P (V(˜
a)) factorizes with respect to a
SWIG G(˜
a) if
Y


P (V(˜
a)) =
P Y (˜
aY )  paG,Y (˜
a) \ A(˜
a) ,
(23)
Y ∈V

31

whenever the right hand side is well-defined. Here
paG,Y (˜
a) \ A(˜
a) = {V (˜
aV ) | V ∈ paG (Y ) \ A}.
In words, this definition means that the distribution over the random vertices
V(˜
a) in G(˜
a) factors into a product of conditional densities, one for each
random vertex. The density for Y (˜
aY ) conditions on the set of random
vertices V (˜
aV ) that correspond to vertices V in G, that are not in A, but
are parents of Y . Observe that in (23) the parents of Y that are in A (and
hence are intervened upon in G(˜
a)) have been removed from the conditioning
set for Y (˜
aY ) in G(˜
a).
Note that the factorization (23) corresponds exactly to the factorization
associated with an instantiation G(˜
a) of G(a), if we were to remove the
fixed vertices, but otherwise view it as a conventional DAG model for the
counterfactual distribution; see Appendix A for a review. To make this
clear, notice that we may re-write (23) as:



Y

P (V(˜
a)) =
P Y (˜
aY )  paG(˜a) (Y (˜
aY )) \ ˜
a .
Y (˜
aY )∈V(˜
a)

Also notice that by taking A = ∅, Definition 10 includes the usual factorization of P (V) with respect to G as a special case; see (104).
The relationship between the FFRCISTG model and the factorization
(23) is given by the following:
Proposition 11. Under the FFRCISTG model associated with G P (V(a† ))
factorizes according to G(a† ).
We prove this in conjunction with Proposition 16 that establishes the modularity property; see Appendix B.1.
3.5.1

Examples of the Factorization

Instantiations of the templates shown in Figure 9 are associated with the following factorizations (we include the original factorization for comparison):
G:

P (Z, M, Y )

=

P (Z)P (M | Z)P (Y | Z, M );

G(˜
z ):

P (Z, M (˜
z ), Y (˜
z ))

=

P (Z)P (M (˜
z ))P (Y (˜
z ) | M (˜
z ));

G(m):
˜

P (Z, M, Y (m))
˜

=

P (Z)P (M | Z)P (Y (m)
˜ | Z);

G(˜
z , m):
˜

P (Z, M (˜
z ), Y (˜
z , m))
˜

=

P (Z)P (M (˜
z ))P (Y (˜
z , m)).
˜

32

Instantiations of the templates shown in Figure 10 give the following:
G:
P (Z, M, Y ) = P (Z)P (M | Z)P (Y | M );
G(˜
z ):

P (Z, M (˜
z ), Y (˜
z ))

=

P (Z)P (M (˜
z ))P (Y (˜
z ) | M (˜
z ));

G(m):
˜

P (Z, M, Y (m))
˜

=

P (Z)P (M | Z)P (Y (m));
˜

G(˜
z , m):
˜

P (Z, M (˜
z ), Y (m))
˜

=

P (Z)P (M (˜
z ))P (Y (m)).
˜

Notice that in all of these examples the conditioning set in the density
associated with V (˜
aV ) in G(˜
a) is a set of counterfactual random variables
that correspond to a subset of the parents of V in G; further any parent in
G for which a corresponding variable is not present in the conditioning set,
has been intervened upon and thus is present in ˜
aV .
3.5.2

The Markov property for G(˜
a)

It immediately follows from standard results in graphical models (e.g. Lauritzen, 1996, Thm. 3.27) that if a distribution factorizes according to G(˜
a)
then the distribution P (V(˜
a)) also obeys the following Markov property:
Given disjoint subsets B, C, D of V (D may be empty), let B(˜
a) ≡
{B(˜
aB ), B ∈ B}, C(˜
a) ≡ {C(˜
aC ), C ∈ C}, D(˜
a) ≡ {D(˜
aD ), D ∈ D},
be the corresponding sets in G(˜
a),
if B(˜
a) is d-separated from C(˜
a) given D(˜
a) ∪ ˜
a in G(˜
a)
then

B(˜
a) ⊥
⊥ C(˜
a) | D(˜
a)

(24)

[P (V(˜
a))].

In words, this states that if in G(˜
a) two subsets B(˜
a) and C(˜
a) of random
nodes are d-separated by D(˜
a) in conjunction with the fixed nodes ˜
a, then
B(˜
a) and C(˜
a) are conditionally independent given D(˜
a) in the associated
distribution P (V(˜
a)). Thus we have the following:
Theorem 12. If P (V(˜
a)) factors according to G(˜
a) then P (V(˜
a)) obeys (24).
The requirement to also condition on the vertices in ˜
a is intuitive when
it is considered that, in a given instantiation, these are fixed constants. Note
that since, by construction, vertices in ˜
a have no parents, no additional paths
become d-connecting due to conditioning on the nodes in ˜
a. Consequently
we have the following:
Proposition 13. If B(˜
a) and C(˜
a) are d-separated given D(˜
a) in G(˜
a) then
B(˜
a) and C(˜
a) are d-separated given D(˜
a) ∪ ˜
a in G(˜
a).

33

It also follows from the above observation that:
Proposition 14. B(˜
a) is d-separated from C(˜
a) given D(˜
a)∪˜
a in G(˜
a) if and
only if B(˜
a) is d-separated from C(˜
a) given D(˜
a) in (G(˜
a))V(˜a) , the induced
subgraph of G(˜
a) on V(˜
a), obtained by removing all fixed nodes ˜
a.
Thus an alternative approach to implicitly conditioning on the fixed
nodes ˜
a is to simply remove the fixed vertices from G(˜
a) before checking
d-separation relations. Notwithstanding this, the fixed nodes play an important role in that they make it possible to recover the original DAG from G(˜
a)
alone, see §3.6.3; they are also instrumental in studying dynamic regimes,
see §5.
3.5.3

Examples of the Markov property

Consider first the Markov properties associated with the SWITs shown in
Figure 9.
G(˜
z ): Applying d-separation we see that for each value of z˜,
Z⊥
⊥ M (˜
z ), Y (˜
z );

(25)

which may be readily seen from the fact that there is no path joining Z and M (˜
z ), Y (˜
z ). We stress that it does not follow from this
template that Z is jointly independent of Y (˜
z ) and Y (z ∗ ), nor that
∗
Z is jointly independent of Y (˜
z ) and M (z ), for distinct values z˜, z ∗ .
These ‘cross-world’ independence relations do not logically follow from
Z⊥
⊥M (z ∗ ), Y (z ∗ ) and Z⊥
⊥Y (˜
z ).
G(m):
˜ This template implies that for each m,
˜
M⊥
⊥ Y (m)
˜ | Z;

(26)

which may be seen from the fact that Z is a non-collider on the path
from M to Y (m).
˜
G(˜
z , m):
˜ In this example we see that for each m
˜ and z˜,
Z⊥
⊥ M (˜
z ), Y (m,
˜ z˜)

and M (˜
z) ⊥
⊥ Y (m,
˜ z˜) | Z.

(27)

The first of these independence relations follows, as before, from the
fact that there are no paths from Z to M (˜
z ) and Y (m,
˜ z˜). The latter
conditional independence follows when it is recalled that when judging
independence we always condition on fixed nodes, such as z˜, so that
there is no path d-connecting M (˜
z ) and Y (m,
˜ z˜) given Z.
34

We now consider the templates shown in Figure 10 where there is no
‘direct effect’ of Z on Y . These lead to the following independence relations:
G(˜
z ): For each value of z˜,
Z⊥
⊥ M (˜
z ), Y (˜
z ).

(28)

Note that this is the same independence constraint (25) implied by the
template shown in Figure 9(ii). However, we will see that in conjunction with the modularity property introduced in Section 3.6, the absence of the edge z → Y (z) in the template implies an additional constraint relating the distribution P (Z, M (˜
z ), Y (˜
z )) to P (Z, M (z 0 ), Y (z 0 ))
for z˜ 6= z 0 .
G(m):
˜ This template implies that for each m,
˜
Z, M ⊥
⊥ Y (m);
˜

(29)

which may be seen from the fact that there are no paths from Z and
M to Y (m).
˜
G(˜
z , m):
˜ It follows from this template that the variables Z, M (˜
z ) and Y (m)
˜ are
mutually independent.

3.6

Modularity

In general the densities occurring on the RHS of (23) involve potential outcome variables (the exception being those variables for which aV = ∅, which
includes any variable that has no parents in G). The modularity property
links these conditional densities to the conditional densities P (V | pa(V ))
associated with the factual variables present in the original DAG.
Definition 15 (Modularity).
Pairs (G, P (V)) and (G(˜
a), P (V(˜
a))) are said to satisfy the modularity property if for every Y ∈ V,





P Y (˜
aY ) = y  paG(˜a) (Y (˜
aY )) \ ˜
a =q
(30)






= P Y = y  paG (Y ) \ A = q, paG (Y ) ∩ A = ˜
apaG (Y )∩A ,
whenever both sides of (30) are well-defined.
In words, this states that the conditional density associated with the
random vertex Y (˜
aY ) in G(˜
a) corresponds to the conditional density associated with Y in G after substituting in the value a
˜i for any variable Ai ∈ A
35

that is a parent of Y . Recall from Proposition 7 that paG(˜a) (Y (˜
aY )) \ ˜
a is
simply the set of random nodes in G(˜
a) that are parents of Y (˜
aY ).
Thus formally the modularity property for G(˜
a) is a relation between
two pairs (P (V), G) and (P (V(˜
a)), G(˜
a)), where in each pair the distribution
factors according to the graph.
Proposition 16. Under the FFRCISTG
model associated with G, the pairs

(P (V), G) and P (V(a† )), G(a† ) obey modularity.
We prove this in Appendix B.1.
3.6.1

Examples of the Modularity Property

We illustrate the modularity property for the examples considered previously. For the SWITs in Figure 9 we have the following equations:
G(˜
z ): Modularity implies that for all values z˜, m, y:
P (M (˜
z ) = m) = P (M = m | Z = z˜),
P (Y (˜
z ) = y | M (˜
z ) = m) = P (Y = y | M = m, Z = z˜).
G(m):
˜ Here modularity implies that for all z, m,
˜ y
P (Y (m)
˜ = y | Z = z) = P (Y = y | M = m,
˜ Z = z).
G(˜
z , m):
˜ Modularity implies that for all values z˜, m, m,
˜ y:
P (M (˜
z ) = m) = P (M = m | Z = z˜),
P (Y (˜
z , m)
˜ = y) = P (Y = y | M = m,
˜ Z = z˜).
Turning to the templates shown in Figure 10, we have the following:
G(˜
z ): Under modularity the template here implies for all values z˜, m, y:
P (M (˜
z ) = m) = P (M = m | Z = z˜),
P (Y (˜
z ) = y | M (˜
z ) = m) = P (Y = y | M = m).
Notice that the second equation here implies the restriction that P (Y (˜
z) =
y | M (˜
z ) = m) does not depend on the value of z˜, hence we have that
for z 0 6= z˜,
P (Y (˜
z ) = y | M (˜
z ) = m) = P (Y (z 0 ) = y | M (z 0 ) = m).
Notice that this is a restriction relating the distributions P (Z, M (˜
z ), Y (˜
z ))
and P (Z, M (z 0 ), Y (z 0 )) that are associated with two different instantiations of the template: G(˜
z ) and G(z 0 ).
36

G(m):
˜ For this template, modularity implies that for all m,
˜ y
P (Y (m)
˜ = y) = P (Y = y | M = m).
˜
G(˜
z , m):
˜ In this case, modularity implies that for all values z˜, m, m,
˜ y:
P (M (˜
z ) = m) = P (M = m | Z = z˜),
P (Y (m)
˜ = y) = P (Y = y | M = m).
˜
3.6.2

How the FFRCISTG implies modularity and factorization

Given the FFRCISTG model associated with a graph G a simple argument
establishes that, for a given SWIG G(˜
a), the distribution of the counterfactuals P (V(˜
a)) factorizes with respect to G(˜
a). We illustrate this for the
FFRCISTG model associated with the DAG G in Figure 10(i), showing the
three distributions: P (Z, M (˜
z ), Y (m)),
˜
P (Z, M, Y (m))
˜ and P (Z, M, Y ) factorize with respect to G(˜
z , m),
˜ G(m)
˜ and G respectively; see Figure 10.
First observe that the FFRCISTG assumption (17) implies that the
counterfactuals Z, M (˜
z ) and Y (m)
˜ are jointly independent, so:
P (Z = z, M (˜
z ) = m, Y (m)
˜ = y) = P (Z = z)P (M (˜
z ) = m)P (Y (m)
˜ = y). (31)
This establishes the factorization property for G(˜
z , m).
˜
Next we turn to the factorization property for G. Observe the following:
P (M (˜
z ) = m) = P (M (˜
z ) = m | Z = z˜) = P (M = m | Z = z˜),

(32)

where the first equality follows from factorization (31) and the second uses
consistency (14). Substituting into the RHS of (31) we obtain:
P (Z = z, M (˜
z ) = m, Y (m)
˜ = y) = P (Z = z)P (M = m | Z = z˜)P (Y (m)
˜ = y).
(33)
Evaluating (33) with z = z˜ implies:
P (Z = z, M = m, Y (m)
˜ = y) = P (Z = z)P (M = m | Z = z)P (Y (m)
˜ = y),
(34)
where we have used recursive substitution on the LHS since Z = z implies
M (z) = M . This is the factorization property for G(m).
˜
Lastly, by the same argument used to establish (32):
P (Y (m)
˜ = y) = P (Y (m)
˜ = y | M = m)
˜ = P (Y = y | M = m).
˜
37

(35)

Substituting into the RHS of (34) and evaluating at m = m
˜ implies:
P (Z = z, M = m, Y = y) = P (Z = z)P (M = m | Z = z)P (Y = y | M = m),
(36)
so that P (Z, M, Y ) factors according to G.
Inspection of equations (32) and (35) reveals that we have also established that (P (Z, M (˜
z ), Y (m)),
˜ G(˜
z , m))
˜ and (P (Z, M, Y (m)),
˜ G(m))
˜ both
obey modularity with respect to (P (Z, M, Y ), G).
A proof is given in Appendix B.1, showing that the above argument
extends to an arbitrary G thus proving Propositions 11 and 16.
3.6.3

The rationale for including fixed nodes

The reader may be curious as to the motivation for including fixed vertices
on the SWIG. As Proposition 14 shows, the d-separation relations holding
among the variables in P (V(˜
a)) are given by the induced subgraph of G(˜
a)
obtained by removing fixed nodes.
However, if we compare the two templates G(˜
z ) in Figures 9(ii) and
10(ii) we see that if the fixed node z were omitted the two graphs would be
identical. Thus if we wish to be able to infer the original DAG G from G(˜
a)
alone, then it is necessary to include fixed nodes.
The ability to discern the DAG G is important since the modularity condition relates G and G(˜
a). Returning to the example above, the conditional
densities associated with Y (˜
z ) under modularity are different in Figures 9(ii)
and 10(ii): if the original DAG contains the Z → Y edge, then we have:
P (Y (˜
z ) = y | M (˜
z ) = m) = P (Y = y | M = m, Z = z˜)
while if the Z → Y edge is absent then we have:
P (Y (˜
z ) = y | M (˜
z ) = m) = P (Y = y | M = m).
This point is of particular relevance in the analysis of dynamic regimes; see
§5.
3.6.4

Implications of Modularity

The following is a direct consequence of the factorization (23) and modularity (30) properties.

38

Proposition 17. If P (V) factorizes according to G then P (V(˜
a)) factorizes
according to G(˜
a) and obeys (30) if and only if
P (V(˜
a) = v)
(37)


Y 

=
P Vi = vi  {paG (Vi ) \ A} = vpaG (Vi )\A , {paG (Vi ) ∩ A} = ˜
apaG (Vi )∩A ,
Vi ∈V

whenever both sides of the equation are well-defined.30
Though immediate from the definitions, this Proposition is important
because (37) links the counterfactual distribution P (V(˜
a)) to the observed
distribution P (V). Under positivity, the right-hand side of (37) is the extended g-formula density of (Robins et al., 2004, p.2222) associated with
(A, V) in the context of graph G.31 Under the conditions of Proposition 17,
equation (37) identifies the effect of A on V whenever the RHS is a welldefined functional of the observed distribution P (V). We again emphasize
here that A is a subset of V: in addition to determining the effects of A on
the remaining variables V \ A we are also determining the effect that earlier
interventions Ai = a
˜i have on the subsequent level of treatment Aj (˜
a) that
a subject would receive, were it not for the intervention setting Aj to a
˜j .
Corollary 18. Let B = V \ A, be the set of variables in G that are not
intervened on, and let B(˜
a) be the corresponding variables in G(˜
a). Then
P (B(˜
a) = b)
(38)


Y 

=
apaG (Bi )∩A .
P Bi = bi  {paG (Bi ) \ A} = bpaG (Bi )\A , {paG (Bi ) ∩ A} = ˜
Bi ∈B

Under positivity, (38) is the (unextended) g-formula of (Robins, 1986,
p.1423) for the effect on B of intervening on A in the context of graph
G. Equation (38) is also known as the ‘truncated factorization formula’;
see Davis (1984); Robins (1984, 1985, 1986); Spirtes et al. (1993) for some
early applications. Note that (38) is the distribution of B(˜
a) obtained by
marginalizing over A(˜
a) in (37).
Proof: Suppose Ai (˜
aAi ) is the random variable corresponding in G(˜
a) to
some Ai ∈ A in G. By the construction of G(˜
a), Ai (˜
aAi ) has no children in
30

A product of terms that includes an undefined term, is itself well-defined if and only
if at least one of the (other) terms in the product is zero.
31
More specifically, (37) corresponds to the special case where the ordering of the variables in the g-formula is consistent with the DAG G and the intervention density for Ai
is a point-mass on a
˜i ; see also (60).

39

G(˜
a), hence may be marginalized without affecting any other terms in the
factorization.
2
3.6.5

Completeness of the Markov property for G(˜
a)

We have seen in Theorem 12 that for any distribution P (V(˜
a)) that factorizes
according to a SWIG G(˜
a), d-separation (with ˜
a included implicitly in the
separating set) implies conditional independence. The following provides a
converse.
Theorem 19. If B(˜
a) and C(˜
a) are d-connected given D(˜
a) ∪ ˜
a in G(˜
a),
then there exist distributions P (V) and P (V(˜
a)) that obey modularity and
factorize according to G and G(˜
a) respectively, such that
B(˜
a) ⊥
6 ⊥ C(˜
a) | D(˜
a)

[P (V(˜
a))].

Proof: It follows directly from the corresponding results for DAGs (Geiger
and Pearl, 1993; Meek, 1995, see) that we may construct a distribution
P (V(˜
a)) in which the independence corresponding to the d-connection does
not hold. Under modularity this distribution P (V(˜
a)) is a partial specification of the conditional densities in the original DAG G. We are then free to
choose the remaining pieces of the conditional densities, to specify P (V), to
build a distribution factorizing according to G.
2
We note briefly that the corresponding result does not hold for ‘twin networks’ Pearl (2000, 2009) as these involve variables that are deterministically
related.32
Corollary 20. If B(˜
a) and C(˜
a) are d-connected given D(˜
a)∪˜
a in G(˜
a), then
there exists a counterfactual distribution in the NPSEM-IE model (and hence
also in the FFRCISTG) associated with G, in which B(˜
a) ⊥
6 ⊥ C(˜
a) | D(˜
a).
Proof: By Theorem 19 there exist distributions P ∗ (V(˜
a)) and P ∗ (V) obeying factorization and modularity such that the dependence holds under
P ∗ (V(˜
a)). We construct a counterfactual distribution under which the vari†
†
33 are mutually independent,34 such
ables {V (vpa(V
) ) | V ∈ V, v ∈ V}
that:
†
†
∗
P (V (vpa(V
) ) = v) ≡ P (V = v | pa(V ) = vpa(V ) ).
32

See footnote 3.
Here V is the state-space of V.
34
Observe that this independence assumption is (even) stronger than the usual NPSEMIE assumption.
33

40

A1 (a0 )

A0
A0

A1

L

Y

a0

(i)

L(a0 )

a1

(ii)

Figure 11: (i) A complete DAG G; (ii) the template G(a0 , a1 ).
This is sufficient to specify a distribution in the NPSEM-IE associated with
G. It then follows from Propositions 11 and 16 that P (V(˜
a)) = P ∗ (V(˜
a))
∗
and P (V) = P (V) as required.
2

4

Robins’ criterion for applying the g-formula and
Pearl’s erroneous critique

In Section 11.3.7 of his second edition Pearl offers three critiques of the
g-formula based methodology developed in Robins (1986, 1987) for estimation of the causal effects of time-varying treatments. In Section 4.2 we
demonstrate that all of Pearl’s claims are either erroneous or based on misconceptions. We show that two of the false claims are the direct result of
mathematical errors made by Pearl; the third is the result of Pearl’s misreading or lack of awareness of an example in (Robins, 1986). In Section
4.1 we provide the necessary background by reviewing Robins’ g-formula
methodology with the aid of SWIGs. In Section 4.2 we show that Pearl’s
claims are erroneous.

4.1

The g-formula for a sequence of treatments and a single
response

Given a causal DAG G, interest often focuses on the distribution of a final
response (Y ) under a sequence of interventions that assign specific values
to earlier variables, e.g. A0 and A1 , i.e. P (Y (a0 , a1 )). We illustrate the
simplest such situation in Figure 11(i) where the joint effect of A0 and A1

41

Y (a0 , a1 )

H
H
A1 (a0 )

A0
A0

A1

L

Y

L(a0 )

a0

(i)

Y (a0 , a1 )

a1

(ii)

Figure 12: (i) A DAG G describing a sequentially randomized trial; (ii) the
template G(a0 , a1 ).
on L and Y is identified. The marginal distribution of Y (a0 , a1 ) is given by:
X
P (Y (a0 , a1 ) = y) =
P (L(a0 ) = l, Y (a0 , a1 ) = y)
l

=

X

P (L = l | A0 = a0 )P (Y = y | A0 = a0 , L = l, A1 = a1 ).

l

(39)
Here the second equality follows by Corollary 18 with B = (L, Y ). The
right-hand side of (39) is precisely the marginal distribution of Y obtained
by summing the g-formula density in (38) associated with A = {A}, V =
{Y, L, A} over a and l.
A key insight in Robins (1986) was the observation that the same formula (39) could be applied in situations in which there are unmeasured
confounding variables. Consider, for example, the graph shown in Figure
12(i), in which H is unobserved. To see that (39) still holds, first observe
the following:
p(l | h, a0 )p(h) = p(l|h, a0 )p(h|a0 )

since H⊥
⊥A0

= p(h|l, a0 )p(l|a0 )
= p(h|a1 , l, a0 )p(l|a0 )

42

since H⊥
⊥A1 | L, A0 .

(40)

We now apply Corollary 18 again to obtain:
X
P (Y (a0 , a1 ) = y) =
p(l | h, a0 )p(y | a1 , l, a0 , h)p(h)
l,h

=

X

p(l|a0 )

X

=

X

p(h|a1 , l, a0 )p(y | a1 , l, a0 , h)

h

l

p(l|a0 )p(y | a1 , l, a0 ),

l

here the second equality follows from (40).
A similar derivation shows that under the graph in Figure 13(i), P (Y (a0 , a1 ) =
y) is also identified by the same formula. Note that in this case, unlike the
previous cases, both factors, p(l|a0 ) and p(y | a1 , l, a0 ), have no causal interpretation, since neither P (L(a0 )) nor P (Y (a0 , a1 )|L(a0 )) is identified under
this graph. (Robins, 1987, §AD.3) describes a substantive setting in which
the underlying FFRCISTG would be that associated with Figure 13(i).
Reading from the associated templates we see that the FFRCISTG models associated with the DAGs in Figures 11, 12, and 13 have the following
independencies in common:
Y (a0 , a1 ) ⊥
⊥ A1 (a0 ) | L(a0 ), A0

and Y (a0 , a1 ) ⊥
⊥ A0 .

We shall see that for all three DAGs those independencies imply identification of the distribution of Y (a0 , a1 ) by the marginal of Y under the g-formula
density (38) arising from the DAG in Figure 11 (that does not include hidden
variables).
4.1.1

The general setting

We now extend the above development to the general context. Suppose
that there is a topological ordering of our graph G under which we have a
sequence of observed variables:
O ≡ hL1 , A1 , . . . , LK , AK , Y i,
where A = (A1 , . . . , AK ) are the treatments, L = (L1 , . . . , LK−1 ) are covariates and Y is the final response.35 We note that this ordering need not
35
In full generality, each of these variables could be a vector, however for convenience
we will treat them as singletons in our notation and development.

43

H1
H1

H2

H2
A1 (a0 )

A0
A0

A1

L

Y

a0

(i)

L(a0 )

Y (a0 , a1 )

a1

(ii)

Figure 13: (i) A DAG G in which initial treatment is confounded, while the
second treatment is sequentially randomized; (ii) the SWIT G(a0 , a1 ). L is
known to have no direct effect on Y , except indirectly via the effect on A1 .
be temporal.36 In general there may, in addition, be hidden variables H in
the graph.
Our primary focus here will be on conditions under which we can identify
the effect of a given assignment of treatments conditional on treatment and
covariate history. To be more precise, given P (O) we wish to identify:
P (Y (a†Y ) = y | Lj (a† ) = lj , Aj−1 (a† ) = a†j−1 )

for j = 0, . . . , K,

(41)

here ak ≡ (a1 , . . . , ak ), and lk ≡ (l1 , . . . , lk ), a−1 , a0 and l0 are empty vectors
and similarly L0 (a† ), A0 (a† ) are empty sets of variables.
One motivation for considering identification not merely of the marginal
potential outcome distribution P (Y (a†Y )) but conditional on Lj (a† ) and
Aj−1 (a† ) is that in the case where the induced subgraph of G on the observed
variables is complete,37 identification of these conditional intervention distributions is necessary and sufficient in order to test the null hypothesis that
the distribution of the outcome Y (g)38 is the same for all regimes g, includ36

Since we do not believe the future may cause the past, we will assume that there
is a temporal ordering of all variables, which gives a topological ordering of the graph.
However, when we consider incomplete graphs there are situations in which we will use
non-temporal (but still topological) orderings; see the Healthy Worker Survival Effect
example in §4.2.4 and §7 below.
37
Observe that if the induced subgraph G on the observed variables is complete then
any topological order on G induces the same ordering on these variables, which will thus
coincide with the temporal ordering.
38
Y (g) is defined formally in Section 5 below.

44

ing dynamic treatment regimes39 where treatment levels at subsequent times
are determined by the subject’s response to earlier treatment; see Corollary
23 and §5.
Definition 21. The g-formula for the marginal of Y conditional on the
values of an initial sequence of observed variables lm , under treatment assignment a† = a†K , is defined to be:
ba† (y | lm ) ≡

X

p(y|lK , a†K )

K
Y

p(lj |lj−1 , a†j−1 ),

(42)

j=m+1

lm+1 ,...,lK

for m = 0, . . . , K. We will define ba† (y) ≡ ba† (y | l0 ).
Throughout the remainder of this section and the next (§4-4.2) we will
assume that for i = 1, . . . , K:
h
i
P [Li−1 = li−1 , Ai−1 = a†i−1 ] > 0 ⇒ P Ai = a†i | Li−1 = li−1 , Ai−1 = a†i−1 > 0,
(43)
so that the RHS of (42) is always well-defined.
Note that although the formula (42) uses the specified ordering of the
variables, it makes no explicit reference to a graph. Consider a DAG G
with variables V = hL1 , A1 , . . . , LK , AK , Y i, under which this ordering is
topological. Under positivity the summand in (42) is equivalent to the gformula density on the right hand side of (38).40
By Corollary 18 the formula (42) would arise if we had started with
the FFRCISTG model associated with a complete DAG (consistent with
this ordering) from which we constructed the distribution P (V(a† )) resulting
from intervening to set A = {A1 , . . . , AK } to a† . Computing the conditional
distribution P (Y (a†Y ) | Lm (a† ), Am−1 (a† )) from such a complete graph leads
to (42).
However, in Theorem 22 we will see that there are many more DAGs
for which this is true: if certain counterfactual independence conditions
hold then the same formula may be used to identify the same conditional
counterfactual distribution in graphs which may include hidden variables.
The analysis of Figures 12 and 13 above constitute examples.
39

Note that treatment regimes that we, following (Robins, 1986), term ‘dynamic’ are
called ‘conditional plans’ in (Pearl, 2000, 2009, p.121); in that work the term ‘dynamic
plan’ refers to any intervention on multiple variables.
40
Consequently, ba† (y | lm ) is the conditional distribution of Y given Lm under the
g-formula density (42).

45

Now consider a graph G with vertex set V = O ∪ H. We require that the
ordering of O = hL1 , A1 , . . . , LK , AK , Y i may be extended to a topological
ordering for V relative to G. We will let Y (a† ), A(a† ), L(a† ), and H(a† ) be
the corresponding (sets of) variables in G(a† ). Likewise, to simplify notation
we will also use the following shorthands: Lk (a† ) = Lk (a†Lk ), Ak (a† ) =
Ak (a†Ak ) and Y (a† ) = Y (a†Y ).

Theorem 22. Let a† be an instantiation for A. If P (V) and P (V(a† ))
factor according to G and G(a† ) respectively, and obey modularity (30) then
for all j = 0, . . . , K, and all lj ,
ba† (y | lj ) = P (Y (a† ) = y | Lj (a† ) = lj , Aj−1 (a† ) = a†j−1 )

(44)

if and only if for k = 1, . . . , K:
Y (a† ) ⊥
⊥ I(Ak (a† ) = a†k ) | Lk (a† ), Ak−1 (a† ) = a†k−1 ;

(45)

here I(·) is the indicator function.
It thus follows that under (45), the counterfactual distribution on the
RHS of (44) is identified whenever ba† (y | lj ) is a well-defined functional of
the observed marginal distribution P (O) as would be the case if (43) held.
Unless explicitly stated otherwise, in this section we will always assume that
this is the case.
As the graphs G and G(a† ) may include hidden variables, the Theorem
gives conditions under which causal effects are identified even in the presence
of hidden variables. However, whether (45) holds is not empirically testable
from P (O) without further assumptions.41
In fact, in prior work Robins42 showed that under consistency (and thus
under the FFRCISTG model) the following condition was necessary and
sufficient for (44): for k = 1, . . . , K,
Y (a† ) ⊥
⊥ I(Ak = a†k ) | L1 , . . . , Lk−1 , A1 = a†1 , A2 = a†2 , . . . , Ak−1 = a†k−1 .43
(46)
41

The assumption (45) can be ensured to hold in a sequentially randomized experiment,
where treatment Ak is assigned randomly given past treatment and covariate history.
42
Corollary to Theorem AD.1 on p.930 of (Robins, 1987), with necessity following from
reversibility of each step in the proof. Theorem 56 in Appendix B reproduces this result
in the notation of the current paper.
43
(Pearl, 2000, p.103, fn 15) states: “we note that the class of semi-Markovian models
satisfying assumption [(46)] corresponds to complete DAGs in which all arrowheads point
to Xk originate from observed variables”. The graphs in Figure 12 and 13 show that
though sufficient, this is very far from a full characterization of the graphs satisfying (46).

46

This is because under the assumption of consistency, conditions (45) and
(46) are equivalent. However, though necessary and sufficient, neither of
these conditions may be checked (graphically) from G(a† ) since applying
d-separation to G(a† ) does not lead to context-specific independence statements such as (46), nor to independence from indicator functions as in (45)
and (46).
However, we may verify the following stronger counterfactual independence condition: for k = 1, . . . , K,
Y (a†Y ) ⊥
⊥ Ak (a†Ak ) | Lk (a† ), Ak−1 (a† ).

(47)

This condition may be checked directly on an instantiated template
G(a† ). This condition is sufficient, but not necessary.44 We note that although the condition (47) is not the weakest such condition, it is nonetheless
weaker than the (also) sufficient under consistency, but not necessary condition: for k = 1, . . . , K,
Y (a† ) ⊥
⊥ Ak | L1 , L2 , . . . , Lk−1 , A1 , A2 , . . . , Ak−1 ,

(48)

obtained by dropping the specific values from the conditioning event in (46).
We note that (Pearl and Robins, 1995) also present a different, but logically equivalent, graphical method for checking the condition (47). However,
as noted earlier, their algorithm requires the user to construct a separate
graph for each k = 1, . . . , K.
As remarked above, identification of all of the conditional distributions
(41) given above is necessary and sufficient in order to test the null hypothesis that for all regimes g the distribution of the outcome Y (g) is the same.
Thus we have the following result:
Corollary 23 (Robins (1986), Theorem 6.1). Consider a graph G in which
the induced subgraph on the observed variables is complete. Let Y (g) denote
the counterfactual outcome resulting from a dynamic treatment regime in
which Ai is set to gi (li , ai−1 ), for i = 1, . . . K. Condition (45) holding for
k = 1, . . . , K is a necessary and sufficient condition for the existence of a
consistent test that P (Y (g) = y) = P (Y = y) for all dynamic regimes g.
Proof: See Robins (1986) Appendix E.

2

Although in many situations we will derive (45) by applying d-separation to G(a† ),
Theorem 22 does not require this. For example, it is conceivable that G is complete, yet
(45) holds ‘unfaithfully’.
44

47

4.1.2

A complete algorithm for intervention distributions

There are intervention distributions that are identified, but are not identified via any g-formula; see the graph in Figure 14(b), discussed in §4.2
below. Tian and Pearl (2002) presented an algorithm that was shown to be
complete for the identification of intervention distributions; see Huang and
Valtorta (2006); Shpitser and Pearl (2006b); the algorithm was extended to
cover conditional intervention distributions in Shpitser and Pearl (2006a).
However the g-formula continues to play a role. Specifically, it follows from
(Tian and Pearl, 2002, Lemma 1) that every identifiable intervention distribution may be obtained as the sum over a product of expressions obtained
by interleaving applications of the g-formula and marginalization steps; see
also (Shpitser et al., 2011).

4.2

Pearl’s Erroneous Critique of Robins’ criterion

With Section 4.1 as background we now turn to Pearl’s critique. Pearl
(2009), Section 11.3.7, claims to improve and generalize on Robins’ results
concerning identification with the g-formula in the previous section. Specifically, Pearl claims that (46) is “over restrictive”.45 This is surprising given
that, as stated above, the condition is necessary and sufficient.
4.2.1

Pearl’s proposed criterion

Pearl proposes instead the following criterion, which we state here in full:
(3.62∗ ) General Condition for g-Estimation [sic]46
P (y | g = x) is identifiable and is given by [ (42) above47 ] if every
action avoiding back-door path from Xk to Y is blocked by some subset
Lk of non-descendants of Xk . (By “action avoiding” we mean a path
containing no arrows entering an X variable later than Xk .)

(Note that here the variables Xi are the variables intervened upon, i.e. the
Ai ’s in this paper.)
45

Pearl (2000), footnote 15 on p.103, states that (46) is the condition that is the “weakest
assumption needed for identifying the causal effect”. He appears to have changed his mind
subsequently as the footnote has been removed in (Pearl, 2009).
46
Though Pearl (2000, 2009) refers to “g-estimation”, the criterion he is extending
is usually referred to as the ‘g-formula’ or the ‘g-computation formula’. In contrast,
‘g-estimation’ (Robins et al., 1992) is a method for estimating the parameters of semiparametric structural nested models via estimating functions. Thus, g-estimation and
g-computation are entirely distinct. Note also a (new) typographical error has been introduced in (Pearl, 2009) in the g-formula (3.63): the sum should be over ¯
lK not ¯
lk .
47
†
Specifically, with m = 0 and a = x.

48

H1

A1

L2

H1

A1

a1

L2 (a1 )

Y
H2

A2

Y (a1 , a2 )

L3
H2
(a)

A2

a2

L3 (a2 )
(b)

Figure 14: Failure of the extended criterion (3.62∗ ) proposed in Pearl (2009).
(a) A DAG G, with hidden variables H1 , H2 , in which A1 and A2 obey the
extended criterion (3.62*), yet the effect of A1 and A2 on Y is not given by
any g-formula; (b) the template G(a1 , a1 ).
This extended criterion is not valid. This may be seen by considering
the graph shown in Figure 14, in which H1 and H2 are unobserved. The
graph satisfies condition (3.62∗ ):
A1 : The action-avoiding backdoor path A1 ← H1 → L3 → Y is blocked
by L3 which is not a descendant of A1 .
A2 : Similarly, the action avoiding backdoor path A2 ← H2 → L2 → Y is
blocked by L2 which is not a descendant of A2 .
Thus according to the claim in (3.62*) the following equality should hold:
??

P (Y (a1 , a2 ) = y) =

X

p(y | l2 , l3 , a1 , a2 )p(l3 | l2 , a1 , a2 )p(l2 | a1 ).

(49)

l2 ,l3

Unfortunately, the equality (49) is false: the expression above does not correspond to p(Y (a1 , a2 ) = y) as we now show. First note that the g-formula
on the RHS of (49) is equivalent to:
X
p(y | l2 , l3 )p(l2 | a1 )p(l3 | a1 , a2 ),
(50)
l2 ,l3

49

where we have used the independence facts: Y ⊥
⊥A1 , A2 | L2 , L3 and L3 ⊥
⊥L1 |
A1 , A2 . From the template shown in Figure 14(b) we have the following:
P (Y (a1 , a2 ) = y)
X
p(h1 )p(h2 )p(L2 (a1 ) = l2 | h2 )p(L3 (a2 ) = l3 | h1 )
=
h1 ,h2 ,l2 ,l3

× p(Y (a1 , a2 ) = y | L2 (a1 ) = l2 , L3 (a2 ) = l3 )



X X
X

p(h1 )p(l3 | a2 , h1 ) 
p(h2 )p(l2 | a1 , h2 ) p(y | l2 , l3 )
=
l2 ,l3

h1

h2





X X
X

=
p(h1 | a2 )p(l3 | a2 , h1 ) 
p(h2 | a1 )p(l2 | a1 , h2 ) p(y | l2 , l3 )
l2 ,l3

=

X

h1

h2

p(y | l2 , l3 )p(l2 | a1 )p(l3 | a2 ).

(51)

l2 ,l3

Here: the first equality follows from truncated factorization (38); the
second from modularity; the third since H1 ⊥
⊥A2 and H2 ⊥
⊥A1 . The result
(51) could also have been obtained by applying the algorithm given by Tian
and Pearl (2002); see also Shpitser et al. (2011).
Though (51) and (50) have two terms in common, they differ on the
third. Thus, they will not be the same, so long as p(l3 | a2 ) 6= p(l3 | a1 , a2 ),
or equivalently L3 ⊥
6 ⊥A1 | A2 . Since L3 and A1 are d-connected given A2 on
the graph, this independence will not hold in general.
Notice that the identifying expression (51) is not an instance of the gformula because the conditioning set for L3 is not a superset of that for
L2 . Furthermore there is no way to use conditional independence to make
this the case. There are six orderings of the observed variables that are
compatible with the graph:
(A1 , A2 , L2 , L3 , Y ),

(A1 , A2 , L3 , L2 , Y ),

(A1 , L2 , A2 , L3 , Y ),

(A2 , A1 , L2 , L3 , Y ),

(A2 , A1 , L3 , L2 , Y ),

(A2 , L3 , A1 , L2 , Y ).

None lead to a valid g-formula for P (Y (a1 , a2 )). Given Theorem 22 above it
could not be otherwise: In every topological ordering there is at least one Ai
vertex that is not preceded by either L2 or L3 , hence as may be seen from
the template in Figure 14(b), this variable will be d-connected to Y (a1 , a2 )
(given ∅). Since by Theorem 19, d-separation is complete, it follows that
under any ordering, there exist distributions P (V) and P (V(a1 , a2 )) that
factor and obey modularity with respect to G and G(a1 , a2 ), yet the condition
(45) fails to hold.
50

X0
X0

Z

H

X1

Y

x0

Z(x0 )

Y (x0 , x1 )

X1 (x0 )
H

(a)

x1
(b)

Figure 15: (a) A DAG G in which Robins’ condition (46) is falsely claimed
not to hold; see Ex. 11.3.3, Fig. 11.12 in Pearl (2009, p.353); H is unobserved;
(b) the template G(x0 , x1 ).
Pearl claims on p.352 that he “derived” the sufficiency of condition
(3.62*) for the g-formula by applying Theorem 4.4.1 in (Pearl, 2009). This
cannot be the case since the latter, which appears in (Pearl and Robins,
1995), is true, while the former is false.
4.2.2

Examples claiming to show extensions of the g-formula

After presenting the (flawed) criterion (3.62*) Pearl also presents examples,
which he incorrectly claims show instances in which a g-formula may be
applied even though Robins’ criterion fails to hold. One example is based
on a mathematical error, the others on misconceptions concerning prior
work.
4.2.3

Example: Failure to correctly assess context specific independence in twin networks

Example 11.3.3 in Pearl (2009) is the graph shown48 in Figure 15(a). We
reproduce Pearl’s discussion regarding this example:
Figure [15(a)] demonstrates a case where [(46)] is not satisfied [...]
but the graphical condition (3.62∗ ) is. It is easy to see that (3.62∗ ) is
satisfied; all back-door action-avoiding paths from X1 to Y are blocked
by {X0 , Z}. At the same time, it is possible to show (using the Twin
48

Where we have a hidden variable Z ← H → X2 , Pearl uses a bi-directed edge Z ↔ X2 .

51

Network Method [...]) that Y (x0 , x1 ) is not independent of X1 , given
Z and X0 . [...] Therefore, [(46)] is not satisfied for Y (x0 , x1 ) and X1 .
[...]
This example is another demonstration of the weakness of the
potential-outcome language [...]

In this example, as Pearl recognizes, the g-formula is applicable with
the ordering hX0 , Z, X1 , Y i. Further, condition (46) holds, yet Pearl falsely
claims it does not. Pearl is correct in his assertion that
Y (x0 , x1 ) ⊥
6 ⊥X1 | Z, X0 .

(52)

However, careful readers of the material in the last section49 will observe
that the lack of independence (52) does not imply that (46) is false. The
latter is a context specific independence. Consequently Pearl’s conclusion
here is erroneous. To apply the g-formula it is sufficient by (46) that:
Y (x0 , x1 )⊥
⊥X0 ,

and

Y (x0 , x1 )⊥
⊥X1 | Z, X0 = x0 .

(53)

Under the FFRCISTG model associated with Figure 15(a) we can apply the
consistency assumption, Def. 1 (ii), to (53) to see that the latter condition
is equivalent to:
Y (x0 , x1 )⊥
⊥X1 (x0 ) | Z(x0 ), X0 = x0 .

(54)

We see by examining the template G(x0 , x1 ) shown in Figure 15(b), that:
Y (x0 , x1 )⊥
⊥X1 (x0 ) | Z(x0 ), X0 ,

(55)

since there is no path d-connecting Y (x0 , x1 ) and X1 (x0 ) given {X0 , Z(x0 )}
in G(x0 , x1 ). It then follows immediately (by conditioning on X0 = x0 in
(55)) that (54) holds. We conclude that the independences (53) hold under
the FFRCISTG model and thus under the NPSEM-IE sub-model assumed
by Pearl. Our approach based on SWIGS (combined with consistency) prevents the user from committing the error made by Pearl.
The independence relations (53) may also be obtained by applying (an
extension of) the twin-network method (Pearl, 2000, 2009, §7.1.4), though
this requires some care (see Appendix D.4). It is quite clear from Pearl’s
discussion of this example (Pearl, 2009, p.353; see also p.395) that either
49

Also those who look up condition (3.62) in (Pearl, 2000, 2009).

52

he failed to apply this algorithm correctly, or he failed to observe that
Y (x0 , x1 ) ⊥
6 ⊥ X1 | Z, X0 does not imply Y (x0 , x1 ) ⊥
6 ⊥ X1 | Z, X0 = x0 .50
We see some irony here: in (Pearl, 2009, Ex. 11.3.3, p. 353) this example
was supposed to illustrate an unnoticed shortcoming of the condition given
by Robins for the application of the g-formula. However, in fact Pearl’s
faulty analysis demonstrates the difficulty he encountered in applying his
twin-network method to accurately evaluate the above counterfactual independence statements. Our approach based on SWIGs immunizes the user
against drawing these erroneous conclusions.
4.2.4

Examples in which the g-formula may be applied but under
a non-temporal order

Example 11.3.1 and Example 11.3.2 in Pearl (2009) make the same point:
identification by the g-formula may be possible, but only under a nontemporal order. Specifically Example 11.3.1 in Pearl (2009), shown in Figure
16, is a familiar example of ‘m-bias’ (Greenland, 2003) where Y (a) ⊥
⊥ A, yet
Y (a) ⊥
6 ⊥ A | Z. Pearl argues correctly that in this instance, if the ordering of
the observed variables was (Z, A, Y ), and if we were to apply the g-formula
using this ordering then the resulting g-formula would not correspond to
P (Y (a)). However, under the ordering (A, Z, Y ) which is compatible with
the DAG (but not the original time-order) we would obtain the correct gformula (here, simply P (Y (a) = y) = P (y | a)).
Example 11.3.2 in Pearl (2009), shown in Figure 17, makes the same
point. In this instance, the temporal ordering given is (A, S, Y ). It is easy
to see that because Y (a) ⊥
⊥ A | S, yet Y (a) ⊥
6 ⊥ A, we may apply the
g-formula but only under a non-temporal ordering.
Both of these examples do not contradict Theorem 22 since that result, though it uses an ordering, does not require that it be temporal. The
examples do show that in certain cases it may be beneficial to consider nontemporal orderings. Though interesting, this is not a new point, as it is
discussed at length in (Robins, 1986, Section 11), specifically with regard to
the discussion of the minimum latent period in the Healthy Worker Survival
Effect. We briefly review this analysis from the perspective of SWIGs.
50
Specifically, he (incorrectly) argues that because Y (x0 , x1 ) and X1 are d-connected
(given Z and X0 ) in the ‘twin network’ by the path X1 ↔ Z ↔ Z(x0 , x1 ) → Y (x0 , x1 ),
“therefore” (46) does not hold. However (under consistency), when X0 = x0 , Z = Z(x0 ) =
Z(x0 , x1 ), so that in spite of the presence of this path, Y (x0 , x1 )⊥
⊥X1 | Z, X0 = x0 ; see
Appendix D.

53

The Healthy Worker Survival Effect
Consider a longitudinal cohort study of workers exposed to an industrial
lung carcinogen with time to clinically diagnosed lung cancer as outcome.
Robins showed that when the minimal latent period (MLP) exceeds x years
and the duration of the healthy worker survivor effect (HWSE) is less than
x years, one may be able to obtain control of confounding due to the HWSE
by coding the indicator function for survival at t+x as occurring prior to the
exposure received at time t: a rather dramatic example of the phenomenon
in Example 11.3.2.
Here are the (somewhat simplified) details formulated in graphical terms.
We say there is a MLP of at least x years if an exposure received today cannot result in a clinically diagnosed lung cancer within x years. We say that
the HWSE lasts no more than z years if, whenever a subject has undiagnosed lung cancer that is sufficiently advanced to cause the subject to quit
work (or change exposure in some other way), the cancer will be clinically
diagnosed within the next z years. The situation is represented by the DAG
in Figure 18(a) where At , Ht , and Dt are indicators of carcinogen exposure
and of undiagnosed and diagnosed lung cancer at year t. Ht is, of course,
unobserved. At is a parent of Ht+1 and Dt+2 , but not of Dt+1 , indicating
an MLP of between 1 and 2 years. Ht has At and Dt+1 but not Dt+2 as
children, indicating the HWSE has duration no greater than 1 year. The
DAG in Figure 18 (b) reorders the data; the survival indicator at t+1, Dt+1 ,
is now earlier than At in the ordering.
The DAG in Figure 18(c) is our template. By d-separation A0 ⊥
⊥D2 (a0 ) |
D1 where Dt = 0 if a subject has survived to t without a lung cancer
diagnosis. Hence by Eq. (45) we can apply the g-formula with the ordering
hD1 , A0 , D2 i to obtain
p[D2 (a0 ) = 0] = p[D2 = 0|A0 = a0 , D1 = 0]p[D1 = 0]
where the summation over D1 is absent since D2 = 0 implies D1 = 0.

5

SWIGs for dynamic regimes

In this section we show that we may analyze identification conditions for dynamic regimes via a simple extension of our graphical formalism. A dynamic
regime g is a policy that assigns treatment on the basis of past history; following Robins (1986) we shall use the letter g to denote a dynamic regime.
Robins et al. (2004) proposed allowing this history to include the natural

54

H1

Z

A

H2

H1

Y

H2

Z

a

A

(a)

Y (a)

(b)

Figure 16: (a) A DAG with two unobserved variables (H1 , H2 ) depicting
the first example presented by Pearl claiming to extend Robins’ criterion for
applying the g-formula; see Ex. 11.3.1, Fig. 11.10 in Pearl (2009, p.352); (b)
the corresponding template.

H1

H1

S

A

Y

S

a

A

(a)

Y (a)

(b)

Figure 17: (a) A DAG with a single unobserved variable (H1 ) depicting the
second example presented by Pearl claiming to extend Robins’ criterion for
applying the g-formula; see Ex. 11.3.2, Fig. 11.11 in Pearl (2009, p.353); (b)
the corresponding template.

55

H0
A0

H1
D1

A1

H0
D2

D1

(a)

A0
a0

A0

D2

A1

(b)

H0

D1

H1

H1
D2 (a0 )

A1 (a0 )
a1

(c)

Figure 18: (a) A DAG G with two unobserved variables (H1 , H2 ) depicting
the minimum latent period scenario; (b) the same DAG with the variables
re-ordered; (c) the corresponding template G(a0 , a1 ).

56

H2
H1

H2
H1

A2 (a1 )

A1
A1

A2

L

Y

a1

(i)

L(a1 )

a1

Y (a1 , a2 )

(ii)

Figure 19: (i) A DAG G describing an observational study in which the
effect of A1 on A2 is confounded; (ii) the template G(a1 , a2 ).
values that a variable would take in the absence of its value being specified by the regime. These regimes have also been considered by Danaei
et al. (2012); Haneuse and Rotnitzky (2013); Lajous et al. (2012); Mu˜
noz
and van der Laan (2011); Taubman et al. (2008, 2009); Young et al. (2012).
Due to its novelty we will focus on this type of regime in the introduction
to this section. Identification of the distribution of a response Y under a
dynamic regime when natural values are not used to assign treatment has
been considered by Dawid and Didelez (2008, 2010); Pearl (2000); Robins
(1986, 1987, 1989a, 1997); Tian (2008). In particular, Tian proposed the
first complete algorithm. Identification of the distribution of a response Y
under a dynamic regime when natural values are used to assign treatment
was discussed briefly in Robins et al. (2004); Haneuse and Rotnitzky (2013);
Mu˜
noz and van der Laan (2011, 2012); Shpitser and Pearl (2012); Young
et al. (2012).

5.1

Dynamic regimes depending on the natural level of treatment

To consider a specific example, suppose that we have data on minutes exercised (A1 ) and subsequent blood pressure (Y ) collected from a large HMO.
Let P (A1 , Y ) be the observed (population) distribution. Now consider the
following regime:
Exercise for as long as you would have done without intervention or twenty minutes, whichever is more.
57

This context may be conceptualized in terms of there being two variables
associated with treatment: the ‘natural’ level of treatment A1 which the
patient performs in the absence of an intervention, and the level of treatment
prescribed by the regime g which we denote A+
1 (g). In an example such as
this the regime-prescribed treatment level A+
(g)
is a function of the level
1
(A1 ) that the patient would perform (in the absence of an intervention).
The exercise regime described would correspond to:
A+
1 (g) = g(A1 )

where

g(x) ≡ max{x, 20}.

We denote the treatment assigned by g via an upper case letter A+
1 (g) since
it is random.
Suppose that we are interested in the effect of the regime on the patient’s
blood pressure (Y ). We define the counterfactual response under regime g
to be:
Y (g) ≡ Y (a1 )|a1 =A+ (g)=g(A1 ) .
(56)
1

Following Young et al. (2012) we consider the question of whether this regime
could be implemented in an actual randomized experiment. Now in place
of observational HMO data, consider an experimenter who wishes to implement this regime. Note that in order for this regime to be implemented,
data on the natural value of A1 must be collected.51 Thus, for example, the
experimenter might watch each subject exercise, say in a gymnasium, and
if the subject goes to get dressed after A1 minutes with A1 < 20, the experimenter obliges them to continuing exercising until they have exercised for
20 minutes. We will see below that under the FFRCISTG model associated
with the DAG G in Figure 20(a), the distribution P (Y (g)) of Y (g) under
regime g, is identified by the distribution P (A1 , Y ) of HMO data. We will
represent this dynamic regime via the template shown in Figure 20(c).

5.2

Treatment at multiple time-points

If there are two temporally ordered treatments then we can consider more
complex regimes. Consider the regime where:
A+
1 (g) = g1 (A1 )
A+
2 (g)

=

with

g1 (x)
+
g2 (A2 (g), A1 (g), A1 ),

≡ max{x, 20};
where

51

+
g2 (a2 , a+
1 , a1 ) ≡ a2 + (a1 − a1 ).

There exist other regimes that depend on the natural value which could not be implemented. Young et al. (2012) discuss some of the philosophical and conceptual difficulties
that then arise. We also discuss both the mathematical and philosophical implications
of this in §6.1.4 but we do so in the context of an FFRCISTG model and obtain some
counter-intuitive results.

58

A1

Y
(a)

A1

Y (˜
a1 )

a
˜1
(b)

A1

A+
1 (g)

Y (g)

(c)

Figure 20: (a) a causal DAG G; (b) the (non-dynamic) SWIG G(˜
a1 ); (c) the
dynamic SWIG G(g) representing a dynamic regime g under which A+
1 (g),
the level of treatment prescribed by the regime, depends on the level of
treatment A1 that the patient would choose in the absence of the regime.
The edge from A1 to A+
1 (g) is dashed to show that it is specified by the
regime g and not the natural data-generating process.
A2 (g) is the level of exercise that the individual would perform in the absence
of an intervention on Day 2 having followed the regime g1 and thus having
exercised for time A+
1 (g) on Day 1. In general this will not be the same as
A2 , which is the number of minutes of exercise the individual would have
performed on the second day, having also chosen their own level of exercise
on Day 1.
Note that in order to avoid further complicating the notation we write
+
+
(g)
rather than A+
A+
2 (g2 (A2 (g), A1 (g), A1 )) or A2 (g2 ) though one could
2
choose to do so.52 Such information is present in and simpler to read from
the graph G(g) that we now construct. However, though we will write A+
t (g)
+
we will require that the function gt specifying the prescribed assignment at
stage t only takes as input variables that are temporally prior to A+
t (g).
We will allow dynamic regimes under which both the prescribed levels
A+
s (g) for s < t and the ‘natural’ levels of treatment As (g) for s ≤ t may
53 We will
be used in determining the current assigned treatment A+
t (g).
assume as in (56) that under the dynamic regime g only the treatment
52
For example, if two treatments A1 and A2 are dynamically assigned via functions
g1 and g2 , but only A2 is an ancestor of a response Y , we might wish to make this
clear by writing Y (g2 ). Further, if g2 took as input L0 and A1 (but not A+
1 (g1 (A1 ))
or L1 (g1 (A1 ))) we could write Y (g2 (A1 )) to make this clear. However, it is not
hard to see that such an explicit notation will quickly become burdensome when variables influenced by earlier dynamic treatments are used as inputs for later dynamic
treatments e.g. if written explicitly the final response Y (g) in Figure 21(ii) would be:
Y (a1 , a2 )|a1 =g1 (A1 ),a2 =g2 {A2 (g1 (A1 )),L(g1 (A1 )),A+ (g1 (A1 )),A1 } (!)
1
53
Robins et al. (2004) and Young et al. (2012) considered the special case in which the
only natural level determining A+
t (g) was At (g).

59

received A+
t (g) would affect subsequent responses, and not the ‘natural’
level At (g).
Note that in our examples, gt had only At and prior history as arguments,
but we can easily imagine settings where gt might also include a randomizer
δt , generated by a random number generator, as an additional argument.54
Note that δt unlike the error terms εj occurring in an NPSEM are simply
determined by the (randomization device of the) person implementing the
dynamic regime. They do not constitute an intrinsic feature of the subject.
It is for this reason that we assume that the new error terms (δt ) are jointly
independent and independent of the εj . (Recall that under the FFRCISTG
model, in contrast to the NPSEM-IE, we do not assume that the εj are
jointly independent.)

5.3

Creating a dynamic regime-specific structural equation
model

Formally, given an NPSEM specifying equations for the variables {Vm (f
pam )},
the imposition of the dynamic regime g supplements and modifies this set
of equations in the following three steps:
(i) For every variable Vm ∈ V replace every occurrence of at as an argu55
ment on the RHS of the structural equation for Vm (pam ) by a+
t ;
Vm (. . . , at , . . .) = fm (. . . , at , . . . , m )
⇒

+
Vm (. . . , a+
t , . . .) = fm (. . . , at , . . . , m ).

(ii) For every variable At ∈ A ⊆ V, create a new variable A+
t and structural equation determined by the regime g:
+
+
A+
t (pat ) = gt (pat , δt ).

(57)

The set pa+
t of input variables for gt are prescribed by the regime g
and may include variables at , a+
s , as , with s 6= t, and vm .
We require that there is a total ordering of all of the variables in the
new system such that the variables that are inputs to a given equation
occur earlier in the ordering.56
54

For example, suppose that in a particular implementation the additional exercise time
requires the presence of a coach, and thus cannot be offered to all patients. Thus subjects
are randomized to have the additional training.
55
Note that since A ⊆ V, Step (i) includes the structural equations for treatment
variables At (pat ).
56
Such an ordering exists if we make the assumption that the function gt+ only takes as
input variables that are temporally prior to A+
t .

60

(iii) The terms δt in the new structural equations are generated independently of any error terms εj or other terms δs .57
We then perform recursive substitution using the new NPSEM to express
each of the variables Vm or A+
t as a function of the error terms {εs } and
the randomization terms {δs }, via function {fs } and {gs }. We write each
of the resulting variables as Vm (g) or A+
t (g) unless it solely determined by
functions {fs }; note that by definition, A+
t (g) is determined by gt .
We will use A+ (g) to denote the set of variables {A+
t (g)}; with slight
abuse of notation we will use V(g) to denote all other counterfactual variables
(i.e. those without a ‘+’ superscript) even if they are not labelled with g;
finally
W(g) ≡ V(g) ∪ A+ (g).
5.3.1

Example

To take the example of the FFRCISTG model corresponding to the graph
G in Figure 20, we might start with the NPSEM:
A 1 = ε1 ,

Y (a1 ) = f (a1 , εY );

under the dynamic regime this is then transformed into:
A1 = ε 1 ,

A+
1 (a1 ) = g1 (a1 , δ1 ),

+
Y (a+
1 ) = f (a1 , Y ),

from which we obtain by recursive substitution:
A1
+
A1 (g)

= ε1 ,
= A+
1 (A1 ) = g1 (A1 , δ1 ) = g1 (ε1 , δ1 ),

Y (g) = f (A+
1 (A1 ), Y ) = f (g1 (ε1 , δ1 ), Y ).
5.3.2

Special Cases

Notice the following two special cases:
• If for all t, A+
t (at ) = gt (at ) = at then Vm (g) = Vm for every m and
every unit in the population. Thus P (V) = P (V(g)).
• If for all t, A+
˜t for some fixed constant a
˜t , so the function
t = gt = a
gt takes no arguments as input, then Vm (g) = Vm (˜
a), and P (V(˜
a)) =
P (V(g)).
57

We say that the regime g is deterministic at s if, gs (pa+
s , δs ) does not depend on δs .
The latter is equivalent to having δs = 0 (or some other fixed constant ) with probability
one. We say the regime g is deterministic if this holds for each s.

61

5.4

Construction of a dynamic Single World Intervention
Graph (d-SWIG) G(g)

Our approach is to first construct a SWIG G(a), but to then add extra edges
from the variables that are inputs into the function gt to the fixed node at ;
we will then relabel each fixed node a by A+ (g).
Definition 24 (The d-SWIG G(g)). Given a template G(a) and a dynamic
regime g for A, the d-SWIG G(g) is defined by applying the following transformation:
(i) replacing each fixed vertex ai with a random vertex A+
i (g) that inherits
children from ai ; we will add dashed directed edges (99K) from every
58
variable that is an input to the function gi to the variable A+
i (g);
(ii) Each random vertex V (aV ) that is a descendant of at least one variable
A+
i (g) is relabeled as V (g).
Note that G(g) will be a DAG since in clause (ii) of the definition of a
dynamic regime-specific structural equation model we require that there is
a total ordering of the variables such that the variables that are inputs to a
given equation occur earlier in the ordering.
For a given dynamic SWIG G(g), we will refer to any dynamic regime
g 0 that would have resulted in the same dynamic SWIG as being compatible
with G(g). In words, these regimes share in common the variables that are
used as input in determining (the distribution of the) the treatment A+
t (g)
prescribed by the regime; however, they may differ on the specific functional
forms. For a given d-SWIG G(g) we will refer to the class of dynamic regimes
g 0 that are compatible with G(g).
The following is an immediate consequence of the construction above.
Proposition 25. Under the FFRCISTG model associated with G, the dynamic regime-specific NPSEM constructed above exists and will be an FFRCISTG associated with G(g).
Note that the vertex set of G(g) is W(g). Observe that under the regime
+
where A+
t (at ) = gt (at ) = at , then for all t At (g) = At . If we re-merge all
split nodes and drop all (g) labels we recover the original graph G. Similarly,
under the regime where for all t, gt = a
˜t , the A+
t (g) nodes become fixed
constants, and the dynamic SWIG reduces to a static SWIG G(˜
a).
58

We used dashed edges (99K) here to indicate that these are given by the function gi

62

5.5

Factorization and Modularity

Proposition 26. Under the FFRCISTG model associated with G, for a
given dynamic regime g, the distribution P (W(g)) factorizes according to
G(g).
Proof: By Proposition 25 the dynamic regime-specific NPSEM is an FFRCISTG associated with G(g) with the ‘observed’ distribution P (W(g)). The
conclusion then follows from Proposition 11.59
2
+
For a given dynamic regime g, let Q(g) ≡ {qtg (a+
|
pa
),
for
A
∈
A}
be
t
t
t
+
the set of conditional densities implied by the structural equations A+
t (pat )
given by (57). The following is then the natural extension of modularity to
dynamic SWIGs:
Definition 27 (Dynamic SWIG Modularity).
The triple (G, P (V), Q(g)) and the pair (G(g), P (W(g))) are said to satisfy the dynamic modularity property if
(i) for every Y (g) ∈ V(g),




P Y (g) = y  {paG(g) (Y (g)) \ A+ (g)} = r, {paG(g) (Y (g)) ∩ A+ (g)} = a+

 (58)
= P Y = y  {paG (Y ) \ A} = r, {paG (Y ) ∩ A} = a+ ,
provided that both sides of (58) are well-defined, and
+
(ii) for every A+
t (g) ∈ A (g),





+
+
+
+ 
+ 
PA+
.
= Pqtg A+
P A+
(g)
=
a
pa
(A
(g))
=
pa

G(g)
t = pat
t =a
t
t
t

(59)
In words, this simply states that for any variable in V(g) the conditional
distribution for the variable given its parents in G(g) under P (W(g)) is equal
to that for V given its parents in G under P (V), while for variables A+
t (g),
g
the distribution is specified by the regime g itself, so qt ∈ Q(g). We then
have:
Proposition 28. Under the FFRCISTG model associated with G, for a
given dynamic regime g, (G, P (V), Q(g)) and (G(g), P (W(g))) obey dynamic
modularity.
59

If g is non-deterministic for each s, d-separation is complete but not otherwise.
However no results in this paper depend on whether or not g is deterministic for some s.

63

Proof: Follows directly from the construction of the regime specific NPSEM,
the definition of dynamic modularity and Proposition 16.
2
Proposition 29. If P (V) factorizes according to G then P (V(g), A+ (g))
factorizes according to G(g) and obeys dynamic modularity with respect to
(G, P (V ), Q(g)) if and only if

P V(g) = v, A+ (g) = a+
(60)


Y 

=
P Vi = vi  {paG (Vi ) \ A} = vpaG (Vi )\A , {paG (Vi ) ∩ A} = a+
pa (Vi )∩A
G

Vi ∈V



+ 
+
+
Pqtg A+
(g)
=
a
,
+
t
t  {paG(g) (At (g)) \ A (g)} = vpaG(g) (A+
t (g))\A
 (g)
+
+
At (g)∈A (g)
+
+
{paG(g) (A+
.
t (g)) ∩ A (g)} = apa
(A+ (g))∩A+ (g)

×

Y

G(g)

t

60

Under the conditions of Proposition 29, equation (60) identifies the distribution resulting from the dynamic regime whenever the RHS is a well-defined
functional of the observed distribution P (V).
5.5.1

Identification via the extended g-formula

Now consider a DAG G with vertex set V = O ∪ H where O and H are,
respectively, subsets of observed and hidden variables.
Definition 30 (The dynamic extended g-formula). Consider a DAG G with
node set V = O ∪ H, regime g, and dSWIG G(g) under which there exists a
topological ordering:61
+
hL1 (g), A1 (g), A+
1 (g), . . . , LK (g), AK (g), AK (g), Y (g)i,
60

As noted earlier, (37) corresponded to the special case of (60) where the intervention
density qi for Ai is a point-mass on a
˜i , i.e. a static regime.
61
Here, with slight abuse of notation, we use Aj (g) as a short hand for ‘Aj (g) or Aj
depending on whether Aj depends on some function gt in the dynamic regime specific
NPSEM corresponding to g’. Likewise for Li (g). Here L1 (g) and A1 (g) would simply be
L1 and A1 in G(g).

64

of the set O(g) ∪ A+ (g) in the dSWIG G(g).62 Define:
+
f g (y, lK , aK , a+
K ) ≡ p(y|lK , aK )

K
Y

p(lj , aj |lj−1 , a+
j−1 )

K
Y

+
qtg (a+
t | pat ),

t=1

j=1

(61)
here qtg ∈ Q(g) is the density corresponding to gt ; pa+
t is the subvector of
(a+
,
l
,
a
)
of
inputs
to
g
.
t
t−1 t t
The right-hand side of (61) is the dynamic extended g-formula density
of Robins et al. (2004, p.2222) associated with (A, O) and the densities
Q(g) in the context of graph G. In the absence of hidden variables, so that
V = O, and (61) being a well-defined function of the distribution of P (O)
then (61) and the right-hand side of (60) are equal. Young et al. (2012) gave
a positivity condition that guarantees (61) is well-defined. To describe that
condition note the distribution obtained from (61) by marginalizing over aK
is:
f g (y, lK , a+
K)


= p(y|lK , a+
K)

K
Y



p(lj |lj−1 , a+
j−1 )

K
XY

j=1

= p(y|lK , a+
K)

K
Y

aK j=1

p(lj |lj−1 , a+
j−1 )

j=1

+
+
qjg (a+
j | paj )p(aj |lj , aj−1 )


K
Y

+
qejg,p (a+
j |aj−1 , lj )



j=1




,



where, for m = 1, . . . , K, qejg,p is defined recursively in terms of qjg and
p(aj |lj , a+
j−1 ) by

+
g,p
a+
qem
m |am−1 , lm

−1 

m
m−1
 X Y

 

Y g,p 
+
, lj
=
qej
a+
|a+
qjg a+
p aj |lj , a+
j
j−1
j |paj
j−1  .

 
j=1

am j=1

62

Note that here we implicitly restrict attention to orderings of the variables under which
At directly precedes A+
t . In general one might wish to consider more general orderings of
the set of variables V(g), A+ (g) as there are distributions P (Y (g)) that are only identified
via g-formulae under these more general orderings. Since, as already noted in §4.1.2, the
g-formula is not a complete algorithm for identification even for static regimes, we choose
to defer the consideration of these more general g-formulae to the broader problem of
constructing a complete algorithm for the dynamic regimes that we consider.

65

+

Then for any Z ⊆ O ∪ AK , f g (z) is well-defined if for all m, a+
m , lm ,


+
+
g,p
qem
a+
> 0 ⇒ p a+
> 0,
m |am−1 , lm
m |am−1 , lm

(62)

(Young et al., 2012).63 Equation (62) is equivalent to the statement that


f g a+
> 0 ⇒ p a+
> 0.
m , lm
m , lm
Here
+
p a+
m | am−1 , lm



+
= P (Am = a+
m | Am−1 = am−1 , Lm = lm ).

Note that (62) suffices to make f g (z) well defined even if Z ∩ AK 6= ∅.
As in our discussion of g-formulae for static regimes, there is no requirement
that the ordering of the sequence of variables be temporal. Again, by analogy
with our earlier discussion we suppose that the ordering of the variables given
by time constitutes one topological ordering of the graph G(g), though, as
before, there may exist other topological orderings that are non-temporal.

5.6

Conditions for identification of a dynamic regime via a
dynamic extended g-formula

Young et al. (2012) noted that when a regime g depends on the natural
value of treatment the identification of the marginal distribution of Y (g)
by the marginal distribution of Y under the dynamic extended g-formula
(61) requires an additional condition that is not needed when the regime
only depends on past values of L and A+ . Specifically they noted that the
natural value of treatment should not itself be a confounder. We now provide
explicit conditions for identification and confirm their insight. However, as
with our earlier discussion of static regimes, in the presence of unobserved
variables, our conditions are not complete.
Suppose that for all a∗ , P (V) and P (V(a∗ )) factor according to G and
G(a∗ ) respectively, and obey modularity. Consider a topological ordering of
+
the graph G(g). Let Lj (g), Aj (g) and Aj (g) indicate initial sequences under
this ordering of the variables in the sets L(g), A(g) and A+ (g) respectively.
63

For a single time-independent treatment Mu˜
noz and van der Laan (2011) and Haneuse
and Rotnitzky (2013) obtained similar results. Mu˜
noz and van der Laan (2012) consider
longitudinal data but appear to analyze it as a collection of single time-independent treatments, as opposed to the truly time-dependent analysis given in Young et al. (2012).

66

We first define the following sets for k = 1, . . . , K:64


Zk (g) ≡ anG(g) (Y (g)) \ Lk (g) ∪ Ak (g) ∪ A+ (g)

(63)

and Zk (a∗ ) ≡ {V (a∗ ) | V (g) ∈ Zk (g)}, the subset of (random) vertices in
G(a∗ ) that correspond to the vertices in Zk (g). Finally, let

Z(g) ≡ anG(g) (Y (g)) \ A+ (g),
and
f g (z) ≡

X

f g (y, lK , aK , a+
K ),

(64)

a+
K, s

where S = O \ Z. We then have the following:
Theorem 31. Assuming (62), for any dynamic regime g compatible with
G(g), if for all a∗ and all k = 1, . . . , K,
Zk (a∗ ) ⊥
⊥ I(Ak (a∗ ) = a∗k ) | Lk (a∗ ), Ak−1 (a∗ ) = a∗k−1 ,

(65)

f g (z) = P (Z(g) = z).

(66)

then
In particular,
P (Y (g) = y) = f g (y),
where
X

f g (y) =

f g (y, lK , aK , a+
K ).

(67)

lK ,aK ,a+
K

Arguing as in Young et al. (2012) we have the following:
Corollary 32. 65 Assuming (62), and the premise of Theorem 31,
pr[Y (g) = y] = E [I {Y (g) = y} W g ]

(68)

where
K
Y

Wg =

q˜jg,p (Aj |Aj−1 , Lj )

j=1
K
Y

.
p(Aj |Aj−1 , Lj )

j=1
64

Note that by definition of ‘ancestor’, Y (g) ∈ anG(g) (Y (g)).
Analogous results were obtained by Haneuse and Rotnitzky (2013) and Mu˜
noz and
van der Laan (2011) for the case of a single time independent treatment.
65

67

Proof: This follows from the Radon-Nikodym Theorem since W (g) is the
likelihood ratio:

.

 +
f g (Y, LK , a+
p(O),
)
K a =A
K

k

2

which by (62) is finite with probability one under P (O).

Here (68) is the Inverse Probability Weighted version of the dynamic
extended g-formula for the distribution of Y (g). See Young et al. (2012) for
further development.
According to Theorem 31, to check identification of Y (g) we proceed in
two steps using two different graphs. For each k:
G(g): We find the set Zk (g) of ancestors of Y (g) in G(g) that are not in
Lk (g) ∪ Ak (g) ∪ A+ (g);
G(a∗ ): We find the corresponding set Zk (a∗ ) and test whether Ak (a∗ ) is dseparated from Zk (a∗ ) given Lk (a∗ ) ∪ Ak−1 (a∗ ) ∪ a∗ in G(a∗ ).
In fact, this test may be performed directly on the graph G(g) if we treat
dashed edges as not being present for the purpose of testing the d-separation
relation.66 The proof of Theorem 31 is given in Appendix B.3.
5.6.1

Examples

Consider the DAG G in Figure 19(i) and the dynamic regime g represented by
the dSWIG G(g) shown in Figure 21(i). In this example the first treatment
+
A+
1 (g) depends on the natural level A1 , while the second treatment A1 (g)
depends on both the natural and assigned levels of treatment at time 1, and
on the intermediate L(g). However, A+
2 (g) does not depend on the natural
level A2 (g). We thus find:
Z(g) = {A1 , L(g), Y (g)},

Z1 (g) = {Y (g), L(g)} and Z2 (g) = {Y (g)}

for the g depicted in Figure 21(i). Examining the template G(a1 , a2 ) shown
in Figure 21(iii) shows that:
{Y (a† ), L(a† )} ⊥
⊥ A1

and

Y (a† ) ⊥
⊥ A2 (a† ) | L(a† ), A1 ;

66

(69)

Formally an edge (99K) may go from a temporally later variable to an earlier A+ . In
that case it then follows from Theorem 31 that if (65) holds the distribution of Y (g) is
identified even though the dynamic regime g cannot be implemented in practice since it
would imply that randomization probabilities at time t depend on variables that are only
observed subsequent to time t. Note that this cannot arise in the absence of individual
level exclusion restrictions: in this case G will be complete and the temporal ordering will
be the only topological ordering of the graph G; see also §7.

68

recall that in order to check this on the graph G(a1 , a2 ) we also condition
on a1 and a2 . Consequently, it follows from Theorem 31 that we have the
following identifying formula for P (Z(g)):
P (A1 = a1 , L(g) = l, Y (g) = y)
X
+
+
+
+
+
p(y|a+
=
2 , l, a1 )q(a2 |l, a1 , a1 )p(l|a1 )q(a1 |a1 )p(a1 ),
+
a2 ,a+
1 ,a2

from which we may obtain the following:
P (Y (g) = y)
X
=

+
+
+
+
+
p(y|a+
2 , l, a1 )q(a2 |l, a1 , a1 )p(l|a1 )q(a1 |a1 )p(a1 ),

+
a1 ,a+
1 ,l,a2 ,a2

P (Y (g) = y | A1 = a1 )
X
+
+
+
+
+
=
p(y|a+
2 , l, a1 )q(a2 |l, a1 , a1 )p(l|a1 )q(a1 |a1 ),
+
a+
1 ,l,a2

+
P (Y (g) = y | A1 = a1 , A+
1 (g) = a1 , L(g) = l)
X
+
+
+
=
p(y|a+
2 , l, a1 )q(a2 |l, a1 , a1 ).
a+
2

Note that these identification results hold even though Y (g) ⊥
6 ⊥A1 , as shown
by the fact that there is a directed path from A1 to Y (g) in G(g) shown in
Figure 21(i). Inspection of the dSWIG in Figure 21(i) shows that
A2 (g) ⊥
⊥ Y (g) | A1 , A+
1 (g), L(g)
hence, further we obtain:
+
P (Y (g) = y | A1 = a1 , A+
1 (g) = a1 , L(g) = l, A2 (g) = a2 )
+
= P (Y (g) = y | A1 = a1 , A+
1 (g) = a1 , L(g) = l).

Now consider the dynamic regime represented by the graph G(g) shown
in Figure 21(ii). In this example the regime for the second treatment A+
2 (g)
depends on the natural level of the second treatment A2 (g) after having
already implemented the regime at the first time point. Consequently, we
now have:
Z(g) = {A1 , L(g), A2 (g), Y (g)}, Z1 (g) = {Y (g), L(g), A2 (g)}, Z2 (g) = {Y (g)}.
69

However, A1 is not d-separated from A2 (a1 ) in the graph G(a1 , a2 ) shown in
Figure 21(iii), since the path
A1 ← H1 → A2 (a1 )
d-connects (given a1 and a2 ). Due to the presence of the unmeasured confounder H1 , in general the distribution P (A2 (a1 )) is not identified. Consequently there are dynamic regimes g compatible with G(g) under which
P (Y (g)) is not identified. This last conclusion follows since d-separation is
a complete criterion for independence on a DAG, hence d-separation is also
complete for independence among the counterfactual variables in a dSWIGs
G(g), letting the dynamic regime g vary over all compatible regimes. Following Young et al. (2012), we say the lack of identification is due to ‘confounding by the natural value of treatment’.
Consider now the random dynamic regime grand in which for m = 1, 2,
g,p + +
+
Am is drawn from qem
(am |am−1 , lm ); see (Young et al., 2012). Note that
the regime grand does not depend on a subject’s ‘natural’ values Am (grand ),
so that there can no longer be confounding by the natural value of treatment and the distribution of Y (grand ) should be identified. Indeed it follows
from Figure 19 and Corollary 34 (below) that the distribution of Y (grand ) is
identified by the dynamic extended g-formula (67), even though, as we have
just seen, the distribution of Y (g) is not identified.

5.7

Reformulation of the identification condition via perturbed regimes

The identification condition (65) given in Theorem 31 requires one to check
d-separation between each Ak (a∗ ) and the set of vertices Zk (a∗ ). The
next result shows that by considering a set of modified regimes we can
re-formulate the condition in terms of the existence of paths between (the
vertices corresponding to) Ak and Y .
Specifically, given a dynamic regime g we will define for j = 1, . . . , K,
the perturbed regime g−j to be the regime obtained from g by replacing aj
by a fixed number a
˜j whenever it is present in any equation:
A+
k (. . . , aj , . . .) = gk (. . . , aj , . . .)

A+
˜j , . . .) = gk (. . . , a
˜j , . . .).
k (. . . , a
(70)
Note that it follows from the construction of the dynamic regime specific
NPSEM that aj is only present in structural equations for other variables
+
A+
k (since in the construction aj is replaced by aj for all other variables).
It follows that the corresponding dynamic SWIG G(g−j ) is obtained from
G(g) by simply removing any (dashed) edges that are directed out of Aj (g).
⇒

70

Lemma 33. The following conditions are equivalent:
(i) In G(a† ), Ak (a† ) is d-separated from Zk (a† ) by Ak−1 (a† ) ∪ Lk (a† ) ∪ a† ;
(ii) In G(g−k ), Ak (g−k ) is d-separated from Y (g−k ) given Ak−1 (g−k ) ∪
+
Lk (g−k ) ∪ Ak−1 (g−k ).
Note that condition (ii) is equivalent to checking in G(g) for the absence
of a d-connecting path between Ak (g) and Y (g) that begins Ak (g) ← · · · ,
sometimes referred to as a ‘backdoor path’. See Appendix B.4 for the proof.
5.7.1

Special case: Regimes in which treatment assignment does
not depend on natural treatment levels

In the special case where treatment at time k, A+
k (g), only depends on
+
Lk (g)∪Ak−1 (g), but does not depend on any of the ‘natural’ treatment levels
(Ak (g)) then there is a simple identification condition that solely requires
testing d-separation in G(g):
Corollary 34. In a graph G(g), if there are no edges from any A−
k (g) to
+
any Aj (g), then the following are equivalent:
(i) In G(a), Ak (a) is d-separated from Zk (a) given Ak−1 (a) ∪ Lk (a) ∪ a;
+

(ii) In G(g), Ak (g) is d-separated from Y (g) given Ak−1 (g)∪Lk (g)∪Ak−1 (g).
Thus, if condition (ii) holds then the identifying formula (66) for the distribution of Y (g) holds.67
Proof: This follows immediately from Lemma 33 and the observation that
+
2
if there are no edges from A−
k (g) to Aj (g) then G(g−k ) = G(g).

6

NPSEM-IE: Doubly-exponentially many additional untestable assumptions

To bring the distinction between the FFRCISTG and NPSEM-IE models
into sharper focus we consider the particular case of a complete graph G
67
Robins (1997, Theorem 4.2) and Dawid and Didelez (2008) also gave a graphical condition that implied the identifying formula (66). However, unlike the graphical condition
(ii) given here, their condition required K graphs to be consulted.

71

H2
H1

(i)

A1

L(g)

A+
1 (g)

A2 (g)

Y (g)

A+
2 (g)

H2
H1

(ii)

A1

L(g)

A+
1 (g)

A2 (g)

Y (g)

A+
2 (g)

H2
H1

(iii)

A1

L(a1 )

a1

A2 (a1 )

Y (a1 , a2 )

a2

Figure 21: (i) and (ii) show graphs G(g) derived from the template in Figure
19(ii). In (i) A+
2 (g) is not a function of A2 (g), and P (Y (g)) is identified. This
identification fails in (ii) since A+
2 (g) is a function of A2 (g), thus A2 (g) ∈
Z0 (g). (iii) shows the corresponding template G(a1 , a2 ) used to test the
d-separation relation (65) in Theorem 31.
72

H2
H1

(i)

A1

L(g)

A+
1 (g)

A2 (g)

Y (g)

A+
2 (g)

H2
H1

(ii)

A1

L(a1 )

a1

A2 (a1 )

Y (a1 , a2 )

a2

Figure 22: (i) the d-SWIG G(g) derived from the template in Figure 13(ii)
under a dynamic regime g for which treatment at the second time A+
2 (g)
depends on past treatment and covariate history (A+
(g)
and
L(g)).
P
(Y
(g))
1
is not identified since A+
(g)
is
a
function
of
L(g)
and
hence
L(g)
∈
Z
0 (g),
2
but there is a d-connecting path from A1 to L(a1 ) in G(a1 , a2 ), as shown
in (ii). Thus the d-separation relation (65) in Theorem 31 does not hold.
Since g here does not depend on A1 or A2 (g) we may also apply Corollary
34 to G(g) directly: Since there is a path d-connecting A1 and Y (g) (given
∅) condition (iii) fails to hold for k = 1.

73

No. Actual Vars.

2

3

4

Dim. P (V)
No. Counterfactual Vars.
Dim. Counterfactual Dist.

3
3
7

7
7
127

15
15
32767

Dim. FFRCISTG

5

113

32697

Dim. NPSEM-IE

4

19

274

Difference

1

94

32423

K
2K − 1
2K − 1
K
(2
2 −1) − 1
P
K
j
j
(2(2 −1) − 1) − K−1
j=1 (4 − 2 )
PK−1 2j
j=0 (2 − 1)
K −2

O(22

)

Table 2: Dimensions of counterfactual models associated with complete
graphs with binary variables.
with all variables binary. In this case paG (Vk ) = {V1 , . . . , Vk−1 } hence there
are 2k−1 counterfactual variables associated with Vk :
Vk (0, . . . , 0), Vk (0, . . . , 0, 1), . . . , Vk (1, . . . , 1).
Thus in total there are 2K − 1 primitive counterfactual variables associated
with the NPSEM for G. It follows that in the absence of any restrictions,
the set of all joint distributions:
P ({Vj (a†j−1 ) ; 1 ≤ j ≤ k, a†j−1 ∈ Aj−1 })
K

is of dimension 22 −1 − 1.
Recall that the defining independence (17) for an FFRCISTG simply
requires that the set of counterfactual variables that are compatible with
the same intervention:
{V1 , V2 (a†1 ), . . . , VK (a†K−1 )}
are jointly independent. Notice that this is exactly the set of independence
relations represented in the graphs G(a† ). For the case where K = 3, the
independence structure is illustrated in Figure 23. The graphs shown in
Figure 23(c),(d),(e) use bi-directed edges (↔) to represent marginal independence.68 The independence restrictions present in the FFRCISTG model
68

The independence structure may be read from these graphs by simply applying the
natural extension of the d-separation whereby every (non-endpoint) vertex on a path is a
collider, and there are no non-trivial ancestors, so an(V ) = {V }. Thus, in particular, if
two vertices are not joined by a bi-directed edge then they are marginally independent;
see Drton and Richardson (2008) for more details.

74

(with K = 3) are shown via the five graphs in Figure 23(c). It is impossible to represent the structure using a single graph because, although the
model requires M (z0 )⊥
⊥Y (z0 , m0 ) and M (z0 )⊥
⊥Y (z0 , m1 ) it does not im69
ply M (z0 )⊥
⊥Y (z0 , m0 ), Y (z0 , m1 ).
Thus in particular, the independence
structure does not obey the composition axiom:
A⊥
⊥B

and A⊥
⊥C

⇒

A⊥
⊥B, C.

All existing approaches to representing conditional independence structure
via pathwise Markov properties obey this axiom.70
We finesse this problem here by indicating the independence structure
on the specific margins associated with variables that are observed (the
four graphs containing three variables). We also include a single complete
graph including all variables in order to emphasize that joint independence
relations such as M (z0 )⊥
⊥Y (z0 , m0 ), Y (z0 , m1 ), do not hold even though
the marginal independencies M (z0 )⊥
⊥Y (z0 , mi ) for i = 0, 1 hold under the
71
FFRCISTG.
In Figure 23(d) we show the smallest bi-directed graphical model that
contains the FFRCISTG. This example is important because it shows that
there are data-generating processes that do not involve determinism or
parametric cancellation in which cross-world independence relations such
as M (z0 )⊥
⊥Y (z1 , m0 ) do not hold.
It follows from the M¨
obius parametrization given in (Drton and Richardson, 2008) that such a distribution is defined by a set of equations of the
form:
P (Vk (a†k−1 ) = 0, W(a†k−2 ) = 0) = P (Vk (a†k−1 ) = 0)P (W(a†k−2 ) = 0)

(71)

where W(a†k−2 ) is a non-empty subset of {V1 , V2 (a†1 ), . . . , Vk−1 (a†k−2 )}. Since,
choosing a†k−1 , there are 2k−1 random variables Vk (a†k−1 ), and then for fixed
a†k−1 there are 2k−1 − 1 non-empty subsets W(a†k−2 ), we see that the set of
joint distributions in the FFRCISTG model is of dimension:
K −1)

(2(2

− 1) −

K
X

2j−1 (2j−1 − 1) = (2(2

j=1

K −1)

− 1) −

K−1
X

(4j − 2j ).

j=1

69

Here Y (z0 , m1 ) is an abbreviation for Y (z = 0, m = 1), likewise for M (zi ).
In this respect, the claim of (Pearl, 2009, p.353, fn.12) that “with all due respect to
multiculturalism, all approaches to causation are variants or abstractions of the structural
theory presented in this book.” seems incorrect.
71
As we have emphasized earlier, elsewhere in this paper we do not construct graphs
including potential outcomes corresponding to interventions from different worlds. We
construct such graphs here, solely for the purpose of contrasting the FFRCISTG and the
NPSEM-IE.
70

75

(a)

Z

(c)

(d)

(e)

M

(b)

Y

M (z)

Z
z

Y (z, m)

m

M (z0 )

Y (z0 , m0 )

Y (z0 , m1 )

M (z1 )

Y (z1 , m0 )

Y (z1 , m1 )

Z

Z

M (z0 )

Y (z0 , m0 )

Z

M (z0 )

Y (z0 , m1 )

Z

M (z1 )

Y (z1 , m0 )

Z

M (z1 )

Y (z1 , m1 )

M (z0 )

Y (z0 , m0 )

Y (z0 , m1 )

M (z1 )

Y (z1 , m0 )

Y (z1 , m1 )

M (z0 )

Y (z0 , m0 )

Y (z0 , m1 )

M (z1 )

Y (z1 , m0 )

Y (z1 , m1 )

Z

Z

Figure 23: (a) A DAG G; (b) the template G(z, m); Bi-directed graphs indicating
the independence assumptions on the one-step ahead counterfactuals present (with
binary variables) in: (c) The FFRCISTG model associated with G: this is a nongraphical Markov model represented here via separate graphs for separate margins
(semi-circles indicate SWIGs, with fixed nodes omitted). (d) the smallest graphical
marginal independence model containing the FFRCISTG; (e) the NPSEM-IE. Here
‘zi ’ abbreviates ‘z = i’, likewise for mi .
76

In contrast, the NPSEM-IE model supposes that sets of counterfactual variables associated with distinct actual variables are independent; see Figure
23(e). As the graph suggests we may group together the 2j−1 counterfactual random variables associated with Vj , simply regarding each group as
j−1
a single single random variable with a state space of cardinality 22 ; the
NPSEM-IE requires that these ‘grouped variables’ be jointly independent.
It follows from this directly that the dimension of the NPSEM is:
K
X

j−1

(22

− 1).

j=1

Further, we have the following relationship between the dimensions of the
models corresponding to complete graphs with K variables in the case where
all variables are binary:
K −2)

dim(FFRCISTG(K)) − dim(NPSEM-IE(K)) ≥ 2(2

(72)

for K > 2. Thus the number of additional counterfactual independence
assumptions present in an NPSEM-IE, but not in the FFRCISTG grows at
a doubly-exponential rate. These results, together with those for K = 2, 3, 4
are summarized in Table 6.
The doubly exponential growth in the number of untestable assumptions
is of great significance given that, as we have discussed, these additional
restrictions are not experimentally testable.

6.1

Differences in identification results between FFRCISTGs
and NPSEM-IEs

In this section we further examine differences between the FFRCISTG model
and the NPSEM-IE by studying causal effects that are identified and counterfactual independencies that hold under the latter but not the former
model.
6.1.1

Cross-world independence

Consider the independence:
Y (z = 1, m = 0) ⊥
⊥ M (z = 0) | Z,

(73)

in the context of the DAG shown in Figure 9(i). (73) is a ‘cross-world
independence’ and thus is not implied by an FFRCISTG model as there is
no SWIG that contains both Y (z = 1, m = 0) and M (z = 0).
77

The following is an example of a distribution contained in the FFRCISTG model (and thus obeying factorization and modularity), represented
as an NPSEM (with dependent errors), that violates (73).
M (z) = (1 − z) · I(εM > 1/2); Y (z, m) = z · I (εY > 1/2) ;

Z = εZ ;
εZ ⊥
⊥ {εM , εY };

εM = εY ∼ Unif(0, 1).
(74)

εZ = Ber(1/2);

Under an NPSEM, the distribution of the errors P (εZ , εM , εY ) is used to
induce a distribution on the actual variables P (Z, M, Y ).72 Note that M (z =
1) = 0, while Y (z = 0, m) = 1. Thus Y (z = 1, m) ⊥
⊥ M (z = 1) and Y (z =
0, m) ⊥
⊥ M (z = 0) both hold under an FFRCISTG model; therefore both
independences must hold on the associated SWIG G(z, m); see Figure 9(iv).
We then have:
P (Y (z = 1, m = 0) = 1, M (z = 0) = 1 | Z) = P (Y (z = 1, m = 0) = 1, M (z = 0) = 1)
= P (εY > 1/2, εM > 1/2)
= P (εY > 1/2) = 1/2.
However, P (Y (z = 1, m = 0) = 1 | Z) = P (M (z = 0) = 1 | Z) = 1/2, so (73)
does not hold.73 The independence (73) is of interest because it is used to
identify
P DE ≡ E[Y (z = 1, M (z = 0))] − E[Y (z = 0, M (z = 0))],
the pure direct effect (Robins and Greenland, 1992), later re-named the
‘natural direct effect’ (Pearl, 2001b). Robins and Richardson (2011) give
bounds on the PDE under the independence relations implied by the template G(z, m).
In contrast, the independence (73) would hold under the NPSEM-IE associated with the DAG in Figure 9(i).74 This is because the NPSEM-IE
model wrongly assumes the data were generated by a distribution with εM
and εY independent. However even though the errors are actually correlated,
72

Thus here M = M (Z); Y = Y (Z, M (Z)).
The observant reader will note that in NPSEM in (74) M has no effect on Y . This is
purely to reduce the number of parameters used to specify the NPSEM and is not required
for (73) to fail. Similar comments apply to the determinism in this example. See Figure
23(d) for a general (graphical) generating process that violates (73).
74
This may be verified by examining Figure 23(e) or via the ‘twin-network’ method of
Balke and Pearl (1994).
73

78

the mistaken hypothesis that they are independent cannot be empirically refuted, even were additional data available from the following ideal randomized experiments – one in which Z alone was randomized thereby identifying
P (M (z) = m, Y (z) = y) and one in which both Z and M were randomized
allowing identification of P (Y (z, m) = y). Since the observed generating process was an FFRCISTG model it follows from the modularity property of
G(z) in Figure 9(ii) that we would find P (Y = y, M = m | Z = z) agrees with
the distribution P (M (z) = m, Y (z) = y) from the first experiment. Similarly,
by modularity for G(z, m), we would find that P(Y = y | M = m, Z = z)
agrees with P (Y (z, m) = y) from the second trial. If such was not the case
we could reject the FFRCISTG model (of course still assuming ideal trials).
Presumably Pearl, in insisting on the NPSEM-IE model, would view
the DAG in Figure 9(i) as mis-specified since the dependence between the
errors εM and εY is not represented on the graph. In contrast, since the
FFRCISTG model allows for such dependence, there is no need for the
graph to represent the dependence, especially when, as discussed above,
there is no experimental test (involving the variables Z, M and Y ) that
could distinguish between the two models. It is of little practical relevance
to insist that all NPSEM-IE models should be correctly specified (i.e. with
independent errors), if there is no empirical test (even in principle) that can
determine whether this is the case.75
Nonetheless if there were agreement between experimental distributions
and observed conditional distributions, one might often conclude, based on
Bayesian inferences with a prior over structures, or simplicity arguments
(aka the faithfulness assumption; Spirtes et al. (1993)) that εM ⊥
⊥ εY , so
that an NPSEM-IE held.
Our point is simply that such inferences clearly rely on additional external information or principles, which must be argued for in each case. Of
particular interest, Robins and Richardson (2011, §4, Fig. 6.3) discuss an
expanded graph (G ∗ ) containing more variables than the original graph (G)
in Figure 9(i) under which (73) could be tested in a randomized experiment
whose treatments correspond to the variables on the expanded graph G ∗
76 that are absent from the original graph G, thereby preserving the link
between causal model and experiments introduced by Neyman (1923).
75
In the absence of any method, even in principle, of testing the underlying assumptions,
Pearl’s contention that inferences based on an NPSEM-IE are safe provided that the model
is correctly specified Pearl (2010) is reminiscent of the reassurance that ‘Though it has no
seat-belts, this car is safe to drive provided that one avoids being involved in an accident.’
76
Though we do not do so here, the SWIG framework may be extended to include
interventions on expanded graphs of this type.

79

(i)

Z

(ii)

M

z

Z

Y

M (z)

Y (z)

Figure 24: (i) A DAG G: (ii) the SWIT G(z).
6.1.2

A common cause of two unrelated effects

Next consider the DAG shown Figure 24(i), in which M has no direct effect
on Y . Suppose that we wish to test the independence:
Y (z = 1) ⊥
⊥ Z | M.

(75)

An NPSEM with dependent errors that obeys factorization and modularity,
but violates (75) is shown here:
Z = εZ ;
M (z) = (1 − z) · I(εM 0 < 3/4) + z · I(εM 1 < 1/4);
Y (z) = (1 − z) · I(εY 0 < 1/4) + z · I(εY 1 < 3/4);
εZ ⊥
⊥ {εM ≡ (εM 0 , εM 1 ), εY ≡ (εY 0 , εY 1 )};
εM 0 ⊥
⊥ εM 1 ,

εM i = εY (1−i)

and εM i ∼ Unif(0, 1) for i = 0, 1.

Notice that here the error terms εM and εY are bivariate. The error structure
here is such that although Y (z) ⊥
⊥ M (z), we have dependence between Y (z)
and M (1 − z).
The independence (75) is of interest as it is required in order to identify the intervention distribution P (Y (˜
z ) | M = m) consequently this is not
identified under our counterfactual model. However, P (Y (˜
z ) | M (˜
z ) = m)
is identified, since Y (˜
z) ⊥
⊥ Z | M (˜
z ) is implied by G(˜
z ). Once again, the
independence (75) is implied by the NPSEM-IE associated with the DAG
shown Figure 24(a), which may be verified via the ‘twin-network’ method
of Balke and Pearl (1994).

80

H

B

H

C

B

C

Y

Y

(a-i): G

(b-i):

H

G∗

H

B

C(b)

B

C

b

c

b

c

(a-ii): G(b, c)

Y (b, c)

Y (b, c)
(b-ii):

G ∗ (b, c)

Figure 25: (a-i), (b-i) Two different DAGs G, G ∗ ; H is unobserved, but
known to have no (individual-level) effect on Y ; in G ∗ in addition, B has
no (individual level) effect on C; (a-ii), (b-ii) the corresponding templates
G(b, c) and G ∗ (b, c). Under the associated FFRCISTG models the ‘effect
of treatment on the double treated’ E[Y (b1 , c1 ) − Y (b0 , c0 )|B = 1, C = 1] is
identified under (b) but not (a). In contrast, the this quantity is identified
under both of the associated NPSEM-IE models.

81

6.1.3

Effect of treatment on the double treated

For our last example we consider the DAGs G, G ∗ , shown in Figure 25(a-i)
and (b-i). First note that the controlled direct effect (CDE):
E[Y (b0 , c0 ) − Y (b† , c† )]
is identified under both of these models.
However, now consider the ‘effect of treatment on the double treated’:
E[Y (b = 1, c = 1) − Y (b = 0, c = 0) | B = 1, C = 1].

(76)

This quantity is identified if
Y (b = 0, c = 0) ⊥
⊥ C, B.

(77)

This may be seen as follows:
E[Y (b = 1, c = 1) − Y (b = 0, c = 0) | B = 1, C = 1]
= E[Y (b = 1, c = 1) | B = 1, C = 1] − E[Y (b = 0, c = 0) | B = 1, C = 1]
= E[Y (b = 1, c = 1) | B = 1, C = 1] − E[Y (b = 0, c = 0) | B = 0, C = 0]
= E[Y | B = 1, C = 1] − E[Y | B = 0, C = 0].
Here the second equality follows from the independence (77), and the third is
by consistency. Inspection of the template G ∗ (b, c) shown in Figure 25(b-ii)
reveals that this graph does imply (77). Consequently (76) is identified.
However, when the B → C edge is present, as in G, we are not able to
infer (77) from G(b† , c† ) as the variable C(b† ) rather than C appears in the
SWIG. In Section 7.1.4 we give an example of an NPSEM model that is in
the FFRCISTG model associated with G, yet for which (77) does not hold.77
Consequently (76) is not identified under this model. However, similarly to
the analysis in §6.1.2, the independence:
Y (b = 0, c = 0) ⊥
⊥ C, B(b = 0).

(78)

does hold under the FFRCISTG associated with G.
In contrast, the independence (77) does hold under the NPSEM-IE model
associated with G, and consequently (76) is identified under this model. This
may be established via the counterfactual graph approach of Shpitser and
Pearl (2007, 2008).
77

In fact, the NPSEM given in Section 7.1.4 is also in the FFRCISTG corresponding to
the submodel in which the edges B → H ← C are not present.

82

Naively one might imagine that if the FFRCISTG model associated with
G held then this would also imply that the FFRCISTG model X → Y held
where X = (B, C) is a new variable obtained by combining B and C so
that X has state space X = B × C (where B and C are the state spaces
for B and C). However, this implication is false because if the FFRCISTG
X → Y held then it would follow directly that X⊥
⊥Y (x) which is equivalent
to the independence (77); recall the template Figure 3. Furthermore this
implication would also fail even if the edges B ← H → C were absent from
the DAG G.
6.1.4

Implications for feasibility and identification of dynamic
regimes

As discussed in (Robins and Richardson, 2011) the limited counterfactual
independence conditions that define an FFRCISTG model were chosen in
an attempt to ensure that any intervention distribution identified under the
model would be, at least in principle, experimentally testable via a randomized experiment. However, Robins (1986) did not consider intervention
regimes in which the treatment A+
1 (g1 (A)) was a function of the natural
value A1 of A. In Section 5 we considered the regime with g(A) = max(A, 20)
where A was the natural level of exercise and described how the regime could
implemented in an experiment consistent with Robins’ intentions.
Now however consider the exercise regime:
0
0
A+
1 (g ) = g (A1 )

where

g 0 (x) ≡ max{0, x − 10}.

under which if in the absence of an intervention one would have exercised
for x minutes, then under the intervention one would be required to reduce
their exercise time by 10 minutes.78 Clearly this regime, in contrast to g,
could not be experimentally implemented as the act of observing the amount
of exercise the patient would have carried out in the absence of the regime,
necessarily precludes them from exercising for the exact number of minutes
that the regime prescribes !79
However under the FFRCISTG model for the DAG in G in Figure 20(a)
Theorem 31 implies that the distribution of P (Y (g 0 ) = y) is identified by
78

Note that this regime is not the same as the regime: ‘Exercise for 10 minutes less
than you planned to.’ because “The best laid plans of mice and men often go astray”. For
example, in the absence of a regime, someone might, due to unexpected pain, stop twenty
minutes sooner than they had planned to.
79
Here assuming the non-existence of time travel and that A1 > 10

83

the dynamic extended g-formula,
X

P (Y (g 0 ) = y) =
P (Y = y | A1 = a+ )I a+ = max {0, a − 10} P (A1 = a)
a,a+

which seemingly contradicts Robins’ intention mentioned above that identification results under an FFRCISTG be testable (at least in principle).
However this is a contradiction only if, in the context under discussion,
the assumption that the DAG in Figure 20(a) represents an FFRCISTG is
warranted.
However, this is not the case due to the phenomenon that we observed
in §6.1.3. There, we considered a counterfactual distribution
P ({B, C(b† ), Y (b† , c† ) such that b† ∈ B, c† ∈ C})
in the FFRCISTG model corresponding to the DAG in Figure 28(a), that includes an edge B → C, so that the first treatment (B) influenced the second
(Y ).80 We saw that it does not follow that the counterfactual distribution:
P ({X, Y (x† ) such that X = (B, C); x† = (b† , c† ); b† ∈ B, c† ∈ C})
obtained by combining B and C into a single variable, will be in the FFRCISTG model associated with the graph X → Y .
The implication for the infeasible regime g 0 described above is thus
as follows: Let B1 , . . . , Bt , . . . , BT be a sequence of temporally ordered
treatments, where Bt indicates that the patient is still exercising at time
t, and T is large. Let GT be the complete DAG given by the ordering
hB1 , . . . , Bt , . . . BT , Y i. Interventions on the variables on graph GT would
all be implementable and would include a dynamic regime equivalent to the
feasible regime g described above. Since the DAG GT represents the actual data generating process it is reasonable to assume that the FFRCISTG
assumption holds.
Recall that the variable A1 , encoding the total time exercised, is obtained
by combining the treatments {Bi }. The obvious extension of the discussion
in Section 6.1.3 then implies that the fact that the FFRCISTG model associated with GT holds, does not imply that the FFRCISTG associated with
the graph A1 → Y holds. Consequently there is no contradiction.
80

In Section 6.1.3 we also allowed for an unobserved confounder H of B and C, but as
we noted our conclusions are not changed if the edges B ← H → C are absent.

84

7

SWIGs using population-level exclusions

The FFRCISTG approach presumes an underlying NPSEM. In the previous
section we built our SWIG under the assumption that we knew the structure
of this NPSEM and were given a graph G in which the absence of an edge
A → Y indicated that A does not appear in the structural equation for Y . In
other words, we presuppose that in such a case we have prior knowledge that
there is no individual-level effect of A on Y (relative to the other variables
faY ) = Y (a∗ , p
faY ), for all a
in the graph), so that Y (˜
a, p
˜, a∗ and assignments
faY of values to the parents of Y in G.
p
Suppose on the other hand we did not know a priori whether or not A
had a direct effect on Y and therefore we collected observational data to test
whether the effect was present. Assume we had unlimited data so sampling
variability can be ignored. Suppose positivity holds and thus under our
faY ) = y) is identified by P (Y = y | A =
FFRCISTG assumption, P (Y (˜
a, p
faY ) and we found that P (Y = y | A = a, PAY = p
faY ) did not
a, P AY = p
faY . We therefore concluded that P (Y (˜
faY ) = y)
depend on a for any p
a, p
did not depend on a and thus that A had no population direct effect on Y
(relative to the variables in PAY ). Further assume that were we to perform
an idealized randomized experiment on an exchangeable population to check
the no confounding assumption of our FFRCISTG we would again find no
direct effect. The question then arises whether one should conclude that A
had no direct effect for every subject and therefore that A does not occur
in the structural equation for Y ; alternatively one may choose to remain
agnostic as to whether A is present in the structural equation as it is logically
possible, and empirically untestable, that harmful and helpful individual
level direct effects of A on Y exist but balance out over the population.
Suppose to remain (epistemologically) consistent with the spirit of the
FFRCISTG model we choose to make only those assumptions that could be
consistently tested were data from an ideal randomized experiment available.
In that case, we would not assume that A is absent from the structural
equation for Y , as there is no consistent test for the absence of a variable
from a structural equation. This is because, as discussed above, it is logically
faY ,
possible that for all values of p
faY ) = y) = P (Y (a† , p
faY ) = y),
P (Y (˜
a, p
faY ) 6= Y (a† , p
faY ) for some units. Thus an approach that
and yet Y (˜
a, p
requires that all assumptions in the model be testable (at least in principle)
via an ideal randomized experiment would make exclusion restrictions at
the population rather than individual level.
85

In this section we will describe how to construct a SWIG that allows for
some missing arrows to represent no effect at the individual level and others
to represent only no causal effects at the population level; thereby allowing
one to have different opinions for different variables about absence of direct
effects at the individual level. This is a novel innovation supplied by SWIGs.
We will see that this may be achieved by first constructing a SWIG from an
FFRCISTG, as described in §3.3 and then removing edges from the SWIG
when this is permitted by (the Markov structure of) the distribution over
the actual variables.

7.1

The SWIG G G (˜
a)

Our starting point will be to assume an (individual level) FFRCISTG model
associated with a DAG G as in Section 3. Again to stay within the sprit
of the FFRCISTG model we would usually take G to simply be a complete
DAG given by the time-order. However the general theory that we now
develop does not require G to be complete. In the following we will suppose
that the distribution of the actual variables P (V) factorizes according to a
DAG G that is a subgraph of G.
Definition 35. The template G G (a) induced from G(a) by the subgraph G
is the graph obtained from G(a) by removing any edge that is not present in
G under the natural correspondence (19).
Note that the labeling of the counterfactual variables in G(a) is inherited
by the variables in G G (a). Thus if V (aV ) is a vertex in G G (a) then aV is the
set of fixed nodes that are ancestors of V in G(a), which will, in general, be
a superset of the set of fixed vertices that are ancestors of V (aV ) in G G (a).
7.1.1

Factorization and Modularity

Under positivity, the SWIG G G (˜
a) obtained by instantiating G G (a) captures
the structure of the distribution of the counterfactual variables V(˜
a) under
the additional assumption that P (V) factorizes according to G:
Proposition 36. Under the FFRCISTG model associated with the DAG G
if P (V) is positive and factors according to a subgraph G of G , then P (V(˜
a))
factorizes with respect to the SWIG G G (˜
a).
Proof: This is a special case of Theorem 40 below.
In addition, the analogous modularity property holds:

86

2

Proposition 37. Under the FFRCISTG model associated with the DAG G if
P (V) is positive and factors according to a subgraph G then (P (V(˜
a)), G G (˜
a))
obeys modularity with respect to (P (V), G).
2

Proof: This is a special case of Theorem 42 below.

It follows from Propositions 36 and 37 that under positivity conditions
the g-formula identification results in Section 4 also apply to (P (V(˜
a)), G G (˜
a))
and (P (V), G). This is because Theorem 22 merely required that the properties of factorization and modularity hold, and did not require that the
counterfactual distribution be in the FFRCISTG associated with G.81 In
fact, since we do not make all of the individual level exclusion restrictions
associated with G, although the counterfactual distributions P (V(˜
a)) we consider will be in the FFRCISTG model associated with G they may not be in
the FFRCISTG associated with G. Also note that when applying Theorem
22 we are free to use any topological ordering of of G even though this may
not be a topological ordering of G.
The population exclusion property is formalized in the following:
Proposition 38. Under the FFRCISTG model associated with the DAG G
if P (V) is positive and factors according to a subgraph G, then for any set
B such that paG (Y ) ⊂ B, for all assignments b† , b‡ ,
P (Y (b† ) = y) = P (Y (b‡ ) = y),

whenever

b† paG (Y ) = b‡ paG (Y ) .

Proof: This is an immediate consequence of Proposition 36; see (94) below.2

7.1.2

A two variable example

Consider a distribution in FFRCISTG model associated with the DAG G in
Figure 26(a). The SWIG G(b) is shown in Figure 26(c). By Proposition 11
factorization is obeyed so that for all b, y, b† :
P (B = b, Y (b† ) = y) = P (B = b)P (Y (b† ) = y).

(79)

Further, by Proposition 16 modularity holds so we have for all b† , y:
P (Y (b† ) = y) = P (Y = y | B = b† )

(80)

81
Propositions 11 and 16 establish that for any counterfactual distribution in the FFRCISTG model associated with G factorization and modularity hold with respect to G, but
as shown in this section, membership in the FFRCISTG model for G is not a necessary
condition for factorization and modularity with respect to G to hold.

87

B

Y

B

Y
(b): G

(a): G

B

b

Y (b)

B

b

(c): G(b)

Y (b)

(d): G G (b)

B

Y

b

(e): G(b)

Figure 26: Representing population level exclusion restrictions: (a) The underlying NPSEM G; (b) a DAG G with respect to which we assume P (B, Y )
factors; (c) the template G(b); (d) the template G G (b) induced from G(b) by
G. (e) For comparison, the SWIG G(b) obtained from G if the individual
level exclusions given by the FFRCISTG associated with G held.

88

for all values for which both sides of the equality are well-defined.
Now consider the trivial subgraph G in Figure 26(b).
The induced SWIG G G (b† ) is shown in Figure 26(d). Notice that the
equation (79) establishes that P (B = b, Y (b† ) = y) also factorizes according
to G G (b† ). This is because the edge that is ‘lost’ in G G (b† ) takes the form
b → Y (b† ), originating from a variable that is fixed in G G (b† ). Thus P (B =
b, Y (b† ) = y) factorizes according to G G (b† ) regardless of whether P (B, Y )
factorizes according to G; see Corollary 41 below.
Now suppose further that the observed distribution P (B, Y ) factorizes
according to G, so that for all b, y:
P (B = b, Y = y) = P (B = b)P (Y = y).
Under positivity, it follows that for all b† :
P (Y = y) = P (Y = y | B = b† ).

(81)

Together, (80) and (81) establish that
P (Y (b† ) = y) = P (Y = y),

(82)

holds for all b† , y, and thus (P (B, Y (b† )), G G (b† )) obeys modularity with
respect to (P (B, Y ), G). Note that as an immediate implication of (82) it
holds that P (Y (b† )) = P (Y (b‡ )), so that a population exclusion restriction
obtains even though under the NPSEM associated with G, Y (b† ) = Y (b‡ )
may not hold.
We contrast this interpretation with that of the SWIG G(b† ) shown in
Figure 26(e), that would be obtained under the stronger assumption of an
NPSEM obeying the FFRCISTG associated with G (rather than G). This
SWIG does imply Y (b† ) = Y (b‡ ), as may be inferred by recalling Section
§3.4: since in the SWIG G(b† ), Y is not labeled with b† , the node represents
the equivalence class of counterfactual variables {Y (b∗ )}, where b∗ is any
value of B.
The following is an example of an NPSEM that satisfies the FFRCISTG
independence assumption associated with G, though not the FFRCISTG
assumption for G, yet for which P (B, Y ) still factorizes with respect to G:
B = εB ;

Y (b) = I(εY = b);

where εB , εY are independent Bernoulli(0.5) random variables. It follows
that P (Y (b = 0) = y) = P (Y (b = 1) = y) = 0.5, however, we see that
Y (b = 1) = 1 − Y (b = 0); (see also Pearl, 2000, pp.35-36). Consequently, the
FFRCISTG model for G does not hold since it implies no individual-level
effect of B on Y , or equivalently Y (b† ) = Y (b‡ ).
89

(i): G

Z

M

Y

(ii): G

Z

M

Y

(iii): G(z, m)

Z

z

M (z)

m

Y (z, m)

(iv): G G (z, m)

Z

z

M (z)

m

Y (z, m)

Figure 27: (i) The underlying NPSEM G; (ii) the DAG G according to which
P (Z, M, Y ) factors; (iii) the template G(z, m); (iv) the template G G (z, m)
induced from G(z, m) by G; G G (z, m) in contrast to G(z, m) shown in Figure
9(iv) does not imply Y (z, m) = Y (z 0 , m).

90

7.1.3

Example: absence of a population direct effect

Consider a distribution in FFRCISTG model associated with the DAG G as
shown in Figure 27(i). Since factorization and modularity hold with respect
to G(˜
z , m),
˜ shown in Figure 27(iii) we have for all z˜, m,
˜ z, m, y:
P (Z = z, M (˜
z ) = m, Y (˜
z , m)
˜ = y) = P (Z = z)P (M (˜
z ) = m)P (Y (˜
z , m)
˜ = y),
(83)
and
P (M (˜
z ) = m) = P (M = m | Z = z˜), P (Y (˜
z , m)
˜ = y) = P (Y = y | M = m,
˜ Z = z˜).
Now consider the subgraph G of G that does not include the Z → Y , and
the resulting induced SWIG G G (˜
z , m),
˜ shown in in Figure 27(ii) and (iv)
respectively. Observe that (83) immediately implies that P (Z = z, M (˜
z) =
m, Y (˜
z , m)
˜ = y) factors according to G G (˜
z , m).
˜
Again this is because the
only edge that is in G(˜
z , m),
˜ but not G G (˜
z , m)
˜ is z → Y (˜
z , m).
˜
Now suppose in addition that the joint distribution P (Z, M, Y ) factors
according to G:
P (Z = z, M = m, Y = y) = P (Z = z)P (M = m | Z = z)P (Y = y | M = m).
(84)
Under positivity we then have that for all z˜, m,
˜ y:
P (Y (˜
z , m)
˜ = y) = P (Y = y | M = m,
˜ Z = z˜) = P (Y = y | M = m).
˜

(85)

Thus (P (Z, M (˜
z ), Y (˜
z , m)),
˜ G G (˜
z , m))
˜ obeys modularity with respect to (P (Z, M, Y ),
G). Consequently it holds that
P (Y (˜
z , m)
˜ = y) = P (Y = y | M = m)
˜ = P (Y (z † , m)
˜ = y),
for all z˜, z † so that the average controlled direct effect of Z on Y , when M
is fixed, vanishes.
However, G G (z, m) does not imply Y (˜
z , m)
˜ = Y (z † , m).
˜ The latter individual level exclusion restriction is implied by the SWIG G(z, m) shown in
Figure 9(iv), that would result from the FFRCISTG model associated with
G.
7.1.4

Example: the effect of treatment on the double treated

In the previous subsection we saw that for the controlled direct effect the
interpretation of the missing edge did not alter the identification results. We
91

now present an example in which the distinction leads to different results.
First consider the graphs G and G shown in Figure 28(a) and (b). It follows
from the discussion in §6.1.3 that the effect of treatment on the double
treated:
E[Y (b0 , c0 ) − Y (b† , c† ) | B = b0 , C = c0 ].

(86)

is identified under the FFRCISTG model associated with G, but not under
the FFRCISTG associated with G. Thus the effect of treatment on the
double treated is identified in the absence of an individual level direct effect
of B on C.82
We now consider a distribution in the FFRCISTG model associated with
G under which, in addition, the observed distribution P (B, C, Y ) factors
according to G, so that there is no population-level effect of B on C. The
template for the SWIG G G (b† , c† ) induced from G(b† , c† ) by G is shown in
Figure 28(d). We see that G G (b† , c† ) implies
Y (b† , c† ) ⊥
⊥ B, C(b† ),

(87)

as does the SWIG G(b† , c† ). However neither G(b† , c† ) nor G G (b† , c† ) imply:
Y (b† , c† ) ⊥
⊥ B, C.

(88)

Consequently, we would expect that there exists a counterfactual distribution in the FFRCISTG model associated with G, for which P (B, C, Y )
factorizes according G, and yet (88) does not hold. We prove this below by
constructing such an example; see NPSEM II below.
We also construct a counterfactual distribution in the NPSEM-IE (and
hence also the FFRCISTG) associated with G; see NPSEM I below. Both
NPSEM I and NPSEM II give rise to the same observed distribution for
P (B, C, Y ), and both obey modularity so that P (C(b† ), Y (b† )) = P (C, Y |B =
b) and P (Y (b† , c† )) = P (Y |B = b† , C = c† ). Thus there is no way to distinguish between these models on the basis of observational or experimental
data.

NPSEM I:
B = εB ;

C(b) = εC ;

Y (b, c) = I(0.5 − 0.2bc > εY );
82
Although there is no consistent test for the absence of an individual level direct effect
of B on C, we can reject that null hypothesis by performing a randomized experiment in
which B is randomized, and we find an association between B and C conditional on some
pre-treatment covariate.

92

where εB ∼ Ber(0.5); εC ∼ Ber(0.5); εY ∼ Unif[0, 1] and εB ⊥
⊥ εC ⊥
⊥ εY .
Under this model there is no individual level direct effect of B on C, so
B⊥
⊥ C and we obtain:
E[Y (1, 1) − Y (0, 0) | B = 1, C = 1] = E[Y | B = 1, C = 1] − E[Y | B = 0, C = 0]
= 0.3 − 0.5 = −0.2.

Model II:
B = εB ;
C(b) = I(0.5 + (−1)εC1 (0.4 + 0.05b) > εC2 );
Y (b, c) = I(0.1 × 31+(1−bc)(2Y 1 −1) > εY 2 );
where εB ∼ Ber(0.5); εC1 ∼ Ber(0.5); εC2 ∼ Unif[0, 1]; εY 1 = εC1 ; εY 2 ∼
Unif[0, 1] and
εB ⊥
⊥ εC1 ⊥
⊥ εC2 ⊥
⊥ εY 2 .
Under this model, even though B has an individual level effect on C, P (C =
1 | B = b) = 0.5 so B ⊥
⊥ C. Further,
E[Y (1, 1) − Y (0, 0) | B = 1, C = 1]
= E[Y | B = 1, C = 1] − E[Y (0, 0) | B = 1, C = 1]
= 0.3 − 0.14 = 0.16.
The effect of treatment on the double treated has the opposite sign in
Model I versus Model II. These NPSEMs thus show that the effect of treatment on the double treated is not identified under the FFRCISTG model
associated with G even in the absence of a population level direct effect of
B on C.

7.2

Positivity Conditions

In Section 7.1.1 above we showed that under positivity of the observed distribution P (V) factorization and modularity held for the induced SWIG
G G (˜
a) for every set A and every assignment ˜
a. We now give weaker positivity conditions that are sufficient for factorization and modularity for a given
set A and assignment ˜
a.
a)).
Condition 39 (Conditions for factorization and modularity for G G (˜
Given a counterfactual distribution P (V(˜
a)) in the FFRCISTG model associated with the DAG G, where P (V) factors according to a subgraph G, and
a given vertex V ∈ V, we consider the following conditions:
93

B

C

B

Y

C

Y
(b): G

(a): G

B

C(b)

B

C(b)

B

C

b

c

b

c

b

c

Y (b, c)
(c): G(b, c)

Y (b, c)

(d): G G (b, c)

Y (b, c)

(e): G(b, c)

Figure 28: (a) A DAG G representing an FFRCISTG model; (b) the graph
G with respect to which P (B, C, Y ) factorizes; (c) the template G(b, c) for
the SWIG obtained from G; (d) the template G G (b, c) for the SWIG induced
from G(b, c) by G; (e) the template G(b, c) for the SWIG obtained under the
assumption of no individual level effect of B on C.

94

(I) If paG (V ) \ (paG (V ) ∪ A) 6= ∅ then for all q:


P (paG(˜a) (V (˜
a)) \ ˜
a) = q > 0


⇒ P (paG (V ) \ A) = q, (paG (V ) ∩ A) = ˜
apaG (V )∩A > 0. (89)
(II) If paG (V ) \ (paG (V ) ∪ A) = ∅, but paG (V ) \ paG (V ) 6= ∅ then for all q:


P (paG(˜a) (V (˜
a)) \ ˜
a) = q > 0 and


P (paG (V ) \ A) = q, (paG (V ) ∩ A) = ˜
apaG (V )∩A > 0


apaG (V )∩A > 0. (90)
⇒ P (paG (V ) \ A) = q, (paG (V ) ∩ A) = ˜
In both of the above conditions we consider any event concerning an empty
set of variables to be (vacuously) true and hence to have probability one.
First observe that these conditions are non-trivial only for those variables
V for which the set of parents in G are a strict subset of the set of parents in
G. Second note that Clause (I) and (II) place restrictions on disjoint subsets
of these variables:
• Clause (I) applies to variables V for which the random parents of the
corresponding counterfactual variable V (˜
a) in G G (˜
a) are a strict subset
of the random parents of V (˜
a) in G(˜
a).
• Clause (II) applies to variables that have the same random parents in
G(˜
a) and G G (˜
a), but the fixed parents of V (˜
a) in G G (˜
a) are a strict
subset of the fixed parents of V (˜
a) in G(˜
a).
Clause (I) is sufficient for factorization of P (V(˜
a)) with respect to G G (˜
a),
while for modularity of (P (V(˜
a)), G G (˜
a)) with respect (P (V), G) both conditions are needed:
Theorem 40. Given a counterfactual distribution P (V(˜
a)) in the FFRCISTG model associated with the DAG G, if P (V) factors according to a
subgraph G and Condition 39(I) holds for all V then P (V(˜
a)) factorizes with
respect to G G (˜
a).
Proof: By Proposition 11, P (V(˜
a)) factorizes with respect to G(˜
a). Further
by Proposition 16, for every q, v:
P (V (˜
a) = v | (paG(˜a) (V ) \ ˜
a) = q)
= P (V = v | (paG (V ) \ A) = q, (paG (V ) ∩ A) = ˜
apaG (V )∩A ),
95

(91)

whenever both sides are well-defined. Since, by hypothesis, P (V) factorizes
according to G, which is a subgraph of G, it follows that for every V ∈ V:
P (V = v | (paG (V ) \ A) = q, (paG (V ) ∩ A) = ˜
apaG (V )∩A )

(92)

= P (V = v | (paG (V ) \ A) = qpaG (V )\A , (paG (V ) ∩ A) = ˜
apaG (V )∩A )
whenever both sides are well-defined.
If paG (V )\(paG (V )∪A) 6= ∅ then Condition 39(I) ensures that whenever
the LHS of (91) is well-defined, the RHS is also well-defined. This immediately implies that both sides of (92) are well-defined (since the conditioning
event on the right is a subset of that on the left). Hence for all q, v:
P (V (˜
a) = v | (paG(˜a) (V ) \ ˜
a) = q)

(93)

apaG (V )∩A )
= P (V = v | (paG (V ) \ A) = qpaG (V )\A , (paG (V ) ∩ A) = ˜
whenever both sides are well-defined. Thus for all q:
P (V (˜
a) = v | (paG(˜a) (V ) \ ˜
a) = q)
= P (V (˜
a) = v | (paG G (˜a) (V ) \ ˜
a) = qpaG

(94)
a)
G (˜

(V ) ),

whenever the left hand side is well-defined. Here we have used the fact that
by the construction of G G (˜
a), paG(˜a) (V ) \ ˜
a are the set of random vertices in
G G (˜
a) that correspond to paG (V ) \ A in G.
If paG (V ) \ (paG (V ) ∪ A) = ∅ then again by the construction of G G (˜
a),
a = paG G (˜a) (V )\˜
a and there is nothing to prove. This establishes
paG(˜a) (V )\˜
that P (V(˜
a)) factorizes according to G G (˜
a).
2
Notice that in the absence of Condition 39(I), it is possible that for some
q, the LHS of (91) is well-defined, yet the RHS is not. In this circumstance
the fact that P (V) factorizes according to G places no restriction on the
LHS of (91) – since modularity for G only requires equality when both the
LHS and RHS of (91) are well-defined. Consequently if Condition 39(I) does
not hold for some V , then P (V(˜
a)) may fail to factorize according to G G (˜
a).
Notice that, as noted in the proof of Theorem 40, for vertices V that have
the same set of random parents in both G(˜
a) and G G (˜
a), there is nothing to
prove – we do not need to use the hypothesis that P (V) factorizes according
to G, nor Condition 39(I). Thus we have the following result:
Corollary 41. Given two DAGs G and G, if for every edge X → Y that
is present in G, but not in G, X ∈ A then every counterfactual distribution
P (V(˜
a)) in the FFRCISTG model associated with the DAG G factorizes with
respect to G G (˜
a).
96

We now establish that Condition 39(I)&(II) are sufficient for modularity:
Theorem 42. Given a counterfactual distribution P (V(˜
a)) in the FFRCISTG model associated with the DAG G, if P (V) factors according to a
subgraph G and Condition 39(I)&(II) hold for all V then (P (V(˜
a)), G G (˜
a))
obeys modularity with respect (P (V), G).
Proof: Propositions 11 and 16 imply that (P (V(˜
a)), G(˜
a)) obeys modularity
with respect to (P (V), G), so:





P V (˜
a) = v  paG(˜a) (V (˜
a)) \ ˜
a =q
(95)






apaG (V )∩A ,
= P V = v  paG (V ) \ A = q, paG (V ) ∩ A = ˜
whenever both sides are well-defined.
If paG (V ) = paG (V ) then V (˜
a) has the same random and fixed parents
in both G(˜
a) and G G (˜
a), hence there is nothing to prove. Thus suppose that
paG (V ) \ paG (V ) 6= ∅.
Suppose that for some assignment q0 to paG G (˜a) (V (˜
a)) \ ˜
a,





a)) \ ˜
a = q0
P V (˜
a) = v  paG G (˜a) (V (˜
is well-defined, so that



P paG G (˜a) (V (˜
a)) \ ˜
a = q0 > 0.
Since (paG G (˜a) (V (˜
a)) \ ˜
a) ⊂ (paG(˜a) (V (˜
a)) \ ˜
a), it follows that there exists
∗
an assignment q to paG(˜a) (V (˜
a)) \ ˜
a such that q0 is a sub-vector of q∗ , and
P





paG(˜a) (V (˜
a)) \ ˜
a = q∗ > 0.

(96)

We then argue as follows:





P V (˜
a) = v  paG G (˜a) (V (˜
a)) \ ˜
a = q0





= P V (˜
a) = v  paG(˜a) (V (˜
a)) \ ˜
a = q∗
(97)






= P V = v  paG (V ) \ A = q∗ , paG (V ) ∩ A = ˜
apaG (V )∩A
(98)






= P V = v  paG (V ) \ A = q0 , paG (V ) ∩ A = ˜
apaG (V )∩A . (99)

97

Here the first equality follows by Theorem 40 since P (V(˜
a)) obeys the
Markov property for G G (˜
a); by definition of q∗ both of these conditional
distributions are well-defined. If both sides of (95) are well-defined then this
implies the second equality. The third equality then follows because P (V)
obeys the Markov property for G.
It remains to show that if the conditioning events in (97) and (99) have
non-zero probability then so does the conditioning event in (98). There are
two cases to consider:
If paG (V ) \ (paG (V ) ∪ A) 6= ∅, so that the random parents of V (˜
a) in
G G (˜
a) are a strict subset of the random parents of V (˜
a) in G(˜
a) then since
(96) holds, Condition 39(I) implies that the conditioning event in (98) will
have non-zero probability.83
If V (˜
a) has the same random parents in G G (˜
a) and G(˜
a) then
paG G (˜a) (V (˜
a)) \ ˜
a = paG(˜a) (V (˜
a)) \ ˜
a
and q0 = q∗ . Further V (˜
a) must have different fixed parents in G(˜
a) and
G G (˜
a). Condition 39(II) then implies that whenever the conditioning events
in both (97) and (99) are assigned non-zero probability then this will also
be true of (98).
This establishes that (P (V(˜
a)), G G (˜
a)) obeys modularity with respect to
(P (V), G) as required.
2
7.2.1

Two variable example re-visited without positivity

We return to the simple SWIG G G (b† ) shown in Figure 26 discussed earlier
in §7.1.2. In general, if, contrary to Condition 39(II), for some value b†
we have P (B = b† ) = 0 then P (Y (b† ) = y) is not identified and hence, in
general, P (Y (b† ) = y) 6= P (Y = y), so modularity fails. To see this consider
the following simple NPSEM, in which B is ternary taking states 0, 1, 2, and
Y is binary:
B = εB

Y (b) = I(b ≤ 1)I(εY = b) + I(b > 1)

where εY is a Bernoulli(0.5), P (εB = 0) = P (εB = 1) = 0.5, but P (εB =
2) = 0, and εB ⊥
⊥ εY . Observe that for all units, Y (b = 0) = 1 − Y (b = 1),
but Y (b = 2) = 1, however, P (B = 2) = 0. It follows that for all y ∈ {0, 1},
83

Though not strictly required for the proof, this further implies that the conditioning
(99) will also have non-zero probability.

98

b ∈ {0, 1, 2}:84
P (Y = y, B = b) = P (Y = y)P (B = b),
thus establishing factorization with respect to the edgeless graph in Figure
26(b). At the same time, modularity does not hold since:
1 = P (Y (b = 2) = 1) 6= P (Y = 1) = 1/2.
This is because owing to the violation of Condition 39(II), even though the
left hand side of (80) and the right hand side of (81) are well-defined, because
the expression on the right of (80) (and the left of (81)) is not well-defined.
Thus both sides of (82) are well-defined, yet they are not equal, thereby
violating modularity.
In spite of this, as implied by Proposition 16, (P (B, Y (b† )), G G (b† )) does
obey modularity with respect (P (B, Y ), G) since the modularity condition
with respect to G only requires that P (Y (b∗ ) = y) = P (Y = y | B = b∗ ), for
all b∗ for which both sides are well-defined, i.e. for b∗ = 0, 1, but not 2.
However if we assume that graph G in Figure 26(b) was an FFRCISTG,
so that there is no individual level effect of B on Y , then we do find that
P (Y (b† ) = y) is identified and equal to P (Y = y) even when P (B = b† ) is
zero; the corresponding template G(b) is shown in Figure 26(e).
7.2.2

Population direct effect re-visited without positivity

Here we re-visit the three variable example discussed in 7.1.3.
To see the importance of the positivity condition Condition 39(II) consider the following NPSEM in which all variables are binary:
Z = εZ ;
M (z) = I(z = 1) + I(z = 0) · εM ;
Y (z, m) = I(εY < (1 + m + 2(1 − m)z)/4)
where εZ , εM and εY are jointly independent, εZ , εM ∼ Ber(0.5) and εY ∼
Unif[0, 1]. Notice that Z = 1 implies M = 1. Further, we have P (Y = 1 | Z =
z, M = 1) = 1/2, while P (Y = 1 | Z = 0, M = 0) = 1/4 = P (Y = 1 | M = 0).
Thus for all pairs of values (z, m) for which P (Z = z, M = m) > 0 we have:
P (Y = 1 | Z = z, M = m) = P (Y = 1 | M = m),
84

Here we use the fact that even though P (Y = y|B = 2) is not uniquely defined, since
P (B = 2) = 0, the product is defined.

99

so that (84) holds for all z, m, y, and thus P (Z, M, Y ) factors with respect
to G. However, since P (M = 0) > 0, but P (Z = 1, M = 0) = 0, the condition
(90) is violated. We see that
3/4 = P (Y (z = 1, m = 0) = 1) 6= P (Y = 1 | M = 0) = 1/4,
so that (P (Z, M (˜
z ), Y (˜
z , m),
˜ G G (z, m)) does not obey modularity with respect to (P (Z, M, Y ), G). However, as in the previous example modularity
is obeyed with respect to (P (Z, M, Y ), G). If the counterfactual distribution
was in the FFRCISTG associated with G (rather than G) then we would
have modularity with respect to (P (Z, M, Y ), G).

8

SWIGs in the presence of restricted interventions

In §3 we based our theory on a NPSEM, under which counterfactuals are
assumed well-defined for interventions on any variable: Formally a counterfactual distribution in the FFRCISTG model associated with G with vertex
set V is a distribution over the set of counterfactual random variables
{V (˜
c) | V ∈ V, ˜
c ∈ C, C ⊆ V}

(100)

where C is the state space of the set of variables C.
However, there are many substantive contexts in which a process may
not be sufficiently well understood for interventions on all variables to be
regarded as well-defined.
Our SWIG theory may still be applied in this setting if, following (Robins,
1986)85 we take as our starting point a counterfactual distribution for a
smaller set of counterfactual variables:
{V (˜
c) | V ∈ V, ˜
c ∈ C, C ⊆ A} .

(101)

The set (101) differs from (100) in that we now only consider counterfactuals
defined for intervention on subsets of the set of variables in A. Thus we
introduce the following:
Definition 43 (Counterfactual Existence Assumption Restricted to A).
(i) The counterfactuals V (a†V ) appearing in the SWIG G(a† ) exist for any
setting of a† in the state space A of A; recall that AV ≡ {Aj | Aj (a† ) ∈
anG(a† ) (V (a†V )), Aj ∈ A}.
85

See Appendix C.2

100

(ii) Both the factual variables V and the counterfactuals V (r) for any R ⊆
A exist and are obtained recursively from the counterfactuals given in
(i) as follows:


†
†
†
V (r ) = V rAV ∩R , B(r ) ,
(102)
where B(r† ) ≡ {Aj (r† ) | Aj (a†Aj ) ∈ anG(a† ) (V (a†V )), Aj ∈ A \ R}.
Here the set B(r† ) consists of the counterfactual variables corresponding
to variables in A(a† ) that are ancestors of V (a† ) in G(a† ), but are not in R,
evaluated under the intervention r† .
Our model is then defined via the local Markov property (Lauritzen,
1996) associated with the set of SWIGs {G(a† ) | a† ∈ A} associated with
the template G(a):
Definition 44 (FFRCISTG Indep. Assumption for G restricted to A).
For every a† ∈ A, and every V ∈ V, we assume the following:
V (a†V ) ⊥
⊥ npndG(a† ) (V (a†V )) | paG(a† ) (V (a†V )) \ a†

(103)

where npndG(a† ) (V (a†V ) is the set of non-parental non-descendants of V (a†V )
in G(a† ).
Proposition 45. Under the FFRCISTG model associated with G restricted
to A, for any C ⊆ A and assignment ˜
c, P (V(c† )) factorizes according to
G(c† ).
Proposition 46. Under the FFRCISTG model associated with G restricted
to A, for any C ⊆ A and assignment ˜
c, the pairs (P (V), G) and P (V(c† )),
G(c† ) obey modularity.
Proof: The local Markov property given Definition 44 implies that the distribution over the variables P (V(a† )) factorizes according to G(a† ). These
results then follow directly via the inductive proof of Propositions 11 and
16; see Appendix B.1.
2
It is perhaps natural to ask what is the meaning in our theory of a
directed edge X → Y in the case where X is not in A and so counterfactual
variables involving interventions on X do not arise in our model. We offer
several possibilities but do not select amongst them:
One view is that there does exist some underlying FFRCISTG where
directed edges continue to represent causal effects however, only the interventions on the variables in A are sufficiently well-specified to support
101

well-defined counterfactuals. Consequently we choose to restrict the interventions we consider, and indeed our domain of discourse, to just those
counterfactuals for interventions in A.
An alternative view that is more in the spirit of the section on population
exclusion restrictions is to believe that there is no underlying FFRCISTG
associated with a DAG G (even including hidden variables). However, there
does exist an FFRCISTG with interventions restricted to A, and the DAG
G simply reflects the factorization properties of the observed distribution.
This leaves open the question as to why one would expect the distribution
of the observables to factorize according to anything other than a complete
DAG; also why one might not also consider other factorizations such as those
corresponding to chain graphs (Lauritzen, 1996).

An intervention-based interpretation of G(˜
a)

9

Formally, the factorization and modularity conditions associated with the
graph G(˜
a) can be motivated from a purely interventional perspective via an
extended agnostic causal DAG86 (Spirtes et al., 1993). In other words, we
will show that someone who, possibly for philosophical reasons, did not wish
to postulate the existence of counterfactual outcomes, but merely wished to
reason in terms of distributions resulting from interventions, might still wish
to construct a graph isomorphic to the SWIG G(˜
a).
Suppose that for each variable A ∈ A, on which we are intervening, it
were possible to first observe the natural value of the variable, and then to
intervene. We might represent this by replacing A by two ‘copies’, A and
A+ , linked by a deterministic edge such that A = A+ in the observed data
with probability 1, thus:87
..
.

A

..
.

⇒

..
.

A

A+

..
.

⇒

..
.

A

a
˜

..
.

Schematic: Replacement of A with A and A+ ; intervention on A+ .
86
Also known as a ‘causal Bayesian network’ (Pearl, 2000); this model is also very similar
to a ‘causal influence diagram’ Dawid and Didelez (2010).
87
This construction generalizes that described by (Geneletti and Dawid, 2007) and
(Robins et al., 2007).

102

The topology of the resulting manipulated graph, after intervening on the
variables A+ , would be isomorphic to G(˜
a). Using the standard truncated
factorization formula, the distribution over V (the set of all variables other
+
than {A+
˜i for all Ai ∈ A, would
j }) under an intervention to set Ai to a
be the extended g-formula (37). Consequently factorization and modularity
would be obeyed in the obvious way.
One might wonder whether an intervention under which one observes the
natural value of a treatment variable before intervening is possible even in
principle for human subjects. Recent evidence indicates that if one records
data in continuous time (or nearly so) it may be quite generally. Specifically
by observing the activity of certain neurons one can predict a person’s actions some milliseconds before the individual is consciously aware that they
are taking the action.

Acknowledgments
This research was supported by the U.S. National Science Foundation (CRI
0855230) and U.S. National Institutes of Health (R01 AI032475). We thank
Wen Wei Loh for helpful comments on earlier drafts.

References
Balke, A. and J. Pearl (1994). Probabilistic evaluation of counterfactual
queries. In Proceedings of the 12th Conference on Artificial Intelligence,
Volume 1, Menlo Park, CA, pp. 230–7. MIT Press.
Box, G. (1966). Use and abuse of regression. Technometrics 8, 625–629.
Danaei, G., A. Pan, F. B. Hu, and M. A. Hern´an (2012). Hypothetical
lifestyle interventions in middle-aged women and risk of type 2 diabetes:
a 24-year prospective study. Am. J. Epidemiology, In press.
Davis, J. A. (1984). Extending Rosenberg’s technique for standardizing
percentage tables. Social Forces 62, 679–708.
Dawid, A. (2000). Causal inference without counterfactuals (with discussion). J. Amer. Statist. Assoc. 95, 407–448.
Dawid, A. P. and V. Didelez (2008). Identifying optimal sequential decisions.
In D. McAllester and A. Nicholson (Eds.), Proceedings of the 24th Annual

103

Conference on Uncertainty in Artificial Intelligence, Corvallis, Oregon,
pp. 113–120.
Dawid, A. P. and V. Didelez (2010). Identifying the consequences of dynamic
treatment strategies: a decision-theoretic overview. Stat. Surv. 4, 184–231.
Drton, M. and T. Richardson (2008). Binary models for marginal independence. J. Roy. Statist. Soc. Ser. B 70(2), 287–309.
Frangakis, C. E. and D. B. Rubin (2002). Principal stratification in causal
inference. Biometrics 58 (1), 21–29.
Geiger, D. (1990). Graphoids: a qualitative framework for probabilistic inference. Ph. D. thesis, UCLA.
Geiger, D. and J. Pearl (1993). Logical and algorithmic properties of conditional independence and graphical models. The Annals of Statistics 21,
2001–2021.
Geneletti, S. and A. P. Dawid (2007). Defining and identifying the effect of
treatment on the treated. Technical Report 3, Imperial College London,
Department of Epidemiology and Public Health.
Greenland, S. (2003). Quantifying biases in causal models: Classical confounding vs collider-stratification bias. Epidemiology 14 (3), 300–306.
Haavelmo, T. (1943). The statistical implications of a system of simultaneous equations. Econometrica 11, 1–12.
Haneuse, S. and A. Rotnitzky (2013). Estimation of the effect of interventions that modify the received treatment. Submitted.
Huang, Y. and M. Valtorta (2006). Pearl’s calculus of interventions is complete. In Proceedings of the 22nd Conference On Uncertainty in Artificial
Intelligence.
Lajous, M., W. C. Willett, J. M. Robins, J. G. Young, E. Rimm, D. Mozaffarian, and M. A. Hern´
an (2012). Changes in fish consumption in midlife
and the risk of coronary heart disease in men and women. Am. J. Epidemiology, In press.
Lauritzen, S. L. (1996). Graphical Models. Oxford, UK: Clarendon Press.
Lauritzen, S. L., A. P. Dawid, B. Larsen, and H.-G. Leimer (1990). Independence properties of directed Markov fields. Networks 20, 491–505.
104

Meek, C. (1995). Strong completeness and faithfulness in Bayesian networks.
In P. Besnard and S. Hanks (Eds.), Uncertainty in Artificial Intelligence:
Proceedings of the 11th Conference, San Francisco, pp. 411–418. Morgan
Kaufmann.
Mu˜
noz, I. D. and M. J. van der Laan (2011). Population intervention causal
effects based on stochastic interventions. Technical Report 289, Division
of Biostatistics, University of California, Berkeley.
Mu˜
noz, I. D. and M. J. van der Laan (2012). Assessing the causal effect of
policies: An approach based on stochastic interventions. Technical Report
298, Division of Biostatistics, University of California, Berkeley.
Neyman, J. (1923). Sur les applications de la th´eorie des probabilit´es aux
experiences agricoles: Essai des principes. Roczniki Nauk Rolniczych X,
1–51. In Polish, English translation by D. Dabrowska and T. Speed in
Statistical Science 5 463–472, 1990.
Pearl, J. (1988). Probabilistic Reasoning in Intelligent Systems. San Mateo,
CA: Morgan Kaufmann.
Pearl, J. (1995). Causal diagrams for empirical research (with discussion).
Biometrika 82, 669–690.
Pearl, J. (2000). Causality. Cambridge, UK: Cambridge University Press.
Pearl, J. (2001a). Direct and indirect effects. In J. S. Breese and D. Koller
(Eds.), UAI-01, Proceedings of the 17th Annual Conference on Uncertainty in Artificial Intelligence, San Francisco, pp. 411–42. Morgan Kaufmann.
Pearl, J. (2001b). Direct and indirect effects. In J. S. Breese and D. Koller
(Eds.), Proceedings of the 17th Annual Conference on Uncertainty in Artificial Intelligence, San Francisco, pp. 411–42. Morgan Kaufmann.
Pearl, J. (2009). Causality (Second ed.). Cambridge, UK: Cambridge University Press.
Pearl, J. (2010). Causal analysis in theory and practice: On mediation,
counterfactuals and manipulations. Posting to UCLA Causality Blog, 3
May 2010; http://www.mii.ucla.edu/causality/?p=133.
Pearl, J. (2012a, July). Eight myths about causality and structural equation
models. Technical Report R-393, Computer Science Department, UCLA.
105

Pearl, J. (2012b). Trygve Haavelmo and the emergence of causal calculus.
Technical Report R-391, Computer Science Department, UCLA.
Pearl, J. and J. M. Robins (1995). Probabilistic evaluation of sequential plans from causal models with hidden variables. In P. Besnard and
S. Hanks (Eds.), Uncertainty in Artificial Intelligence: Proceedings of the
11th Conference, San Francisco, pp. 444–453. Morgan Kaufmann.
Robins, J. M. (1984). A statistical method to control for the healthy worker
effect in intracohort comparisons. Am. J. Epidemiology 120, 465.
Robins, J. M. (1985). A new theory of causality in observational survival
studiesapplication to the healthy worker effect. Biometrics 41, 331.
Robins, J. M. (1986). A new approach to causal inference in mortality
studies with sustained exposure periods – applications to control of the
healthy worker survivor effect. Mathematical Modeling 7, 1393–1512.
Robins, J. M. (1987). Addendum to: A new approach to causal inference in
mortality studies with sustained exposure periods – Application to control
of the healthy worker survivor effect. Computers and Mathematics with
Applications 14, 923–945.
Robins, J. M. (1989a). The analysis of randomized and non-randomized
AIDS treatment trials using a new approach to causal inference in longitudinal studies. In L. Sechrest, H. Freeman, and A. Mulley (Eds.),
Health Service Research Methodology: A focus on AIDS. Washington,
D.C.: U.S. Public Health Service.
Robins, J. M. (1989b). The control of confounding by intermediate variables.
Statistics in Medicine 8, 679–701.
Robins, J. M. (1997). Causal inference from complex longitudinal data. In
M. Berkane (Ed.), Latent variable modelling and applications to causality, Number 120 in Lecture notes in statistics, pp. 69–117. New York:
Springer-Verlag.
Robins, J. M. (2003). Semantics of causal DAG models and the identification
of direct and indirect effects. In P. Green, N. Hjort, and S. Richardson
(Eds.), Highly Structured Stochastic Systems, pp. 70–81. Oxford: Oxford
University Press.

106

Robins, J. M., D. Blevins, G. Ritter, and M. Wulfsohn (1992). G-estimation
of the effect of prophylaxis therapy for Pneumocystis Carinii Pneumonia
on the survival of AIDS patients. Epidemiology 3, 319–336.
Robins, J. M. and S. Greenland (1992). Identifiability and exchangeability
for direct and indirect effects. Epidemiology 3, 143–155.
Robins, J. M., M. A. Hern´an, and U. Siebert (2004). Effects of multiple
interventions. In M. Ezzati, C. J. L. Murray, A. D. Lopez, and A. Rodgers
(Eds.), Comparative quantification of health risks : global and regional
burden of disease attributable to selected major risk factors, Volume 2,
Chapter 28, pp. 2191–2230. Geneva: World Health Organization.
Robins, J. M. and T. S. Richardson (2011). Alternative graphical causal
models and the identification of direct effects. In P. Shrout, K. Keyes,
and K. Ornstein (Eds.), Causality and Psychopathology: Finding the Determinants of Disorders and their Cures, Chapter 6, pp. 1–52. Oxford
University Press.
Robins, J. M., T. J. VanderWeele, and T. S. Richardson (2007). Discussion
of “Causal effects in the presence of non compliance a latent variable
interpretation” by Forcina, A. Metron LXIV (3), 288–298.
Shpitser, I. (2013). Personal e-mail communication.
Shpitser, I. and J. Pearl (2006a). Identification of conditional interventional
distributions. In Proceedings of the 22nd Conference on Uncertainty in
Artificial Intelligence, Volume 22.
Shpitser, I. and J. Pearl (2006b). Identification of joint interventional distributions in recursive semi-markovian causal models. In Proceedings of
the 21st National Conference on Artificial Intelligence.
Shpitser, I. and J. Pearl (2007). What counterfactuals can be tested. In
R. Parr and L. van der Gaag (Eds.), Proceedings of the 23rd Annual
Conference on Uncertainty in Artificial Intelligence, Corvallis, Oregon,
pp. 437–444.
Shpitser, I. and J. Pearl (2008). What counterfactuals can be tested. Journal
of Machine Learning Research 9, 1941–1979.
Shpitser, I. and J. Pearl (2012). Effects of treatment on the treated: Identification and generalization. Proceedings of the 25th Conference On Uncertainty in Artificial Intelligence.
107

Shpitser, I., T. S. Richardson, and J. M. Robins (2011). An efficient algorithm for computing interventional distributions in latent variable causal
models. In 27th Conference on Uncertainty in Artificial Intelligence (UAI11). AUAI Press.
Shpitser, I., T. J. VanderWeele, and J. M. Robins (2012). On the validity of
covariate adjustment for estimating causal effects. CoRR abs/1203.3515.
Spirtes, P., C. Glymour, and R. Scheines (1993). Causation, Prediction and
Search. Number 81 in Lecture Notes in Statistics. Springer-Verlag.
Strotz, R. and H. Wold (1960). Recursive versus non-recursive systems: An
attempt at synthesis. Econometrica 28 (2), 417–427.
Taubman, S. L., M. A. Mittleman, J. M. Robins, and M. A. Hern´an (2008).
Alternative approaches to estimating the effects of hypothetical interventions. In JSM Proceedings, Health Policy Statistics Section, Alexandria,
VA.
Taubman, S. L., J. M. Robins, M. A. Mittleman, and M. A. Hern´an (2009).
Intervening on risk factors for coronary heart disease: an application of
the parametric g-formula. Int. J. Epidemiology 38 (6), 1599611.
Tian, J. (2008). Identifying dynamic sequential plans. In 24th Conference
on Uncertainty in Artificial Intelligence (UAI-08). AUAI Press.
Tian, J. and J. Pearl (2002). A general identification condition for causal
effects. In Eighteenth National Conference on Artificial Intelligence, pp.
567–573.
Young, J., J. M. Robins, and M. A. Hern´an (2012). Identification and
estimation of risk under threshold interventions using observational data.
Submitted.

A

Graphs

We now introduce graphical models, based on directed acyclic graphs. We
first require the following definitions: A directed acyclic graph (DAG) G(V, E)
with vertex set V and edge set E is a graph containing directed edges (→)
subject to the restriction that there are no directed cycles V → · · · → V .
We define the parents of V to be paG (V ) ≡ {X | X → V }. If B → a then
108

we say that B is a parent of A, and A is a child of B. A vertex A is said to
be an ancestor of a vertex D if either there is a directed path A → · · · → D
from A to D, or A = D; similarly D is said to be a descendant of A.

A.1

Factorization criteria

Definition 47. A distribution P (V) is said to factorize with respect to a
DAG G if
Y
P (V | paG (V )).
(104)
P (V) =
V ∈V

A.2

Markov properties

The Markov property associated with a DAG is given by the following definitions:
A path π is said to d-connect vertices A and B conditional on a set C if
A and B are the endpoints of π and:
(i) Every non-collider on π is not in C, and
(ii) Every collider on π is an ancestor of C (or is in C).
If there is no path d-connecting A and B given C then A and B are said
to be d-separated given C in G. The following well-known result connects dseparation and conditional independence in distributions factoring according
to G.
Theorem 48. In any distribution P (V) that factorizes according to G, if
X and Y are d-separated given Z then X ⊥
⊥ Y | Z in P .

B

Proofs of main results

We begin with two useful Lemmas relating counterfactual distributions to
actual distributions.
Lemma 49. If P (V) and P (V(˜
a)) factorize with respect to G and G(˜
a)
respectively and obey modularity then for any W ⊆ V \ A,
P (W(˜
a) = w, A(˜
a) = ˜
a) = P (W = w, A = ˜
a).

109

It is an immediate consequence of this lemma that if P (W∗ (˜
a) = w∗ , A(˜
a) =
∗
∗
˜
a) = P (W = w
˜ ,A = ˜
a) then the same equality holds replacing W∗ by any
subset W ⊆ W∗ . In other words the equality is preserved if we marginalize
over variables that are not in A (or A(˜
a)).
2.

Proof: This follows by summing both sides of (37) over vi ∈ V \ W.

We illustrate this Lemma with an example. Consider the template in
Figure 9(iii). We have the following factorization for all z, m, m,
˜ y:
P (Z = z, M = m, Y (m)
˜ = y) = P (Z = z)P (M = m | Z = z)P (Y = y | Z = z, M = m).
˜
Consequently setting m = m
˜ we obtain:
P (Z = z, M = m,
˜ Y (m)
˜ = y) = P (Z = z)P (M = m
˜ | Z = z)P (Y = y | Z = z, M = m)
˜
= P (Z = z, M = m,
˜ Y = y).

(105)

We see that summing over z or y leads to equalities for the following margins:
P (M = m,
˜ Y (m)
˜ = y) = P (M = m,
˜ Y = y) P (Z = z, M = m)
˜ = P (Z = z, M = m),
˜
the latter being a tautology. However, we do not have equality of P (Z, Y (m))
˜
and P (Z, Y ) since the equality (105) of the joint distributions only holds
when m = m.
˜
The next Lemma shows that we may preserve factorization and modularity when summing over a variable A ∈ A in the special case where A has
no children (and hence no descendants) in the graph. It further follows from
Proposition 17 that (17) is also preserved when marginalizing over A.
Lemma 50. Given a DAG G, let T ∈ V such that chG (T ) = ∅. Let V0 =
V \ {T } and V0 (˜
a) = V(˜
a) \ {T (aT )}. Further, let G 0 = GV0 and G 0 (˜
a) =
(G(˜
a))V0 (˜a)∪˜a be the induced subgraphs obtained by removing T and T (aT )
from G and G(˜
a). If P (V) and P (V(˜
a)) factorize and obey modularity with
respect to G and G(˜
a) respectively then P (V0 ) and P (V0 (˜
a)) factorize and
obey modularity with respect to G 0 and G 0 (˜
a0 ) respectively.
Proof: This follows from the definition of factorization and modularity.

B.1

2

Proof that under the FFRCISTG independence assumption the NPSEM obeys factorization and modularity

We prove Propositions 11 and 16 together:

110

Proof: We will first establish that P (V(a† )) factorizes according to G(a† ) by
reverse induction on the size of the set A. The claim holds immediately for
the case A = V since then the random nodes in G(a† ) are all disconnected
and take the form Y (paY ) (with all parents fixed). The (trivial) factorization of P (V(a† )) then follows directly from the FFRCISTG independence
(17).
Now consider a set A ( V and suppose that the factorization claim is
true for all sets larger than A. Let C be a vertex in V \ A such that in
G, all the descendants of C (other than C itself) are in A; such a vertex is
guaranteed to exist since G is acyclic. Let B ≡ A ∪ {C}. Let G(a† ) and
G(b† ) be the corresponding SWIGs, and V (a†V ) and V (b†V ), respectively,
indicate the random node corresponding to a given vertex V ∈ V.
By the inductive hypothesis P (V(b† )) factorizes according to G(b† ), so
˜ and b† ,
for all v






Y

†
†
˜ =
˜V ,
P V(b ) = v
P V (bV ) = v˜  paG(b† ) (V (b†V )) \ b† = w
V (b†V )∈V(b† )

(106)
where w
˜V ≡ v
˜pa

is the subvector of v
˜ corresponding to the

(V (b†V ))\b†
(b†V ) in G(b† ).

G(b† )

random parents of V
First observe that it follows from recursive substitution (see Definition
1 (iii)) that for all v
˜ and a† , if we define b† ≡ (a† , c† = c˜), then
˜ ) = P (V(b† ) = v
˜ ),
P (V(a† ) = v
where c˜ is the value assigned to C by v
˜; the equality follows since the event
†
on the LHS includes C(aC ) = c˜ = c† . It is thus sufficient to prove that
when b† ≡ (a† , c† = c˜), the RHS of (106) is equivalent to the factorization
associated with G(b† ).
We now list the ways in which G(a† ) and G(b† ) differ:
(i) There is a fixed node c in G(b† ) that is not present in G(a† ).
(ii) For any vertex D that is a child of C in G, by the choice of C, D ∈ A.
Further, a†D = (b†D \ {c† }) ∪ b†C ; in words, the set a†D labelling the
random node corresponding to D in G(a† ) consists of the set labelling
this node in G(b† ) after having removed c and then adding the set b†C
that labels C in G(b† ).

111

(iii) For all other vertices V such that V ∈
/ chG (C), the labelling is unchanged so a†V = b†V , in particular we have a†C = b†C , hence C(a†C ) =
C(b†C ).
(iv) In G(b† ), C(b†C ) has no children, while in G(b† ) it has edges to D(a†D )
for every D ∈ chG (C). No other edges differ.
(v) If a vertex Q ∈ paG (D) \ B, where D ∈ chG (C) then by (iii), Q(a†Q ) =
Q(b†Q ). Thus the set of random parents of D(a†D ) in G(a† ) is equal to
the set of random parents of D(b†D ) in G(b† ) together with C(a†C ) =
b†C . Consequently,


paG(a† ) (D(a†D )) \ a† = paG(b† ) (D(b†D )) \ b† ∪ {C(b†C )}.
···

···

···

Q(bQ )

···

Q(aQ )
C(bC )

C(aC )

⇒

c

G(b)
D(bD )
d

···

G(a)
D(aD )

···

···
···

d

Schematic depicting the transformation G(b) 7→ G(a), where b = a ∪ {c}.
By construction, C is chosen so that every descendant of C in G is in A.
Thus every child of c in G(b) has no descendants.
Note that aQ = bQ , aC = bC , aD = (bD \ {c}) ∪ bC .

These facts are summarized in the schematic diagram above. It follows
that in the factorizations associated with G(b† ) and G(a† ), the only terms
that differ are those associated with vertices D ∈ chG (C).
˜
Consider such a vertex D, let d˜ = v˜D , c˜ = v˜C and w
˜ D the entries in v

112

corresponding to D, C and paG(b† ) (D(b†D )) \ b† respectively. Now





P D(b†D ) = d˜  paG(b† ) (D(b†D )) \ b† = w
˜D





= P D(b†D ) = d˜  paG(b† ) (D(b†D )) \ b† = w
˜ D , C(b†C ) = c†





˜ D , C(b†C ) = c†
= P D(a†D ) = d˜  paG(b† ) (D(b†D )) \ b† = w





= P D(a†D ) = d˜  paG(a† ) (D(a†D )) \ a† = (w
˜ D , c† )





†
˜
= P D(aD ) = d  paG(a† ) (D(a†D )) \ a† = (w
˜ D , c˜) ,
(107)
˜ pa
but (w
˜ D , c˜) = v

˜ corresponding to the
, the sub-vector of v

(V (a†V ))\a†
parents of D(a†D ) in G(a† ). Here the first equality follows from the
property for G(b† ), the second follows from recursive substitution,
G(a† )

random
Markov
the third follows from the fact that the random parents of D(a†D ) in G(a† )
are the random parents of D(b†D ) in G(b† ) together with C(a†C ) = C(b†C ).
The fourth follows since c† = c˜.
Thus P (V(a† )) factorizes according to G(a† ), as required. This establishes Proposition 11.

Notice that (107) shows that the conditional density associated with
D(b†D ) in G(b† ) is equal to the conditional density associated with D(a†D )
in G(a† ), when the vertex C(a†C ) that is a (random) parent of D(a†D ) in
G(b† ) takes the value c† . Consequently, starting with G(a† ), and repeatedly
removing vertices from the set of fixed vertices, via (107), we will eventually arrive back at the original graph G and the factorization of the actual
variables P (V), hence





˜D
P D(a†D ) = d˜ paG(a† ) (D(˜
aD )) \ a† = w






˜ D , paG (Y ) ∩ A = a†pa (Y )∩A .
= P D = d˜  paG (D) \ A = w
G

We have thus shown that Proposition 16 holds.

B.2

2

Proof of the necessary and sufficient condition for the
g-formula

Recall that we have factual variables:
H1 , L1 , A1 , . . . HK−1 , LK−1 , AK−1 , HK , LK , AK , Y
113

where Ht , Lt and At are, respectively, hidden variables, covariates and treatments at stage t in our sequence. Further, let Wt ≡ (Ht , Lt ), be the observed
and unobserved covariates at stage t. We define:
p(y|wK , a†K )

X

bfull
a† (y | hm , lm ) ≡

wm+1 ,...,wK

X

ba† (y | lm ) ≡

K
Y

p(wj |wj−1 , a†j−1 )

(108)

j=m+1

p(y|lK , a†K )

K
Y

p(lj |lj−1 , a†j−1 )

(109)

j=m+1

lm+1 ,...,lK

to be, respectively, the g-functional at m for the full data and the g-functional
at m for the observed data, for regime A = a† .
Lemma 51. It follows by definition that:
X
†
bfull
bfull
a† (y | hm , lm ) =
a† (y | hm+1 , lm+1 ) p(hm+1 , lm+1 | wm , Am = am ),
hm+1 ,lm+1

(110)
ba† (y | lm ) =

X

ba† (y | lm+1 ) p(lm+1 | lm , Am = a†m ).

(111)

lm+1

Our main result is as follows:
Theorem 22. Let a† be an instantiation for A. If P (V) and P (V(a† ))
factor according to G and G(a† ) respectively, and obey modularity (30) then
for all j = 0, . . . , K, and all lj ,
ba† (y | lj ) = P (Y (a† ) = y | Lj (a† ) = lj , Aj−1 (a† ) = a†j−1 )

(44)

if and only if for k = 1, . . . , K:
Y (a† ) ⊥
⊥ I(Ak (a† ) = a†k ) | Lk (a† ), Ak−1 (a† ) = a†k−1 .

(45)

We first prove the following:
Lemma 52. If P (V(a† )) factorizes according to G(a† ) then for all m =
1, . . . , K,
Y (a† ) ⊥
⊥ Am (a† ) | Lm (a† ), Hm (a† ).

114

(112)

Proof: Suppose for a contradiction that there is a path π d-connecting some
node A0 (a†A0 ) in Am (a† ) to Y (a† ) given Lm (a† ) ∪ Hm (a† ) ∪ a† in G(a† ). By
construction, since Am ⊆ A all the nodes in Am (a† ) are the random half
of nodes that have been split. Hence the first node after A0 (a†A0 ) on π is a
parent of A0 (a†A0 ) in G(a† ), and is hence a non-collider on π. But since every
2
parent of A0 (a†A0 ) is in Lm (a† ) ∪ Hm (a† ) ∪ a† this is a contradiction.
Lemma 53. If P (V) and P (V(a† )) obey modularity (30) and factorize according to G and G(a† ) respectively, then:
(i) for m = 1, . . . , K:
P (Y (a† ) = y | Hm (a† ) = hm , Lm (a† ) = lm , Am−1 (a† ) = a†m−1 )
= P (Y (a† ) = y | Hm (a† ) = hm , Lm (a† ) = lm , Am (a† ) = a†m )
= bfull
(y | lm , hm ).
a†
(ii) for m = 1, . . . , K:
P (Hm (a† ) = hm | Lm (a† ) = lm , Am (a† ) = a†m ) =
P (Hm = hm | Lm = lm , Am = a†m );
(iii) for m = 1, . . . , K:
P (Hm (a† ) = hm | Lm (a† ) = lm , Am−1 (a† ) = a†m−1 ) =
P (Hm = hm | Lm = lm , Am−1 = a†m−1 ).
Proof of (i): It follows from Corollary 18 that
P (Y (a† ) = y, HK (a† ) = hK , LK (a† ) = lK )
=

p(y|wK , a†K )

K
Y

p(wj |wj−1 , a†j−1 ).

j=1

Summation over wm+1 , . . . , wK , y then implies that:
†

†

P (Hm (a ) = hm , Lm (a ) = lm ) =

m
Y

p(wj |wj−1 , a†j−1 ).

j=1

Hence
P (Y (a† ) = y, Hm+1 (a† ) = hm+1 , Lm+1 (a† ) = lK ) | Hm (a† ) = hm , Lm (a† ) = lm )
=

p(y|wK , a†K )

K
Y

p(wj |wj−1 , a†j−1 ),

j=m+1

115

where we use Hm+1 (a† ) = {Hm+1 (a† ), . . . , HK−1 (a† )}, likewise for Lm+1 (a† ).
It then follows by summing over wm+1 , . . . , wK that:
P (Y (a† ) = y | Hm (a† ) = hm , Lm (a† ) = lm ) = bfull
a† (y | lm , hm ).
The conclusion then follows since by Lemma 52, we may add: Am (a† ) or
Am−1 (a† ) to the conditioning set.
2
Proof of (ii)&(iii): We apply Lemma 50 to remove Y, AK , LK , HK , . . . , Hm+1
to obtain:
P (Hm (a† ) = hm , Lm (a† ) = lm , Am (a† ) = a†m ) = P (Hm = hm , Lm = lm , Am = a†m )
via Proposition 17. It then follows from Lemma 49 that
P (Lm (a† ) = lm , Am (a† ) = a†m ) = P (Lm = lm , Am = a†m ),
from which (ii) follows. The proof of (iii) is essentially the same, except we
initially also remove Am .
2
Lemma 54. If P (V) and P (V(a† )) obey modularity (30) and factorize according to G and G(a† ) respectively, then for m = 1, . . . , K, and for a given
lm , the following are equivalent:
(a) Y (a† ) ⊥
⊥ I(Am (a† ) = a†m ) | Lm (a† ) = lm , Am−1 (a† ) = a†m−1 ,
X
X
†
full
†
b
(y
|
h
,
l
)p(h
|
l
,
a
)
=
bfull
†
m
m
m
m
m−1
(b)
a
a† (y | hm , lm )p(hm | lm , am ).
hm

hm

(113)
Proof: By Lemma 53(i), (ii) we have:
P (Y (a† ) = y | Lm (a† ) = lm , Am−1 (a† ) = a†m−1 )
X
=
P (Y (a† ) = y | Hm (a† ) = hm , Lm (a† ) = lm , Am−1 (a† ) = a†m−1 )
× P (Hm (a† ) = hm | Lm (a† ) = lm , Am−1 (a† ) = a†m−1 )

hm

=

X

†
bfull
a† (y | hm , lm )p(hm | lm , am−1 ).

hm

Similarly, we obtain from Lemma 53(i), (iii):
P (Y (a† ) = y | Lm (a† ) = lm , Am (a† ) = a†m )
X
=
P (Y (a† ) = y | Hm (a† ) = hm , Lm (a† ) = lm , Am (a† ) = a†m )
hm

=

X

× P (Hm (a† ) = hm | Lm (a† ) = lm , Am (a† ) = a†m )
†
bfull
a† (y | hm , lm )p(hm | lm , am ).

hm

116

The conclusion then follows because the independence (a) is equivalent to:
P (Y (a† ) = y | Lm (a† ) = lm , Am−1 (a† ) = a†m−1 )
= P (Y (a† ) = y | Lm (a† ) = lm , Am (a† ) = a†m ).
Note that the indicator variable I(Am (a† ) = a†m ) arises in the independence
(a) because the last equality only holds for Am (a† ) = a†m , and not necessarily
for other values.
2
Lemma 55 (Collapse of the g-formula). Equality (113) holds for m =
1, . . . , K if and only if for m = 0, . . . , K, and all lm ,
X
†
bfull
(114)
a† (y | hm , lm )p(hm | lm , Am−1 = am−1 ) = ba† (y | lm ).
hm

Proof: By backwards induction on m.
Base case: m = K
X
X
†
†
)
=
bfull
(y
|
h
,
l
)p(h
|
l
,
a
bfull
†
K
K
K
K
K−1
a
a† (y | hK , lK )p(hK | lK , aK )
hK

hK

=

X

p(y|hK , lK , a†K )p(hK | lK , a†K )

hK

= p(y|lK , a†K ) = ba† (y | lK ).
Here the first equality is by (113), the second by the definition of bfull
, and
a†
the third follows from the laws of probability. The conclusion follows from
the definition of ba† .
Inductive case: Suppose true for m0 > m.
X
†
bfull
a† (y | hm , lm )p(hm | lm , am−1 )
hm

=

X

=

X

†
bfull
a† (y | hm , lm )p(hm | lm , am )

hm

X

†
†
bfull
a† (y | lm+1 , hm+1 )p(hm+1 , lm+1 | wm , am )p(hm | lm , am )

hm hm+1 ,lm+1


=

X

lm+1

=


X

X

† 
†
bfull
a† (y | lm+1 , hm+1 )p(hm+1 | lm , am ) p(lm+1 | lm , am )

hm+1

ba† (y | lm+1 )p(lm+1 | lm , a†m )

lm+1

= ba† (y | lm ).
117

Here: the first equality is by (113); the second follows from Lemma 51; the
third is algebra; the fourth follows from the induction hypothesis; the fifth
is again by Lemma 51.
2
Proof of Theorem 22: It follows from Lemma 54 that under the conditions
of the Theorem the counterfactual independence (45) is equivalent to (113)
for m = 1, . . . , K. It then follows from Lemma 55 that (44) holds form
m = 1, . . . , K. The result for m = 0 follows from (44) with m = 1 since:
X
ba† (y | l1 )p(l1 )
ba† (y) =
l1

and
P (Y (a† ) = y) =

X

P (Y (a† ) = y | L1 = l1 )p(l1 ).

l1

2

Proof based on consistency
In this section we give an alternative proof of Theorem 22 under the additional assumption of consistency. Our purpose in so doing is to show the
utility of the assumption of consistency as a proof device.
Given O = (Y, LK , AK ), define
fa† (o) ≡ p(y |

lK , a†K )

K
Y

p(lj | lj−1 , a†j−1 )I(aj = a†j ),

(115)

j=0

where I(aj = a†j ) is the indicator function.88 Note that this is a degenerate
distribution under which
fa† (a∗m | lm , am−1 ) = I(a∗m = a†m ).

(116)

In the statement of Theorem 22 and proof earlier in this section we went
to some lengths to show that the conclusions followed directly from the
properties of factorization and modularity alone. An alternative approach
is to assume consistency:
Theorem 56. Under consistency
Y (a† ) ⊥
⊥ I(Am = a†m ) | Lm , Am−1 = a†m−1
⇔

for m = 1, . . . , K,

P (Y (a† ) = y | Lm = lm , Am−1 = a†m−1 ) = fa† (y | lm , a†m−1 ),

(117)

for m = 0, . . . , K.
88

The inclusion of the indicator functions is required here in order for (115) to specify
a unique joint over O.

118

Note that since whenever factorization and modularity hold it is always
possible to construct a (pseudo)-counterfactual model under which consistency also holds, an argument similar to that used in the proof of Theorem
56 may be used to establish Theorem 22 via a ‘coupling’ argument.
Proof: We first prove the equivalence for m = K.
(⇒) By consistency:
P (Y (a†K ) = y | LK = lK , AK = a†K ) = fa† (y | lK , a†K ).
Further P (Y (a† ) = y | lK , a†K ) = P (Y (a† ) = y | lK , a†K−1 ) by assumption
and fa† (y | lK , a†K ) = fa† (y | lK , a†K−1 ) by (116). Thus the right hand side
of (117) holds for K.
(⇐) Conversely,
P (Y (a† ) = y | LK = lK , AK−1 = a†K−1 ) = fa† (y | lK , a†K−1 )
= fa† (y | lK , a†K )
= P (Y (a† ) = y | LK = lK , AK = a†K ),
where the first equality is by assumption, the second by (116), and the last
by consistency.
Suppose the equivalence is true for m0 > m ≥ 1, we prove it for m.
(⇒) By the inductive assumption,
P (Y (a† ) = y | Lm+1 = lm+1 , Am = a†m ) = fa† (y | lm+1 , a†m ).
Further,
P (Y (a† ) = y | Lm = lm , Am = a†m ) = fa† (y | lm , a†m ) = fa† (y | lm , a†m−1 ),
by integration over a common law p(lm+1 |lm , am ) = fa† (lm+1 |lm , am ), and
(116). But
P (Y (a† ) = y | Lm = lm , Am = a†m ) = P (Y (a† ) = y | Lm = lm , Am−1 = a†m−1 )
by the left hand side of (117).
(⇐) We have:
P (Y (a† ) = y | Lm+1 = lm+1 , Am+1 = a†m+1 )
= P (Y (a† ) = y | Lm+1 = lm+1 , Am = a†m ) = fa† (y | lm+1 , a†m ),
119

by the inductive assumption and the right hand side of (117), for m + 1.
Thus
P (Y (a† ) = y | Lm = lm , Am = a†m ) = fa† (y | lm , a†m )
= fa† (y | lm , a†m−1 )
= P (Y (a† ) = y | Lm = lm , Am−1 = a†m−1 ),
where the first is by integration over the common law p(lm+1 |lm , am ) =
fa† (lm , am ), the second by (116), and the last by the right hand side of
(117). Hence the independence on the left hand side of (117) holds for m.
Finally, note that the right hand side of (117) with m = 1 implies the
equality with m = 0, but integration over p(l1 ) = fa† (l1 ).
2

B.3

Proofs of identification results for dynamic regimes

As in the previous section, let O = A ∪ L ∪ {Y } be the set of observed
variables, H the unobserved, V = O∪H and Wt = (Ht , Lt ), be the observed
and unobserved covariates at stage t. Given Zm ⊆ O \ (Lm ∪ Am−1 ), let
bfull
a† (zm | hm , lm ) ≡

X

p(y|wK , a†K )

X
sm

p(wj , aj |wj−1 , a†j−1 ),

(118)

j=1

hm+1 , sm

ba† (zm | lm ) ≡

K
Y

p(y|lK , a†K )

K
Y

p(lj , aj |lj−1 , a†j−1 ),

(119)

j=1

where Sm = O \ Zm .
We first state without proof the following simple multivariate extensions
of results in the previous section.
Lemma 57. Suppose P (V) and P (V(a† )) obey modularity (30) and factorize
according to G and G(a† ) respectively. For j = 1, . . . , K, let:


Zj (a† ) ⊆ O(a† ) \ Lj (a† ) ∪ Aj (a† ) .
(120)
Then for m = 1, . . . , K, and for a given lm , the following are equivalent:
(a) Zm (a† ) ⊥
⊥ I(Am (a† ) = a†m ) | Lm (a† ) = lm , Am−1 (a† ) = a†m−1 ,
X
X
†
†
(b)
bfull
(z
|
h
,
l
)p(h
|
l
,
a
)
=
bfull
†
m
m
m
m
m
m−1
a
a† (zm | hm , lm )p(hm | lm , am ).
hm

hm

(121)
120

Lemma 58 (Multivariate g-formula collapse). Equality (121) holds for m =
1, . . . , K if and only if for m = 0, . . . , K, and all lm ,
X
†
bfull
(122)
a† (zm | hm , lm )p(hm | lm , am−1 ) = ba† (zm | lm ).
hm

We define the full dynamic extended g-formula to be:
f g,full (z) ≡

X

p(y|wK , a+
K)

a+ , h, s

K
Y

p(wj , aj |wj−1 , a+
j−1 )

K
Y

+
qtg (a+
t | pat ).

t=1

j=1

(123)
where: S = O \ Z; qtg ∈ Q(g) is the density corresponding to gt ; pa+
t is the
,
l
,
a
)
of
inputs
to
g
.
Note
that
by
construction
there
subvector of (a+
t
t−1 t t
+
are no unobserved variables in PAt .
Recall that the dynamic extended g-formula for the observed data is:
f g (z) ≡

X

p(y|lK , a+
K)

a+ , s

K
Y

p(lj , aj |lj−1 , a+
j−1 )

K
Y

+
qtg (a+
t | pat ).

(64)

t=1

j=1

Lemma 59 (Dynamic g-formula collapse). If (121) holds for m = 1, . . . , K
then
f g (z) = f g,full (z).

(124)

Proof:
f

g,full

(z) ≡

X

p(y|wK , a+
K)

a+ , h, s

=

X

K
Y

a+ , s t=1

=

K
X Y

K
Y

p(wj , aj |wj−1 , a+
j−1 )

+
qtg (a+
t | pat )

t=1

j=1
+
qtg (a+
t | pat )

K
Y

X

p(y|wK , a+
K)

a+ , s t=1

p(wj , aj |wj−1 , a+
j−1 )

j=1

h
+
+
qtg (a+
t | pat )p(y|lK , aK )

K
Y

K
Y

p(lj , aj |lj−1 , a+
j−1 ),

j=1

where the first equality uses the fact that PA+
t ⊆ O, since the dynamic
regime does not depend on H; the second follows from Lemma 58.
2
Proof of Theorem 31: This follows directly from Lemmas 57 and 59.
121

2

B.4

Proof of Lemma relating to perturbed dynamic regimes

We now prove Lemma 33, which shows that checking the d-separation condition (65) for identification of a dynamic regime in G(g), is equivalent to
checking a d-separation in the dSWIG G(g−k ) corresponding to a ‘perturbed’
dynamic regime g−k (for each k).
Proof: We will define
+

T(g−k ) ≡ Ak−1 (g−k ) ∪ Lk (g−k ) ∪ Ak−1 (g−k );
T(a† ) ≡ Ak−1 (a† ) ∪ Lk (a† ) ∪ a† in G(a† )
(i) ⇒ (ii): Suppose for a contradiction that there is a path π d-connecting
Ak (g−k ) and Y (g−k ) given T(g−k ) in G(g−k ), but that Ak (a† ) is d-separated
from Zk (a† ) by T(a† ) in G(a† ).
First note that the ordering of the vertices in A(g) ∪ A+ (g) ∪ L(g) is
a topological ordering of the observed vertices in G(g) and hence also of
the observed vertices G(g−k ). Further since T(g−k ) is subset of the variables
prior to Ak (g−k ), any vertex V (g−k ) on π that is in A(g−k )∪A+ (g−k )∪L(g−k )
and is after Ak (g−k ) is not an ancestor of T(g−k ). Hence V (g−k ) is a noncollider on π and the subpath of π between V (g−k ) and Y (g−k ) takes the
form of a directed path from V (g−k ) to Y (g−k ).
If the sequence of vertices corresponding to π in G(a† ) does not form a
path d-connecting Ak (a† ) and Y (a† ) in G(a† ) then either:
(a) There is a dashed edge on π that is not present in G(a† ), or
(b) There is a non-collider on π that is not in T(g−k ), but the corresponding vertex in G(a† ) is in T(a† ), or
(c) There is a collider on π that is in anG(g−k ) (T(g−k )) but is not in
anG(a† ) (T(a† )).
Let V ∗ (g−k ) be the first vertex on π, starting from Ak (g−k ) at which one of
(a), (b) or (c) holds. We consider each in turn.
If (a) holds then there is a dashed edge V ∗ (g−k ) 99K A+
` (g−k ) on π. By
construction of G(g−k ), V ∗ (g−k ) is not Ak (g−k ), since all such dashed edges
∗
are removed in G(g−k ). Since every parent of A+
` (g−k ) is observed, V (g−k )
+
∗
is in A(g−k ) ∪ A (g−k ) ∪ L(g−k ). But since π is d-connecting and V (g−k )
is a non-collider, V ∗ (g−k ) ∈
/ T(g−k ). This implies that both V ∗ (g−k ) and
+
A` (g−k ) are ordered after Ak (g−k ). It then follows that V ∗ (g−k ), A+
/
` (g−k ) ∈
anG(g−k ) (T(g−k )). Hence V ∗ (g−k ) = V (g−k ) and π takes the form:
Ak (g−k ) · · · V (g−k ) 99K A+
` (g−k ) → · · · → Y (g−k ).
122

Since V ∗ (g−k ) ∈ anG(g−k ) (Y (g−k )), it follows that V ∗ (g) ∈ anG(g) (Y (g)).
This then implies that V ∗ (a† ) ∈ Zk (a† ). By the definition of V ∗ (g−k ), the
subpath of pi between Ak (a† ) and V ∗ (a† ) d-connects in G(a† ) given T(a† ),
which is a contradiction.
If (b) holds then since the only vertices that are conditioned on in T(a† ),
but for which the corresponding vertex is not conditioned on in T(g−k ) are
fixed vertices a` in G(a† ), corresponding to a vertex A+
` (g−k ) that occurs
after Ak (a† ) in the ordering. Consequently, A+
(g
)
∈
/
anG(g−k ) (T(g−k )).
−k
`
The path π thus takes one of the following form:
Ak (g−k ) · · · 99K A+
` (g−k ) → · · · → Y (g−k ),
Ak (g−k ) · · · ← A+
` (g−k ) L99 · · · → Y (g−k ),
Ak (g−k ) · · · ← A+
` (g−k ) → · · · → Y (g−k ).
By the definition of V ∗ (g), the first cannot arise since (a) would be true
at the vertex prior to Ak (g−k ) on π. The other two possibilities also give
rise to a contradiction because there cannot be a collider on π between
+
Ak (g−k ) and A+
/ anG(g−k ) (T(g−k )), but this would
` (g−k ), since A` (g−k ) ∈
+
imply A` (g−k ) ∈ anG(g−k ) (Ak (g−k )), but this would violate the assumption
that we have a topological ordering on G(g).
If (c) holds then first note that the vertex V ∗ (g−k ) in G(a† ) is not a
fixed vertex (since by definition of V ∗ (g−k ) neither of the edges adjacent to
V ∗ (g−k ) on π are dashed). Thus let V ∗ (a† ) denote the corresponding vertex
in G(a† ). Since V ∗ (g−k ) ∈ anG(g−k ) (T(g−k )), but V ∗ (a† ) ∈
/ anG(a† ) (T(a† )),
∗
it follows that on every directed path from V (g−k ) to some vertex in
anG(g−k ) (T(g−k )) there is at least one dashed edge. (Note that the set
T(a† ) contains all the vertices corresponding to vertices in T(g−k ).) Let
∗
V ∗ (g−k ) 99K A+
` (g−k ) be the first such edge on a directed path from V (g−k )
+
to a vertex in T(g−k ). As in case (a), since every parent of A` (g−k ) is
observed, V ∗ (g−k ) is in A(g−k ) ∪ A+ (g−k ) ∪ L(g−k ), but by hypothesis,
V ∗ (g−k ) ∈
/ T(g−k ), so V ∗ (g−k ) is ordered after Ak (g−k ), but this contra∗
dicts V (g−k ) being on a directed path to some vertex in T(g−k ).
(i) ⇐ (ii): Suppose that there is a path d-connecting Ak (a† ) to some
vertex in Zk (a† ) given T(a† ) in G(a† ). Let π † be a shortest such d-connecting
path, with endpoint Q(a† ) ∈ Zk (a† ).
By definition of Zk (g), the vertex

Q(g) ∈ A(g) ∪ A+ (g) ∪ L(g) ∩ anG(g) (Y (g))
123

but is ordered after Ak (g). Consequently, if Q(g−k ) is the corresponding vertex in G(g−k ) then Q(g−k ) ∈
/ anG(g−k ) (T(g−k )) and Q(g−k ) ∈ anG(g−k ) (Y (g−k )).
†
Every edge in G(a ) is also present in G(g−k ). Thus let π † (g) be the path
corresponding to π † in G(g−k ). By the construction of G(a† ), fixed vertices
have no parents, so there is no collider on π † that is an ancestor of a fixed
vertex in G(a† ). Thus every collider on π † (g) is an ancestor of a vertex in
T(g−k ). It follows that by concatenating π † (g) and a directed path from
Q(g−k ) to Y (g−k we form a path that d-connects Ak (g−k ) and Y (g−k ) given
T(g−k ).
2

C

Relationship to Fully Randomized Causally Interpretable Structured Tree Graphs

In this section we consider the relationship of our results to the counterfactual models of Robins (1986, 1987) through the following development.
We first review the assumptions relating to counterfactual variables that are
used in Robins (1986, 1987).89
We are given an ordered set V of random variables and a set of K treatments A = {A1 , . . . , AK } ⊆ V with Am preceeding Am+1 , in the ordering.
In Robins (1986) the ordering was taken to be temporal except for the discussion of the healthy worker survivor effect; see Section 11 of (Robins, 1986)
and §4.2.4.
We shall denote by Lm the subset of V between Am−1 and Am in the
ordering and let Dm = {Lm , Am }. Note that Am and Lm are disjoint and
that D ≡ DK+1 is all of V.
We assume the counterfactual V(r) is well defined for any assignment r
to a subset R ⊂ A defined as follows:
Definition 60 (Counterfactual Existence Assumption for (A, V)).
(i) All one-treatment-ahead counterfactuals Dm (am−1 ) exist for any setting of am−1 in the state space Am−1 of Am−1 , for m = 1, . . . , K +1.90
89
Robins’ counterfactual models were defined in terms of so-called structured tree graphs
rather than in terms of a set of variables V; the latter being the leading special case of
the former. For consistency with the remainder of this paper this appendix treats only
this special case.
90
Here as elsewhere, As = (A1 , . . . , As ) and A0 denotes an empty vector.

124

(ii) Both the factual variables Dm and the counterfactuals Dm (r) for any
R ⊂ A exist and are obtained recursively from the one-treatment-ahead
counterfactuals Dj (aj−1 ), for j ≤ K + 1, as follows:


Dm (˜r) = Dm ˜rAm−1 ∩R , B(˜r) ,
(125)
where B(˜r) ≡ {Aj (˜r) | Aj ∈ Am−1 , Aj ∈
/ R} are the counterfactual
variables in A that are prior to Dm , but not in R, evaluated under the
intervention ˜r.
Assumption (ii) combines the assumptions of consistency, recursive substitution, and the assumption that earlier variables (with respect to the ordering) are not caused by later treatments. For example, D3 = D3 (A1 , A2 (A1 ))
and D3 (a1 ) = D3 (a1 , A2 (a1 )), D3 (a1 , as ) = D3 (a1 ) for s > 2.

C.1

Definition of the CISTG model associated with (A, V)

Suppose the counterfactual existence assumption holds for (A, V). The
causally interpreted structured tree graph model with interventions A and
variables V, where A ⊆ V, denoted CISTG(A, V), is the set of all joint
distributions over these factuals and counterfactuals.
If there is no strict superset Asup of A such that the counterfactual
existence assumption holds for (Asup , V), we say CISTG(A, V) is a finest
CISTG. Intuitively a CISTG is ‘finest’ if the set of treatments A cannot be
enlarged without encountering counterfactuals judged to be ill-defined. If all
variables in V have associated well defined counterfactuals then CISTG(V, V)
is well defined and is the unique finest CISTG.
Given a CISTG, it follows from the existence assumption above that we
may always consider a smaller set of interventions and variables, without
fear that any of the counterfactuals are not well-defined:
Lemma 61. If the counterfactual existence assumption holds for (A, V), it
also holds for any (Asub , Vsub ) such that Vsub ⊂ V and Asub ⊂ Vsub ∩ A;
and then it holds for (Asub , Vsub ).
Proof: Follows immediately from recursive substitution, (Def. 60(ii)).

2

In the following development, Ym is a given subvector of responses Lm =
(Ym , Wm ) where Ym and Wm are disjoint.

125

C.2

Randomized CISTG models

We now define three classes of CISTG models: ‘fully randomized’, ‘randomized’ and ‘randomized with respect to Y’. Here, the models differ with
respect to which intervention distributions are identified. In the fully randomized model, the effect of A on every variable in V is identified both
unconditionally as well as conditional on treatments and covariates that are
earlier in the ordering; this includes the effect that earlier interventions Aj
have on the value of later treatments Ak that a subject would receive were it
not for intervention on Ak . In the randomized model, the effect of A on every variable in V\A is identified (again conditional on earlier variables), but
the effect of earlier treatments on the values that later treatment variables
would take are not identified. Finally, in models randomized with respect
to Y, it is only the effect of A on Y (conditional on earlier variables) that
is identified.
Definition 62. A submodel of a CISTG(A, V) model is fully randomized
(FRCISTG (A, V)); randomized (RCISTG (A, V)); randomized with respect to Y (RCISTG: Y(A, V)) if each distribution in the submodel obeys
the following independences:
{Zm+1 (a†m ), . . . , ZK+1 (a†K )} ⊥
⊥ Am | Lm = lm , Am−1 = a†m−1 ,
for all m ≤ K, a†K , lm ,

(126)

for Z = D, Z = L, or Z = Y, respectively.
Note that by (ii), (126) is equivalent to:
{Zm+1 (a†m ), . . . , ZK+1 (a†K )}⊥
⊥ Am (a†m−1 ) | Lm (a†m−1 ) = lm , Am−1 (a†m−2 ) = a†m−1 ,
for all m ≤ K, a†K , lm ,

(127)

where Lm (a†m−1 ) = (L1 , L2 (a†1 ), . . . , Lm−1 (a†m−2 ), Lm (a†m−1 )).
Observe that in Definition 62 the randomized CISTG models are all
defined relative to a fixed ordering of the variables V. In this section
the ordering will be fixed implicitly via variable names and indices to be
hL1 , A1 , . . . , LK+1 i. However, in section §C.3, we will consider the same set
of variables under different orderings, and will thus index each model via
the specific ordering thus: FRCISTG≺ (A, V).
The following is obvious:
126

Proposition 63. The FRCISTG (A, V) model is contained in the RCISTG
(A, V) model; further the RCISTG (A, V) model is contained in the RCISTG:Y
(A, V) model.
Given an FRCISTG(A, V), we say an FRCISTG (A, V) is a finest
FRCISTG(A, V), (i.e. an FFRCISTG(A, V)) if the associated CISTG(A, V)
is a finest CISTG.
Consider a DAG G and a CISTG (V, V) for which the CISTG ordering
is a topological with respect to G. Then the FFRCISTG model associated
with G introduced in §3 is precisely the FFRCISTG (V, V) model if G is
complete; otherwise the FFRCISTG is a submodel. This follows from the
fact that Robins and Richardson (2011) prove that (126) with Z = D is
equivalent to the independencies (17) that defined the FFRCISTG model in
§3.2.
Lemma 64. Suppose we are given a distribution P (V) in the CISTG(A, V)
model and a subset Asub of A. Let P (V∗ ) be the marginal distribution of
P (V) over the counterfactual variables in the CISTG(Asub , V). If P (V) is
in the FRCISTG(A, V), then P (V∗ ) is in FRCISTG(Asub , V).
Proof: The marginal distribution P (V∗ ) is in the FRCISTG(Asub , V) model
because the independencies defining the FRCISTG(Asub , V) are implied by
those defining the FRCISTG(A, V): the conditioning events are the same,
Asub is a subset of A, and the counterfactuals on the lefthand side of the
independence of (126) under FRCISTG (Asub , V) are functions of and only
of the counterfactuals on the lefthand side of (126) under FRCISTG (A, V)
and the variables conditioned on.
2
Lemma 64 does not hold with ‘FRCISTG’ replaced by either ‘RCISTG’
or ‘RCISTG:Y’, or with Vsub substituted for V. The latter implies that
the FRCISTG model need not preserved when marginalizing over hidden
variable H = V \ Vsub ; in other words if there are unobserved confounders
then we are no longer ‘fully randomized’.
Theorem 65. For any distribution in a model FRCISTG (A, V):
(a) The joint distribution of V(a† ) ≡ DK+1 (a†K ) = {D1 (a†1 ), . . . , DK+1 (a†K )}

127

is given in terms of the distributions of the factuals by
P (Dm (a†m−1 ) = dm | Lm−1 (a†m−2 ) = lm−1 )
= P (Dm = dm | Lm−1 = lm−1 , Am−1 = a†m−1 ),
(128)
P (DK+1 (a†K ) = dK+1 ) =

K+1
Y

P (Dm = dm |Lm−1 = lm−1 , Am−1 = a†m−1 )

m=1

(129)
where the RHS of (129) is the extended g-formula associated with
(A, V). Thus P (V(a† )) is identified whenever the extended g-formula
is a unique function of the distribution of the factuals. Note Dm =
(Lm , Am ) and dm = (lm , am ) where am need not equal a†m .
(b) The following independence holds:
Dm+1 (a†m )⊥
⊥ Am (a†m−1 ) | Lm (a†m−1 ) = lm ,

(130)

for all m ≤ K, a†K−1 , lm .
(c) If (129) is a unique function of the distribution of the factuals then
P (V) factors relative to a DAG G (consistent with an ordering on
V) if and only if P (V(a† )) factors relative to G(a† ). In that case
(G, P (V)) and (G(a† ), P (V(a† ))) satisfy the modularity assumption (30).
The condition in (a) that the g-formula is a unique function of the distribution of the factuals will hold if P [Li = li , Ai−1 = a†i−1 ] > 0 implies
i
h
P Ai = a†i |Li = li , Ai−1 = a†i−1 > 0.
Remark: If we were to replace Am by I(Am = a†m ) in (126), as in the
definition of the MCM considered in Robins and Richardson (2011), then
the conclusions of Theorem 65 do not hold.91
Theorem 66. For any distribution in the RCISTG (A, V) model
91

(Robins and Richardson, 2011, Appendix A, p.147) present a counterfactual distribution with a ternary treatment A and binary response Y (a) which satisfies (126) but
with Am replaced by I(Am = a†m ). Under that model the distribution P (A, Y (a)) is not
identified (even though the observed distribution is positive). Consequently (129) fails to
hold.

128

(a) the joint distribution of L(a† ) ≡ LK+1 (a†K ) = {L1 , L2 (a†1 ), . . . , LK+1 (a†K )}
is given in terms of the distributions of the factuals by
P (Lm (a†m−1 ) = lm | Lm−1 (a†m−2 ) = lm−1 )
= P (Lm = lm | Lm−1 = lm−1 , Am−1 = a†m−1 )
P (L1 (a†1 ) = l1 , . . . , LK+1 (a†K ) = lK+1 | Lm (a†m−1 ) = lm )
=

K+1
Y

P (Lm = lm |Lm−1 = lm−1 , Am−1 = a†m−1 )

(131)

m=1

where the RHS is the (unextended) g-formula.
Thus P (L(a† ) = l), where l = (l1 , . . . , lK+1 ), is identified whenever
the extended g-formula is a unique function of the distribution of the
factuals.
(b) If the density (131) is a unique function of the distribution of the factuals and the density P (V) of the factuals factors according to a DAG
G then the counterfactual distribution P (L(a† )) factors with respect to
the induced subgraph of G(a† ) on L(a† ).
Theorem 67. For any distribution in the RCISTG: Y (A, V) model the
joint distribution of Y(a† ) = Y K+1 (aK ) = {Y1 , Y2 (a†1 ), . . . , YK+1 (a†K )} satisfies for j = 1, . . . , K:

P Yj+1 (a†j ) = yj+1 , . . . , YK+1 (a†K ) = yK+1 | Yj (a†j−1 ) = yj ,

Wj (a†j−1 ) = wj , Aj (a†j−1 ) = a†j
=

X

K
Y

wj ,...,wK m=j+1

P ({Ym , Wm } = (ym , wm ) | Ym−1 = ym−1 ,

(132)

Wm−1 = wm−1 , Am−1 = a†m−1 )

where the RHS is the conditional g-formula for Y. Thus P (Y(a† ) = y) is
identified whenever the RHS with j = 0 is a unique function of the distribution of the factuals.
Note that for univariate Y , (132) corresponds to ba† (y | lj ) given in
Definition 21. We now illustrate the definitions and results given above
with examples.

129

Example of an FRCISTG
Consider an FRCISTG (A, V) whose factual density P (V) factors according to the DAG in Figure 12(i) with V =(H, A0 , L, A1 , Y ). Let Vobs =
(A0 , L, A1 , Y ) be the observed variables. Then CISTG (A, Vobs ) is a FRCIST (A, Vobs ).
Proof: By Theorem 65 the counterfactual densities P (V(a† )) given by the
FRCISTG (A, V) factors according to G(a† ) in Figure 12(ii). By d-separation
on Figure 12(ii), we have
Y (a0 , a1 ) ⊥
⊥ A1 (a0 ) | A0 , L(a0 )

and

{Y (a0 , a1 ), L(a0 ), A1 (a0 )} ⊥
⊥ A0

which imply the defining independencies (126) for the FRCISTG (A, Vobs ).
Note in this example, as will be the case in the following examples, the
factual densities P (Vobs ) associated with FRCISTG (A, Vobs ) do not factor
according to any incomplete DAG.
Example of an RCISTG
Consider an FRCISTG (A, V) with V = (H1 , H2 , A1 , L, A2 , Y ) whose factual density P (V) factors according to the DAG in Figure 19(i). Let Vobs =
(A1 , A2 , L, Y ) be the observed variables. Then the CISTG (A, Vobs ) is an
RCISTG (A, Vobs ) but not an FRCISTG (A, Vobs ).
Proof: By Theorem 65, the counterfactual densities P (V(a† )) implied by the
FRCISTG (A, V) factor according to a graph G(a† ) shown in Figure 19(ii).
By d-separation, we have
Y (a1 , a2 ) ⊥
⊥ A2 (a1 ) | A1 , L(a1 )

and

{Y (a1 , a2 ), L(a1 )} ⊥
⊥ A1 ,

which imply the defining independencies (126) for RCISTG (A, Vobs ). However, A2 (a1 ) and A1 are d-connected (given the empty set). Thus, by completeness (Theorem 19), there exists a law in FRCISTG (A, V) with A2 (a1 )
and A1 dependent. Since the marginal of that law over Vobs is in CISTG
(A, Vobs ), we conclude that CISTG (A, Vobs ) is not an FRCISTG (A, Vobs ).
Example of an RCISTG: Y (A, V)
Consider an FRCISTG (A, V) with V = (H1 , H2 , A0 , L, A1 , Y ) whose factual densities P (V) factor according to the DAG in Figure 13(i). Let

130

Vobs = (A0 , A1 , L, Y ) be the observed variables. Then CISTG (A, Vobs )
is an RCISTG: Y (A, Vobs ) but not an RCISTG (A, Vobs ).
Proof: By Theorem 65, the counterfactual densities P (V(a† )) implied by
the FRCISTG (A, V) factors according to G(a† ) in Figure 13(ii). By dseparation, we have Y (a0 , a1 )⊥
⊥A1 (a0 )|A0 , L(a0 ) and Y (a0 , a1 )⊥
⊥A0 , which
imply the defining independencies (126) for RCISTG: Y (A, Vobs ). However, A1 (a0 ) and L1 (a0 ) are both d-connected to A0 . Thus, by completeness
(Theorem 19), there exists a law in FRCISTG (A, V) with neither A1 (a0 )
nor L1 (a0 ) independent of A0 . Since the marginal of that law over Vobs is
in CISTG (A, Vobs ), we conclude that CISTG (A, Vobs ) is not an RCISTG
(A, Vobs ).

C.3

Individual Level Exclusion Restrictions and Graphs

In the development in Section 3 the graph was taken as a primitive and the
NPSEM was then built on top of this. Our development in the previous
section, which follows Robins (1986, 1987) differed from this in that the
definitions of CISTG(A, V) and FRCISTG (A, V) do not make any mention
of graphs. In more detail:
• The definition of CISTG(A, V) in §C.2 makes no mention of a graph
G, nor of individual-level exclusion restrictions;
• The definition of FRCISTG(A, V) in §C.2 is relative to an ordering of
the variable set V;
• The underlying counterfactual existence assumption (Def. 60) does not
refer to a graph, in contrast to the assumption in §3 (Def. 1);
• In §3 every variable could be intervened upon, so A = V.
Here we explain how starting from the definitions in the previous section,
by additional additional background information, one may arrive at the
definition in Section 3. This thus shows that in logical terms, the graphical
theory presented in §3 may be reduced to a purely counterfactual theory.

C.4

CISTG with exclusion restrictions

Clause (i) of the counterfactual existence assumption given by Definition 60
takes the set of one-treatment-ahead counterfactuals Dm (am−1 ) as primitive.
All other counterfactuals are then derived as simple recursive functions of
these via clause (ii). Note that formally, the set of counterfactual variables
131

that are ‘one-treatment-ahead’ is determined by the ordering of the set V.
Since we will wish to consider the effect of different choices for the ordering
we will write CISTG≺ (A, V) to indicate the dependence on the choice of an
ordering ≺ of V.
Robins (1986, §8) considered CISTG(A, V) models that also satisfied
individual level exclusion restrictions:
Definition 68. Given a pair (A, V), an ordering ≺0 on V satisfying the
counterfactual existence assumption, and any V ∈ V, let AV be the smallest
subset of A satisfying the individual exclusion restriction that, for all a,
V (a) = V (aV ) for each unit. The variables in A≺
V are the individual level
direct causes of V (relative to A) under ordering ≺.
We will show below that so long as each variable is ordered after its
direct causes, the choice of ordering here is not important.
Definition 69.

	 The CISTG≺ (A, V) with individual level direct causes
≺
AV ; V ∈ V model is the submodel of the CISTG≺ (A, V) model in which
for each V , AV are the direct causes of V
	

Consider a CISTG≺ (A, V) with individual level direct causes A≺
V ;V ∈ V .
Let O≺ be the set of orderings of V such that for every V ∈ V, each element
of A≺
V precedes V in the ordering; note that by definition ≺∈ O≺ .
Proposition 70. Let V≺ be the set of counterfactual random variables in
C≺ , a CISTG≺ (A, V). Let B≺∗ ⊆ V≺ be the subset of random variables in
V≺ that are ‘one-treatment-ahead’ counterfactuals under a different order
≺∗ ∈ O≺ . Finally, let V≺∗ be the set of counterfactual random variables
derived from B≺∗ via recursive substitution (125). Then V≺∗ = V≺ .92
Proof: Given a variable D ∈ V with indices m and m∗ under the orderings ≺
and ≺∗ , let D≺,m (˜
r) and D≺∗,m∗ (˜
r) be the corresponding variables in V≺ and
V≺∗ respectively. By construction, any one-treatment ahead counterfactual
D≺∗,m∗ (a†≺∗,m−1 ) ∈ B≺∗ ⊆ V≺ , so
D≺∗,m∗ (a†≺∗,m∗ −1 ) = D≺,m (a†≺∗,m∗ −1 ),

(133)

here a†≺∗,m∗ −1 is an assignment to A≺∗,m∗ −1 the set of treatment variables
prior to D under the orderings ≺∗ . It is thus sufficient to show by induction
92
Here we are asserting equality of the individual random variables within each set. In
other words, for every variable T ∈ V and intervention ˜
c, where C ⊆ A, T≺ (˜
c) = T≺∗ (˜
c),
for every unit of the population, where here T≺ (˜
c) and T≺∗ (˜
c) denote the associated
counterfactuals associated variables within the sets V≺ and V≺∗ .

132

that each application of recursive substitution results in the same random
variable. For any assignment ˜
r to R ⊆ A, we have the following:


∗
D≺∗,m∗ (˜
r) = D≺∗,m∗ ˜rA≺∗,m∗ −1 ∩R , W≺
r)
∗ (˜


∗
= D≺,m ˜rA≺∗,m∗ −1 ∩R , W≺
(˜
r
)
∗


= D≺,m ˜rA≺∗,m∗ −1 ∩R , W≺∗ (˜r)

(134)



= D≺,m ˜rA≺ ∩R , WD (˜r)
D



= D≺,m ˜rA≺,m−1 ∩R , W≺ (˜r) = D≺,m (˜
r),
where
W≺∗ ∗ (˜r) ≡ {A≺∗ (˜r) | A ∈ A≺∗ ,m∗ −1 , A ∈
/ R}

⊆ V≺∗ ,

W≺∗ (˜r) ≡ {A≺ (˜r) | A ∈ A≺∗ ,m∗ −1 , A ∈
/ R}

⊆ V≺ ,

WD (˜r) ≡ {A≺ (˜r) | A ∈

A≺
D, A

∈
/ R}

W≺ (˜r) ≡ {A≺ (˜r) | A ∈ A≺,m−1 , A ∈
/ R}

⊆ V≺ ,
⊆ V≺ ,

and A≺,m−1 are the treatment variables prior to D under the ordering ≺.
In (134) the first equality follows by (125); the second by (133); the third
is by the inductive hypothesis, which implies W≺∗ ∗ (˜r) = W≺∗ (˜r); the fourth
∗
and fifth follow by the definition of A≺
D since both ≺ and ≺ are in O≺ ; the
sixth is again by (125).
2
It follows directly from Proposition 70 that if a set of counterfactuals
forms a CISTG≺ (A, V) then it also forms a CISTG≺∗ (A, V) for any other
ordering ≺∗ ∈ O≺ . Consequently, ≺∈ O≺∗ ⇔ ≺∗ ∈ O≺ , hence O≺∗ =
O≺ . Thus a CISTG and the set of direct causes are invariant to the choice
of ordering in this class, consequently we suppress the ordering and write
CISTG(A, V) and AV . Such a result was first given in Section 11.F of
Robins (1986) .
The invariance to choice of order extends to the FFRCISTG≺ (V, V)
submodel of the CISTG(V, V) with direct causes:
Lemma 71. Consider a counterfactual distribution P (V) that is in the
FRCISTG≺ (V, V) with individual direct causes {AV | V ∈ V, AV ⊂ V =
A}. For any ≺∗ in O≺ , P (V) is also in the FRCISTG≺∗ (V, V) with the
same individual direct causes.
133

Thus given a CISTG≺ (V, V) the FRCISTG≺∗ (V, V) submodels are
equivalent for all ≺∗ ∈ O≺ . We may naturally associate a graph G with
an FRCISTG≺ (V, V) model with direct causes by setting the parents of
paG (V ) ≡ AV for all V ∈ V. Under this correspondence the FRCISTG≺ (V, V)
is precisely the NPSEM model associated with G under the FFRCISTG93
independence assumption (17), introduced in Section 3.
Proof: This follows from the fact that Robins and Richardson (2011) prove
that the defining independences (126) with Z = D for an FRCISTG≺ (V, V)
with direct causes {AV } are equivalent to the independences (17) for the
graph G with paG (V ) ≡ AV for V ∈ V; the latter set of independence
relations are invariant to the choice of topological ordering ≺ for G.
2
Corollary 72. Given a distribution P (V) in the FRCISTG≺ (V, V) with
direct causes {AV }. Let A∗ ⊆ V, and let P (V∗ ) be the marginal distribution
over the counterfactual variables in CISTG(A∗ , V). For any ordering ≺∗ in
O≺ , P (V∗ ) is in FRCISTG≺∗ (A∗ , V).
Proof: This follows directly from Lemmas 71 and 64.
2
The above Lemma and Corollary would not hold in general had we taken
as our premise that P (V) is in the FRCISTG≺ (A, V), for A a strict subset
of V. Likewise it would not hold for either the RCISTG(A, V) or RCISTG
Y : (A, V) submodels of a CISTG≺ (A, V) with direct causes {AV }. As
the examples in the next section show these models are not invariant to the
choice of ordering within O≺ . Consequently, the g-formula will represent
a causal quantity only under some topological orderings and not others.
However, we note that, given a DAG G, the ID algorithm of Tian and Pearl
(2002) and the IDC algorithm of Shpitser and Pearl (2006a) will identify all
the intervention distributions that are identified by a g-formulae, in addition
to identifying other intervention distributions, such as P (Y (a1 , a2 )) in Figure
14 that are not identified via g-formula.
C.4.1

Examples

Consider the graph G shown in Figure 17(a) with V = hH1 , A, S, Y i, denoting the implied ordering ≺. Consider the FRCISTG≺ (V, V), with direct
effects relative to A = V given by the parents in G:
AH1 = ∅; AA = {H1 }; AS = {H1 }; AY = {A, S}.
93

Note that if A = V then clearly the set of counterfactuals cannot be enlarged. Thus
the FRCISTG is ‘finest’ and thus an FFRCISTG.

134

In this example the set of orderings
O≺ = {hH1 , A, S, Y i, hH1 , S, A, Y i}
corresponding to the topological orderings of G. As noted above, this model
corresponds to the FFRCISTG associated with G.
By Corollary 72 given any distribution P (V) in the FRCISTG≺ (V, V),
the margin P (V∗ ) over the counterfactual variables in CISTG(A, V) also
obeys the FRCISTG≺∗ (A, V) assumptions for both orderings ≺∗ in O≺ .
However, if we now consider the subset Vobs = {A, S, Y } ⊆ V, a margin
P (V0 ) over the counterfactual variables in CISTG(A, Vobs ) is an FRCISTG
under the ordering hS, A, Y i but not hA, S, Y i. This may be seen by inspecting the template G(a) shown in Figure 17(b), since we have: Y (a) ⊥
⊥A | S
as required by hS, A, Y i, but not Y (a) ⊥
⊥ A, which is the ordering hA, S, Y i
requires.
For a second example, consider the FRCISTG≺ (V, V), with
V = hH0 , A0 , D1 , H1 , A1 , D2 i
with direct causes given by the graph G shown in Figure 18(a), again using
≺ to denote the ordering.
Given a distribution P (V) in FRCISTG≺ (V, V), let P (V∗ ) be the marginal
distribution over the counterfactuals in the CISTG(A, Vobs ), where A =
{A0 , A1 } and Vobs = {A0 , D1 , A1 , D2 }. Under the (natural) ordering induced by ≺ on Vobs , P (V∗ ) is not in RCISTG≺ (A, Vobs ) nor even in RCISTG≺
Y : (A, Vobs ), with Y = {D2 }. However, under the ordering
≺∗ = hD1 , A0 , D2 , A1 i,
which is in O≺ for the CISTG≺ (A, Vobs ), P (V∗ ) is in the RCISTG≺∗ (A, Vobs ).
Consequently the distribution P (D2 (a0 , a1 )) = P (D2 (a0 )) is identified. See
Robins (1986, §11) and §4.2.4 for further discussion.

C.5

Proofs of results relating to RCISTGs

We now prove Theorems 65, 66 and 67.
Lemma 73. The defining independence (126) for an FRCISTG (A, V) is
equivalent to the following holding for all 1 ≤ m ≤ K + 1:
Dm+1 (a†m ) ⊥
⊥ Am (a†m−1 ) | Lm (a†m−1 ).
135

Proof: The defining independence (126) for an FRCISTG (A, V) is that:
n
o
Dk+1 (a†k ), . . . , DK+1 (a†K ) ⊥
⊥ Ak | Lk = lk , Ak−1 = a†k−1 ,
for all k, all a† and all lk . Under consistency, this holds if and only if
n
o
Dk+1 (a†k ), . . . , DK+1 (a†K ) ⊥
⊥Ak (a†k−1 ) | L1 = l1 , A1 = a†1 , L2 (a†1 ) = l2 , . . . ,
Lk−1 (a†k−2 ) = lk−1 , Ak−1 (a†k−2 ) = a†k−1 , Lk (a†k−1 ) = lk ,
which may be re-written more compactly as:
o
n
⊥Ak (a†k−1 ) | Lk (a†k−1 ) = lk , Ak−1 (a†k−2 ) = a†k−1 .
Dk+1 (a†k ), . . . , DK+1 (a†K ) ⊥
(135)
Since Dk ≡ (Lk , Ak ) it follows from the weak union and decomposition properties that (135) is equivalent to the following conditional independences:
Dm+1 (a†m )⊥
⊥Ak (a†k−1 ) | Lm (a†m−1 ) = lm , Ak+1 (a†k ), . . . ,
Am (a†m−1 ), Ak−1 (a†k−2 ) = a†k−1 ,

for 1 ≤ k ≤ m ≤ K.

This is then equivalent to it holding for 1 ≤ k ≤ m ≤ K that:
Dm+1 (a†m )⊥
⊥Ak (a†k−1 ), . . . , Am (a†m−1 ) | Lm (a†m−1 ) = lm , Ak−1 (a†k−2 ) = a†k−1 .
2

The conclusion follows, taking k = 1.

Proof of Theorem 65: Lemma 73 establishes the independence (130) given
in (b). This is the (ordered) local Markov property for the SWIG G(a† )
obtained from a complete DAG G for P (V), with edges oriented according
to the ordering (L1 , A1 , . . . , LK , AK , LK+1 ). By results in (Lauritzen et al.,
1990) the ordered local Markov property is equivalent to the global Markov
property (24). It then follows from (e.g. Lauritzen, 1996, Thm. 3.27) that:
P (DK+1 (a†K ) = d) =

K+1
Y

P (Dm (a†m−1 ) = dm | Lm−1 (a†m−2 ) = lm−1 ). (136)

m=1

It further follows from (130) and consistency that:
P (Dm (a†m−1 ) = dm | Lm−1 (a†m−2 ) = lm−1 )
= P (Dm (a†m−1 ) = dm | Lm−1 (a†m−2 ) = lm−1 , Am−1 (a†m−2 ) = a†m−1 )
= P (Am = a†m | Lm = lm , Am−1 = a†m−1 )
×

P (Lm = lm | Lm−1 = lm−1 , Am−1 = a†m−1 ).
136

(137)
(138)

which establishes (a). The ‘only if’ in (c) then follows because given an
incomplete DAG G, factorization of P (V) with respect to G implies that the
conditioning set on the left hand side of (137) and (138) may be reduced to
paG(a† ) (Am (a†m−1 ))

and paG(a† ) (Lm (a†m−1 ))

respectively. Since this holds for every a† and l then (136) implies that
P (V) factorizes with respect to G. The proof of the converse is essentially
the same.
2
Proof of Theorem 66: Property (a) follows from Theorem 4.1 of Robins
(1986). The second claim follows from (131) by an argument similar to that
establishing (c).
2
Note that whereas (c) in Theorem 65 asserts that P (V) factorizes with
respect to G if and only if P (V(a† )) factorizes with respect to G(a† )) for all
a† , in Theorem 66 (b) the implication is only one way. This is because where
V contains the variables in A, under the RCISTG (A, V) model only the
distribution over the counterfactual variables in V \ A = L is identified.
Proof of Theorem 67: This follows from the Corollary to Theorem AD.1 in
Robins (1987) and Lemma 58 in Appendix §B.3.
2.

D

A brief history of Pearl’s approaches to linking
graphs and counterfactuals

Pearl (2000, §3.6.3, §7.1) provides a ‘translation’ between graphs and counterfactuals. This translation is built on two pillars: interpreting causal
DAGs as a non-parametric structural equation model with independent errors (NPSEM-IE), and constructing ‘Twin-networks’ for the purpose of making inferences regarding counterfactuals. We examine each in turn.

D.1

Counterfactual models based on NPSEM-IEs

The first is to associate a DAG with a non-parametric structural equation
model with independent errors (NPSEM-IE). It has long been understood
that NPSEMs may be viewed as a counterfactual model via the classical
idea (see e.g. Box, 1966; Haavelmo, 1943; Pearl, 2000; Spirtes et al., 1993;
Strotz and Wold, 1960) of constructing counterfactual distributions by removing equations from the model and replacing them with equations that fix
a variable to a given value. Though this approach is intuitive and provides
137

a bridge to the literature in the social sciences, the requirement that the
error terms be independent is strong. As shown in Table 6, this assumption
implies super exponentially many additional ‘cross-world’ counterfactual independence relations compared to the FFRCISTG model. As commented
on at length elsewhere (Dawid, 2000; Robins, 2003; Robins and Richardson,
2011) and in §6 of this paper, this has the consequence that in order to posit
an NPSEM-IE model researchers must be in a position to make hypotheses
about the underlying causal process that they cannot even in principle verify
via any randomized experiment on the variables in the graph. Furthermore
these additional independence assumptions lead to additional identification
results, such as for the Pure Direct Effect (Robins and Greenland, 1992)
also known as the Natural Direct Effect (Pearl, 2001a); see §6.1.1.

D.2

The twin network procedure

The second pillar of Pearl’s synthesis between graphs and counterfactuals
under the NPSEM-IE, is the ‘twin network’ method, later generalized to
multi-networks. The method is claimed to provide a graphical method for
evaluating the truth of counterfactual independence queries. The basic idea
is to create a a set of linked graphs – consisting of the the actual world graph
plus separate graphs for each counterfactual world referenced by the query.
The actual variable (e.g. V ) and counterfactual variables (e.g. V (a),
V (b)) are linked through their common error term UV .94 Examples are
shown in Figures 29(a) and 31(ii). In the twin- or multi-network associated
with a DAG, the error terms associated with different variables UV , UW are
assumed independent, reflecting the NPSEM-IE independence assumption
(18). The explicit inclusion of error terms in these networks means that actual and counterfactual variables are deterministic functions of their parents
in the graph.
Pearl has advocated his unification of DAGs and potential outcome models given in Chapter 7 of Pearl (2000, 2009) via twin- and multi-networks in
many places (e.g. Pearl, 2012b, p.5). However, in contrast to our SWIG approach, these network methods are difficult to correctly apply, owing to the
presence of deterministic relations between variables in the networks. The
most powerful argument for this claim is that, as we shall see, Pearl himself
made numerous errors in applying these methods particularly in the first edition of his book Causality, but also in the second edition. In fact we take his
continuing difficulty in properly applying the network methods even in his
94

Elsewhere we have used εV to indicate error terms. In order to facilitate the exposition
we here follows Pearl’s usage.

138

second edition as a major motivation for the simpler SWIG based approach
presented herein. We turn now to the first edition of his book Causality .
Although Pearl did not warn the readers of the second edition of the errors
made in the first, he did attempt to correct them (though he continued to
make analogous errors in the second edition).
To substantiate our claim that network methods are difficult to apply we
demonstrate below both how deterministic relations contributed to Pearl’s
errors and how an approach based on SWIGs would have prevented certain
of his mistakes.
D.2.1

Mistaken treatment of error terms as single counterfactual
variables

In the first edition, Pearl’s treatment of the error terms (UZ ) in twin networks was mistaken. Specifically Pearl (2000, p. 214), in the last paragraph
states:
The twin network reveals an interesting interpretation of counterfactuals of the form Z(paZ ), where Z is any variable and
P AZ stands for the set of Z’s parents. Consider the question
of whether Z(x) is independent of some given set of variables in
the model of Figure 7.3. The answer to this question depends
on whether Z ∗ is d-separated from that set of variables. However, any variable that is d-separated from Z ∗ would also be
d-separated from UZ , so the node representing UZ can serve as a
proxy for representing the counterfactual variable Z(x). [counterfactual notation changed95 ]
For reference, the graph in Figure 7.3 is shown in Figure 29(ii).
Pearl (2000) p.215, first paragraph goes on to say:
We thus obtain a simple graphical representation for any
counterfactual variable of the form Z(paZ ). Using this representation we can easily verify from Figure 7.3 that (Y ∗ ⊥
⊥X |
∗
{Z, UZ , Y })G and (Y ⊥
⊥X | {UY , UZ , Y })G both hold in the
twin-network and, therefore,
Y (x)⊥
⊥X | {Z, Z(x), Y } and

Y (x)⊥
⊥X | {Y (z), Z(x), Y }

must hold in the model. [emphasis added; notation changed]
95

Here and elsewhere we replace Pearl’s subscript notation for counterfactuals (e.g. Zx )
with our parenthetical notation Z(x).

139

Pearl’s last claim is not easily verified as it is false. The two d-separation
relations (Y ∗ ⊥
⊥X | {Z, UZ , Y })G and (Y ∗ ⊥
⊥X | {UY , UZ , Y })G do indeed
hold in the twin-network graph. Since the error term UV for a given variable V is equivalent to the set of counterfactual variables {V (paV )} for all
instantiations paV of the parents of V , it follows that under the NPSEM-IE
association with the graph G,
Y (x)⊥
⊥X | {Z, Y, Z(x0 ) for all x0 ∈ X}
Y (x)⊥
⊥X | {Y (z 0 ), Z(x0 ), Y, for all x0 ∈ X, z 0 ∈ Z}

where X and Z are the state-spaces for X and Z respectively. However, the
latter condition does not imply that Y (x) and X will be independent when
conditioning on a subset of these variables; the inference that Y (x)⊥
⊥X |
{Y (z), Z(x), Y } holds is erroneous.

D.3

Partial Correction in the Second Edition of Errors in
the First Edition

Pearl (2009) corrects the above mistakes in the second edition at least partially. Specifically Pearl no longer claims that Uz is a proxy for Z(x). Rather
the sentence has been changed to read:
. . . so the node representing UZ can serve as a one-way proxy
for representing the counterfactual variable Z(x). [emphasis
added; counterfactual notation changed]
No definition of ‘one-way proxy’ is provided, nor is any explanation given
for the change. However Pearl’s thinking is clarified by comparing the first
paragraph on p. 215 in the first edition (quoted above) with the same paragraph in the second edition which has been changed to read:
We thus obtain a simple graphical representation for any
counterfactual variable of the form Z(paZ ), in terms of the so
called “error-term” UZ . Using this representation we can easily
verify from Figure 7.3 that (UY ⊥
⊥X | {Y ∗ , Z ∗ })G and (UY ⊥
⊥UZ |
{Y, Z})G both hold in the twin-network and, therefore,
Y (z)⊥
⊥X | {Y (x), Z(x)}

and

Y (z)⊥
⊥Z(x) | {Y, Z}

must hold in the model. [emphasis added; notation changed]
140

Thus in the second edition all four conditional independence statements
in this paragraph have been changed. In particular he now avoids conditioning on the error UZ and/or UY , in order to avoid repeating the inferential
error made in the first edition. Nonetheless Pearl fails to change the following statement in the second edition:
Therefore, if UZ obeys a certain independence relationship
then Z(x) (more generally Z(paZ )) must obey that relationship
as well. [notation changed] Pearl (2000, 2009, p.214)
If “UZ obeys a certain independence relationship” is interpreted as including independencies in which UZ appears in the conditioning set then this
statement is incorrect for the reason we gave above. That is, since Z(paZ )
is a deterministic function of UZ the implication:
A⊥
⊥ UZ | B

⇒

A⊥
⊥ Z(paZ ) | B

is valid. However, for the same reason the implication:
A⊥
⊥ B | UZ

⇒

A⊥
⊥ B | Z(paZ )

is not generally valid even though Pearl’s statement might suggest otherwise.
Note all these difficulties result from the deterministic relations between UZ
and Z(x).
Finally we note that the erroneous independence relation Y (x)⊥
⊥X |
{Y (z), Z(x), Y } in (Pearl, 2000, p.215) quoted earlier is corrected in the
second edition.
However we now show that the correction itself highlights additional
problems that arise in evaluating counterfactual independence relations through
multi-networks. Specifically, the above independence reappears as equation
(11.40) on (Pearl, 2009, p.394), in connection with the ‘triple-network’ graph
shown in Figure 29(iii). A reader asks whether or not it follows from this
triple network that in fact Y (x) 6⊥
⊥X | {Y (z), Z(x), Y } as there is an open
d-connecting path:
Y (x) ← UY → Y ← Z ← X.
Pearl accurately informs the reader that they are “correct” in their conclusion, since Y (x)⊥
⊥X | {Y (z), Z(x), Y } is not implied under the NPSEM-IE.
96 However, Pearl does not give a justification for drawing this conclusion.
96
However, Pearl does not offer an explanation as to why he reached the opposite
mistaken conclusion in the first edition, even though the argument that led to this false
conclusion is unchanged in the second edition (Pearl, 2009), save for the addition of the
qualifier ‘one-way’ to ‘proxy’ on p. 214.

141

Presumably the reader is applying to the query Y (x)⊥
⊥X | {Y (z), Z(x), Y },
the logic applied by Pearl to evaluate the query Y (x) ⊥
⊥ X | Z in this same
example. To wit Pearl states in the context of Figure 29(ii):
To test whether Y (x) ⊥
⊥ X | Z holds in the original [NPSEMIE] model, we test whether Z d-separates X from Y (x) in the
twin network. [(Pearl, 2000, 2009, p.214); counterfactual notation changed; emphasis added]
Given this quotation, and the reader’s question as to whether it is safe
to apply d-connection to a triple-network, it might easily be inferred that
Pearl was endorsing not only the reader’s conclusion, but also the method
(d-connection) by which the reader arrived at it.
However, a close reading of Pearl’s response to another question from
the same reader shows that in fact this is not the case. The reader correctly
points out that if it were true in general that the presence of a d-connecting
path in a twin-network implied that the corresponding counterfactual independence did not hold, then an inference in (Pearl, 2001b) would be invalid;
(see Pearl, 2009, p.394). This is because there may be deterministic equalities between variables that are present in the network, even though these are
not explicitly represented.97 Consequently d-separation is not a complete
criterion for establishing conditional independence in multi-networks.
Pearl agrees that in a multi-network d-connection does not imply dependence, showing that indeed there is a hidden equality in the twin-network
associated with the example from (Pearl, 2001b) raised by the reader. He
then refers the reader to the paper (Shpitser and Pearl, 2007), that introduces ‘counterfactual graphs’ as a means of systematically handling these
equalities. However, ‘counterfactual graphs’ are intended to represent conjunctions of counterfactual events, e.g. Z(x = 1) = 0, not counterfactual
variables, e.g. Z(x = 1). (Shpitser and Pearl, 2007) contains a complete
algorithm for testing whether a counterfactual quantity is identified (under
the NPSEM-IE). Though the paper does not include an explicit algorithm
for testing independence, the make-cg algorithm suggests an obvious procedure for checking counterfactual independence among events (Shpitser,
97
To give a simple example of this phenomenon, consider the graph shown in in Figure
30(i) together with the twin-network (ii) resulting from intervening to set Z to z. We
see that in the twin-network T and Y (z) are d-connected given X by the path T ←
UT → T (z) → X(z) → Y (z), but in spite of this T ⊥
⊥ Y (z) | X under the associated
NPSEM-IE. This is because, since Z is not an ancestor X, X(z) = X, and T (z) and Y (z)
are d-separated given X(z) in the twin-network. This independence also holds under the
FFRCISTG model associated with this graph, as may be seen directly from the template
G(z) shown in Figure 30(iii).

142

UX
X

UX
X∗

X

X

UZ
Z

Z

UY
Y
(i)

Z(x)

z

Y (x)

Y (z)

UY
Y∗

Y

X(z)

UZ
Z∗

Z

x

Y

(ii)

(iii)

Figure 29: Twin networks. (i) A DAG; (ii) Twin network intervening on X;
see Pearl (2000, 2009), p. 214, Fig. 7.3; note that in counterfactual notation
X ∗ ≡ x, Z ∗ ≡ Z(x) and Y ∗ ≡ Y (x); (iii) ‘Triple’ network intervening on X and
Z; see Pearl (2000, 2009), p. 394, Fig. 11.18. Compare to the corresponding
SWIGs in Figure 10.
2013). Specifically, to test:
{X(a† ) = x0 } ⊥
⊥ {Y(b† ) = y0 } | Z(c† ) = z0 }
one may run make-cg on the set of events {X(a† ) = x0 , Y(b† ) = y0 , Z(c† ) = z0 }
and then test d-separation in the resulting counterfactual graph. It is conjectured that this procedure is complete (Shpitser, 2013). However, since
a counterfactual independence amongst variables corresponds to an exponential number of independences among events, testing an independence
amongst variables using this method would necessitate the construction of
exponentially many separate counterfactual graphs.98

D.4

Context Specific Independence and a Further Error

In spite of acknowledging that it is unsafe to draw inferences from d-connection
in twin-networks,99 in Pearl (2009, p.353, Ex. 11.3.3) he falls afoul of exactly
this pitfall in his second edition. Specifically, in the twin network shown in
98

There is currently no known polynomial-time algorithm for testing counterfactual
independence in NPSEM-IEs.
99
Without the additional steps required to construct a counterfactual graph.

143

UT
T
T

T (z)

T
UX

X
X

X

X(z)
UZ

Z

Z

Z

z

z

UY
Y
(i)

Y (z)

Y

Y (z)
(ii)

(iii)

Figure 30: (i) A DAG G. (ii) The twin-network arising from intervening
to set Z to z. This example shows the difficulty arising from deterministic
relations: T (z) and Y (z) are d-connected given X in the twin-network, but
in spite of this T (z) ⊥
⊥ Y (z) | X under the associated NPSEM-IE because
X(z) = X, and T (z) and Y (z) are d-separated given X(z) in the twinnetwork. (iii) The template G(z) obtained by node-splitting, which makes
manifest that T = T (z) is d-separated from Y (z) given X.

144

X0
H
X1

UH

X0

UZ

H
Z
Y

X1

Z

UY

x0
H(x0 , x1 )
x1

Y

(i)

Z(x0 , x1 )
Y (x0 , x1 )

(ii)

Figure 31: Failure of the simple twin network method of Pearl (2000, 2009)
in Pearl’s Example 11.3.3. (i) The original DAG; (ii) The twin network
after intervention on X0 and X1 . The twin network fails to reveal that
Y (x0 , x1 )⊥
⊥X1 | Z, X0 = x0 . This ‘extra’ independence holds in spite of
d-connection because (by consistency) when X0 = x0 , then Z = Z(x0 ) =
Z(x0 , x1 ). Note that Y (x0 , x1 ) ⊥
6 ⊥X1 | Z, X0 6= x0 . (Note that we have
replaced the bi-directed edge X1 ↔ Z present in Pearl’s figure, by a hidden
variable X1 ← H → Z, this does not change the conclusions, but does make
the construction of the twin network more transparent.)
Figure 31 he incorrectly concludes from the existence of the path:
X1 ← H → Z ← UZ → Z(x0 , x1 ) → Y (x0 , x1 )
that Y (x0 , x1 ) 6⊥
⊥ X1 | Z, X0 = x0 . This fails to take into account the fact
that conditional on X0 = x0 we have the additional equality: Z = Z(x0 ) =
Z(x0 , x1 ); hence the above path fails to result in dependence because it is
blocked by Z(x0 , x1 ). We note that careful application of the make-cg algorithm described in (Shpitser and Pearl, 2007, 2008) would have performed
a pre-processing step in which Z and Z(x0 , x1 ) would have been identified
(conditional on X0 = x0 ), and thus would have avoided the problem. (The
criterion of ‘D-separation’ of Geiger (1990), which allows for determinism
would also have addressed this problem. Note here that ‘D-separation’ and
‘d-separation’ are not the same.)
As noted earlier, we see some irony in Pearl’s error in this example: in
(Pearl, 2009, Ex. 11.3.3) the example was supposed to illustrate an unnoticed
shortcoming of the condition given by Robins for the application of the gformula. As stated earlier, our approach based on SWIGs immunizes the
user from making this mistake.
145

Summary
Pearl (2000, 2009) presents the NPSEM-IE as a natural way to unify graphs
and counterfactuals with the twin-network method playing the role of inferential engine. However, as we have seen under close examination twinnetworks do not provide a general method for testing counterfactual independence relations implied by NPSEM-IEs, since the presence of deterministic
relations means that d-separation is not complete (since d-connection does
not ensure that independence does not always hold). This fact led Pearl
to make errors in both editions of his book. The counterfactual graphs introduced in (Shpitser and Pearl, 2007, 2008) systematically address many
of the shortcomings present in twin-networks. However, there is currently
no known polynomial time algorithm for testing counterfactual conditional
independence amongst variables in NPSEM-IEs.
Though we think we have identified some weaknesses in the twin-network
method as it appears in (Pearl, 2000, 2009), we do not wish to suggest that
this somehow taints the other graphical tools and methods that Pearl has
advocated, extended or developed.
We are in strong agreement with Pearl’s basic contention that directed
graphs are a very valuable tool for reasoning about causality, and by extension, potential outcomes. If anything our criticism of the approach to
synthesizing graphs and counterfactuals in (Pearl, 2000, 2009) is that it is
not ‘graphical enough’ in the sense that, as we have seen, since twin networks involve variables that are deterministically related, d-separation is no
longer a complete criterion for deriving conditional independence relations.

146

